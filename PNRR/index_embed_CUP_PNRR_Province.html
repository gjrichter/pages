<!DOCTYPE html>
<html>

<!-- **********************************************************************

ixmaps map embed html

$Comment: ixmaps map template; embedded version
$Source : index_only_map_embed.html,v $

$InitialAuthor: guenter richter $
$InitialDate: 2017/06/22 $
$Author: guenter richter $
$Id:index_only_map_embed.html 1 2021-10-17 00:00:00Z Guenter Richter $

licensed under CC-BY
$Log:index_only_map_embed.html,v $

********************************************************************** -->

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="ixmaps embed example">
	<meta name="author" content="guenter richter">
	<link rel="shortcut icon" href="https://gjrichter.github.io/ixmaps/ui/resources/images/ixmaps_logo.png">

	<title>iXMaps really simple embed</title>

</head>

<body style='text-align:center;background:#F7F6EF'>

	<!--========================================================================= -->

	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
	<script src="https://gjrichter.github.io/ixmaps/ui/js/htmlgui_api.js"></script>

	<!--========================================================================= -->

	<script type="text/javascript" charset="utf-8">
		ixmaps.tmp = ixmaps.tmp || {};

		/**
		 ** strings used by the map 	
		 **/

		attribution =
			"powered by <a href=\"http://ixmaps.com\" target=\"_blank\">iXMaps</a>";

		/**
		 ** the process function will be included into the theme definitions below
		 **/

		var process = function(data, options) {
		};

		
		/**
		 **
		 ** define the themes 
		 **
		 **/
		
		var __georef =
			ixmaps.layer("ITALIA_Comuni_2022")
			.data({
				url: "https://s3.eu-central-1.amazonaws.com/maps.ixmaps.com/Istat/comuni_2022/Com01012022_s_WGS84.topojson.gz",
				type: "topojson"
			})
			.binding({
				id: "PRO_COM_T",
				position: "geometry"
			})
			.type("FEATURES|NOLEGEND")
			.style({
				colorscheme: ["none"],
				linecolor: "none",
				linewidth: "1",
				sizefield: "Shape_Area"
			})
			.define();

		var __georef_prov =
			ixmaps.layer("ITALIA_Province_2022")
			.data({
				url: "https://s3.eu-central-1.amazonaws.com/maps.ixmaps.com/Istat/province_2022/Prov01012022_g_WGS84.topojson.gz",
				type: "topojson"
			})
			.binding({
				id: "COD_PROV",
				position: "geometry"
			})
			.type("FEATURES|NOLEGEND")
			.style({
				colorscheme: ["none"],
				linecolor: "black",
				linewidth: "0.5",
				sizefield: "Shape_Area"
			})
			.define();

		var __georef_reg =
			ixmaps.layer("ITALIA_Regioni_2022")
			.data({
				url: "https://s3.eu-central-1.amazonaws.com/maps.ixmaps.com/Istat/regioni_2022/Reg01012022_s_WGS84.topojson.gz",
				type: "topojson"
			})
			.binding({
				id: "COD_REG",
				position: "geometry"
			})
			.type("FEATURES|NOLEGEND|DASHED")
			.style({
				colorscheme: ["rgba(255,255,255,0.5)"],
				linecolor: "black",
				linewidth: "3",
				sizefield: "Shape_Area"
			})
			.define();

		var __CUP_PNRR =
			ixmaps.layer("ITALIA_Comuni_2022")
			.data({
				url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/PNRR/progetti_cup_20230120.csv.gz",
				type: "csv"
			})
			.binding({
				position: "CODI_CODICE_COMUNE",
				value: "CATEGORIA_INTERVENTO",
				title: "PROVINCIA"
			})
			.type("CHART|SYMBOL|SEQUENCE|STAR|SORT|DOWN|GLOW|CATEGORICAL|AGGREGATE|SUM|COMPACTLEGEND")
			.style({
				name: "chart",
				colorscheme: ["999","tableau"],
				showdata: "true",
				sizefield: "IMPO_IMPORTO_FINANZIATO",
				units: "€",
				normalsizevalue: "100000000",
				maxcharts: "10000",
				aggregationfield: "PROVINCIA"
			})
			.meta({
				title: "OPEN CUP : Focus PNRR",
				snippet: "<em>Importi aggregati per categoria di intervento:</em>",
				decription: "Progetti del database CUP Focus PNRR colorati per categoria intervento e scalati per importo finanziato. I progetti sono aggregati per comune.",
				splash: "carico dati: 200 000+ righe (20Mb) ..."
			})
			.define();
		
		/**
		 **
		 ** create the interactive map an append it to the document 
		 **
		 **/

		document.activeElement.appendChild(

			ixmaps.embed("mymap", {
					mapService: "leaflet",
					mapType: "OpenStreetMap - FR",
					map: "../../maps/svg/maps/generic/mercator.svg",
					mode: "pan",
					width: "100%",
					width: (window.innerWidth - 280) + "px",
					height: (window.innerHeight * 0.88) + "px",
					legend: "true",
					xxalign: "right"
				},
				map => map
			    .view({
					center: {
						lat: "41.88592102814744",
						lng: "14.029541015625002"
						},
					zoom: "6"
				})
				.options({
					objectscaling: "dynamic",
					normalSizeScale: "27033",
					dynamicScalePow: "3",
					flushChartDraw: "1000000",
					basemapopacity: "0.4",
					panhidden: "false"
				})
				.local("aggregated", "")
				.require("../../ui/js/tools/tooltip_basic.js")
				.attribution(attribution)

				// -----------------------------		 
				// the data visualization layer 
				// -----------------------------
						 
			   .layer(__georef)
			   .layer(__georef_prov)
			   .layer(__georef_reg)
			   .layer(__CUP_PNRR)
			)
		);

	</script>

	<!-- ------------------------------------- -->
	<!-- user buttons to change the map charts -->
	<!-- ------------------------------------- -->

	<div style="position:absolute;top:1.5em;right:2em">

		<script>
			var sizeCharts = function(nFactor) {
				ixmaps.changeThemeStyle(null, 'chart', 'scale:' + nFactor, 'factor');
			}
			var heightCharts = function(nFactor) {
				ixmaps.changeThemeStyle(null, 'chart', 'rangescale:' + nFactor, 'factor');
			}
			var opacityCharts = function(nFactor) {
				ixmaps.changeThemeStyle(null, 'chart', 'fillopacity:' + nFactor, 'factor');
			}
			var filterCharts = function(szFilter) {
				ixmaps.changeThemeStyle(null,'chart','filter:'+szFilter,'set');
			}
			var select = function(element){
				element.parent().parent().parent().children().children(".radio").html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
				//$(".radio").html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
				element.parent().prev().html("&bullet;");
			}

		</script>

		<style>
			table {
				background: #F7F6EF;
				border-radius: 0.3em;
				padding: 0.4em 0.8em;
			}

			td {
				border: dotted #888800 0.1px;
			}

			button {
				background: #F7F6EF;
				border: #dddddd solid 1px;
				border-radius: 0.3em;
				padding: 0.4em 0.8em;
			}
			
			button:hover {
    			cursor: pointer;
			}
			
			.left {
				text-align: left;
			}
			
			a {
				text-decoration: none;
			}

		</style>

		<table>
			<tr>
				<td>
					<button onclick="sizeCharts(0.90)">-</button>
				</td>
				<td>
					<span style="font-size:0.8em"> &nbsp; grandezza &nbsp;</span>
				</td>
				<td>
					<button onclick="sizeCharts(1.1)">+</button>
				</td>
			</tr>
			<tr>
				<td>
					<button onclick="opacityCharts(0.75)">-</button>
				</td>
				<td>
					<span style="font-size:0.8em"> &nbsp; opacità &nbsp;</span>
				</td>
				<td>
					<button onclick="opacityCharts(1.5)">+</button>
				</td>
			</tr>
			<tr>
				<td>
					<button onclick="ixmaps.changeThemeStyle(null,'chart','type:GLOW','remove');">no</button>
				</td>
				<td>
					<span style="font-size:0.8em"> &nbsp; glow &nbsp;</span>
				</td>
				<td>
					<button onclick="ixmaps.changeThemeStyle(null,'chart','type:GLOW','add');">si</button>
				</td>
			</tr>
			<tr>
				<td>
					<button onclick="ixmaps.changeThemeStyle(null,'chart','aggregationfield:PROVINCIA','set');">Prov.</button>
				</td>
				<td>
					<span style="font-size:0.8em"> &nbsp; aggregazione &nbsp;</span>
				</td>
				<td>
					<button onclick="ixmaps.changeThemeStyle(null,'chart','aggregationfield:COMUNE','set');">Com.</button>
				</td>
			</tr>
		</table>
		
		<div style="font-family:open sans;text-align:left;margin-left:1em;margin-top:0.5em;max-width:200px">
						<p>Fonte dati:<br>Open CUP : Focus PNRR</p>
						<p>Descrizione dei dati ed istruzioni per l'uso si trovano qui sulla pagina dedicata di <a style="color:#0088dd" href="https://pnrr.datibenecomune.it/fonti/opencup/focus-pnrr.html" target="_blank">pnrr.datibenecomune.it</a></p>
						<p>Link ai dati: <a style="color:#0088dd" href="https://opencup.gov.it/portale/documents/21195/117121/progetti_cup_20230120.xlsx" target="_blank">progetti_cup_20230120.xlsx</a>
						</p>
			<p><small><b>nota bene:</b><br> - si può clicare sui colori della leggenda per isolare 1 o più categorie<br>
									  - per evitare tempi di aggiornamento grafici lunghi, conviene zoomare un po', prima di attivare l'aggregazione al livello comunale<small></small></p>
		
	</div>

</body>

</html>
