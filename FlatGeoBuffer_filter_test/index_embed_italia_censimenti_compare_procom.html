<!DOCTYPE html>
<html>

<!-- **********************************************************************

ixmaps map embed html

$Comment: ixmaps map template; embedded version
$Source : index_only_map_embed.html,v $

$InitialAuthor: guenter richter $
$InitialDate: 2023/04/22 $
$Author: guenter richter $
$Id:index_embed_Open_Data_PNRR_Dati_Universo_REGIS_III.html 1 2023-04-22 00:00:00Z Guenter Richter $

licensed under CC-BY
$Log:index_only_map_embed.html,v $

********************************************************************** -->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="ixmaps embed example">
    <meta name="author" content="guenter richter">
    <link rel="shortcut icon" href="https://gjrichter.github.io/ixmaps/ui/resources/images/ixmaps_logo.png">

    <title>Data VizI</title>
    <meta name="description" content="Le mappe con dati italiani">


    <style>
        a {
            text-decoration: none;
            color: #444444;
        }

        a:hover {
            color: cornflowerblue;
        }

        ul {
            font-family: Raleway;
            padding-inline-start: 1.5em;
        }

        li.active a {
            color: white;
            background-color: #24A2AF;
        }

        a.active {
            color: white;
            background-color: #24A2AF;
        }

        .sidebar {
            position: absolute;
            right: 5%;
            top: 110px;
            text-align: left;
            font-family: Helvetica;
            font-size: 1.1em;
            line-height: 1.2em;
            max-width: 28%;
            padding: 0 0.7em;
            background-color: rgba(247, 246, 239, 0.8);
            z-index: 99999;
        }

        H1 {
            line-height: 1em;
            margin-top: 0.3em;
        }
    </style>
    <style>
        #myRange1,
        #myRange2 {
            vertical-align: -2px;
            accent-color: #888888;
        }
    </style>

</head>

<body style='text-align:center;background:#F7F6EF;margin:0;padding:0'>

    <div id="logo" style="position:absolute;top:25px;right:6%;z-index:9999">
        <a href="javascript:__dataTheme()">
            <div
                style="font-family:helvetica;font-size:48px;line-height:0.8em;font-weight:bold;color:burlywood ;text-align:left">
                Data<br><span style="font-size:48px;padding-left:2px">Viz</span><em> i</em></div>
        </a>
    </div>


    <div style="margin:auto">

        <div id="map_div"></div>

        <div id="sidebar_open_div" class="sidebar" style="background:none">

            <a onclick="$('#sidebar_div').toggle();">
                <span style="font-size:28px;color:#888888;float:right;padding:0.3em 0 0 1em">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor"
                        class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
                        <path
                            d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0" />
                    </svg>
                </span>
            </a>

        </div>

        <div id="sidebar_div" class="sidebar"
            style="padding:0.6em 0.6em 0.2em 1.5em;border-radius:0.5em;border:1px solid #dddddd">

            <a onclick="$('#sidebar_div').toggle();">
                <span style="font-size:28px;color:#888888;background:rgb(247, 246, 239);float:right;padding:0.3em">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor"
                        class="bi bi-arrow-up-square" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm8.5 9.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707z" />
                    </svg>
                </span>
            </a>

            <h1>Popolazione<br> 2011 - 2021</h1>
            <p style="font-family:helvetica;font-size:1.6em;line-height:0.75em;margin:-0.5em 0em 0.5em 0.1em">
                <small style='color:#888888'>Visualizzazione di dati pubblicati dall'ISTAT in <a href="" target="_blank"
                        style="color:cadetblue">Basi territoriali e variabili censuarie</a></small>
            </p>
            <a class="select foreground active" href="javascript:setForegroundTheme('variation_population_percent')">
                Variazione % della popolazione</a>
            <a class="select foreground" href="javascript:setForegroundTheme('variation_population')">
                - n° totali</a>
            </br>
            <a class="select foreground" href="javascript:setForegroundTheme('variation_population_meno_5')">
                &nbsp;&nbsp;&nbsp;- della fascia d'età < 5 anni</a>
                    </br>
                    <a class="select foreground"
                        href="javascript:setForegroundTheme('variation_population_piu_75_percent')">
                        &nbsp;&nbsp;&nbsp;- della fascia d'età > 75 anni</a>
                    </br>
                    </br>
                    <a class="select foreground"
                        href="javascript:setForegroundTheme('variation_educazione_terzo_percent')">
                        &nbsp;&nbsp;&nbsp;- con diploma di terzo grado</a>
                    <a class="select foreground" href="javascript:setForegroundTheme('variation_educazione_terzo')">
                        - n° totali</a>
                    </br>
                    <a class="select foreground"
                        href="javascript:setForegroundTheme('variation_educazione_secondaria_percent')">
                        &nbsp;&nbsp;&nbsp;- con diploma di scuola secondaria</a>
                    </br>
                    <a class="select foreground"
                        href="javascript:setForegroundTheme('variation_educazione_media_percent')">
                        &nbsp;&nbsp;&nbsp;- con diploma di scuola media</a>
                    </br>
                    <a class="select foreground"
                        href="javascript:setForegroundTheme('variation_educazione_elementare_percent')">
                        &nbsp;&nbsp;&nbsp;- con diploma di scuola elementare</a>
                    </br>
                    </br>
                    <a class="select foreground"
                        href="javascript:setForegroundTheme('variation_population_stranieri_percent')">
                        &nbsp;&nbsp;&nbsp;- % stranieri e apolidi residenti in Italia</a>
                    <a class="select foreground" href="javascript:setForegroundTheme('variation_population_stranieri')">
                        - n° totale</a>
                    </br>
                    <p style='font-family:open sans;color:#888888;z-index:999999'>
                        <span style="font-size:0.8em;font-weight:bold;color:cadetblue">grandezza grafici:</span>
                        <input type='range' min='0.1' max='5' step="0.01" value='1' class='slider' id='myRange1'
                            style="width:50%;">
                    </p>
                    <p id="fondo-poligoni" style="display:none">
                        <span style="color:#888888;font-size:0.8em;line-height:1.5em">Fondo (poligoni censimento
                            2021)</span></br>
                        <a class="select background" href="javascript:ixmaps.map().remove('choropleth')">
                            &nbsp;&nbsp;&nbsp;- fondo vuoto</a></br>
                        <a class="select background active"
                            href="javascript:ixmaps.map().add(__sez2021_pop_choropleth(),'replace|silent')">
                            &nbsp;&nbsp;&nbsp;- densità della popolazione</a></br>
                        <a class="select background"
                            href="javascript:ixmaps.map().add(__sez2021_eta_choropleth(),'replace|silent')">
                            &nbsp;&nbsp;&nbsp;- fascia età sopra alla media</a></br>
                        <a class="select background"
                            href="javascript:ixmaps.map().add(__sez2021_edu_choropleth(),'replace|silent')">
                            &nbsp;&nbsp;&nbsp;- grado di istruzione sopra alla media</a></br>
                        <a class="select background"
                            href="javascript:ixmaps.map().add(__sez2021_stranieri_choropleth(),'replace|silent')">
                            &nbsp;&nbsp;&nbsp;- provenienza stranieri predominante</a></br>
                    </p>

        </div>

        <div id="map_code_div-project"
            style="position:absolute;top:10px;left:10px;text-align:left;width:50%;height:800px;overflow:auto;display:none;z-index:9999">
        </div>
    </div>

    <!-- ------------------------------------- -->
    <!--                                       -->
    <!-- c o d e                         -->
    <!--                                       -->
    <!-- ------------------------------------- -->

    <!--========================================================================= -->

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
    <script src="https://gjrichter.github.io/ixmaps_flat/ixmaps.js"></script>

    <script type="text/javascript" src="./js/dataprovider_flatgeobuffer_sezioni.js"></script>
    <script type="text/javascript" src="./layer_compare.js"></script>

    <!--========================================================================= -->

    <script type="text/javascript" charset="utf-8">
        /** 
         ** change background color on select
         **/

        __select = (el) => {
            if (el.hasClass("foreground")) {
                $(".foreground").removeClass("active");
            }
            if (el.hasClass("background")) {
                $(".background").removeClass("active");
            }
            el.addClass("active");
        };
        $(".select").attr("onclick", "__select($(this))");

        var setChartSize = function (nValue) {
            ixmaps.map().changeThemeStyle('chart', 'scale:' + nValue, 'set');
            ixmaps.map().changeThemeStyle('chart_procom_all', 'scale:' + nValue, 'set');
        }
        var setGrid = function (nValue) {
            ixmaps.map().changeThemeStyle('chart', 'gridwidthpx:' + nValue, 'set');
            ixmaps.map().changeThemeStyle('chart_grid', 'gridwidthpx:' + nValue, 'set');

        }
        var slider = document.getElementById("myRange1");
        // Update the current slider value (each time you drag the slider handle)
        slider.oninput = function () {
            if (ixmaps.sliderT1) {
                clearTimeout(ixmaps.sliderT1);
            }
            ixmaps.value = this.value;
            ixmaps.sliderT1 = setTimeout(function () {
                setChartSize(ixmaps.value)
            }, 10);
        }
        /**
        slider = document.getElementById("myRange2");
        // Update the current slider value (each time you drag the slider handle)
        slider.oninput = function() {
            if (ixmaps.sliderT2) {
                clearTimeout(ixmaps.sliderT2);
            }
            ixmaps.value = this.value;
            ixmaps.sliderT2 = setTimeout(function() {
                setGrid(ixmaps.value)
            }, 250);
        }
        **/


        var szForegroundTheme = "variation_population_percent";
        var setForegroundTheme = function (szTheme) {
            szForegroundTheme = szTheme;
            loadForegroundTheme();
        };

        var loadForegroundTheme = function () {
            switch (szForegroundTheme) {
                case "variation_population_percent":
                    ixmaps.map().replace('chart_procom_all', __procom_2011_2021_arrow_user_relative(), 'silent');
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_user_relative(), 'silent');
                    break;
                case "variation_population":
                    ixmaps.map().replace('chart_procom_all', __procom_2011_2021_arrow_user(), 'silent');
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_user(), 'silent');
                    break;
                case "variation_population_meno_5":
                    ixmaps.map().replace('chart_procom_all', __procom_2011_2021_arrow_user_relative_meno_5(), 'silent');
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_eta_meno_5(), 'silent');
                    break;
                case "variation_population_piu_75_percent":
                    ixmaps.map().replace('chart_procom_all', __procom_2011_2021_arrow_user_relative_piu_75(), 'silent');
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_eta_piu_75(), 'silent');
                    break;
                case "variation_population_stranieri_percent":
                    ixmaps.map().replace('chart_procom_all', __procom_2011_2021_arrow_user_relative_stranieri(), 'silent');
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_stranieri(), 'silent');
                    break;
                case "variation_population_stranieri":
                    ixmaps.map().replace('chart_procom_all', __procom_2011_2021_arrow_user_stranieri(), 'silent');
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_stranieri(), 'silent');
                    break;
                case "variation_educazione_terzo_percent":
                    ixmaps.map().replace('chart_procom_all', __procom_2011_2021_arrow_user_relative_educazione_terzo(), 'silent');
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_edu_terzo(), 'silent');
                    break;
                case "variation_educazione_terzo":
                    ixmaps.map().replace('chart_procom_all', __procom_2011_2021_arrow_user_educazione_terzo(), 'silent');
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_edu_terzo(), 'silent');
                    break;
                case "variation_educazione_media_percent":
                    ixmaps.map().replace('chart_procom_all', __procom_2011_2021_arrow_user_relative_educazione_media(), 'silent');
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_edu_media(), 'silent');
                    break;
                case "variation_educazione_secondaria_percent":
                    ixmaps.map().replace('chart_procom_all', __procom_2011_2021_arrow_user_relative_educazione_secondaria(), 'silent');
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_edu_secondaria(), 'silent');
                    break;
                case "variation_educazione_elementare_percent":
                    ixmaps.map().replace('chart_procom_all', __procom_2011_2021_arrow_user_relative_educazione_elementare(), 'silent');
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_edu_elementare(), 'silent');
                    break;
            }
        };

        var reloadForegroundTheme = function () {
            switch (szForegroundTheme) {
                case "variation_population_percent":
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_user_relative(), 'silent');
                    break;
                case "variation_population":
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_user(), 'silent');
                    break;
                case "variation_population_meno_5":
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_eta_meno_5(), 'silent');
                    break;
                case "variation_population_piu_75_percent":
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_eta_piu_75(), 'silent');
                    break;
                case "variation_population_stranieri_percent":
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_stranieri(), 'silent');
                    break;
                case "variation_population_stranieri":
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_stranieri(), 'silent');
                    break;
                case "variation_educazione_terzo_percent":
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_edu_terzo(), 'silent');
                    break;
                case "variation_educazione_terzo":
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_edu_terzo(), 'silent');
                    break;
                case "variation_educazione_media_percent":
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_edu_media(), 'silent');
                    break;
                case "variation_educazione_secondaria_percent":
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_edu_secondaria(), 'silent');
                    break;
                case "variation_educazione_elementare_percent":
                    ixmaps.map().replace('chart', __sez_2011_2021_pop_arrow_edu_elementare(), 'silent');
                    break;
            }
        };

        // ---------------------------------------------------
        // ---------------------------------------------------
        //
        // t h e   m a p 
        //
        // ---------------------------------------------------
        // ---------------------------------------------------

        /**
         ** ************************************
         ** define the ixmaps themes and project
         ** ************************************
         **/

        var __filter = "";
        var __lat = null;
        var __lon = null;
        var __zoom = null;
        var __scale_chart = 1;
        var __legend = true;

        /**
         ** strings used by the map 	
         **/

        attribution =
            "powered by <a href=\"http://ixmaps.com\" target=\"_blank\">iXMaps</a>";

        /**
         ** get query params and adapt theme and project definitions 	
         **/

        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });

        if (params.filter) {
            __filter = params.filter;
        }

        if (params.view) {
            var latlonA = params.view.split('[')[1].split(']')[0].split(',');
            __lat = latlonA[0];
            __lon = latlonA[1];
            __zoom = parseFloat(params.view.split(',')[2]);
            //setTimeout("ixmaps.setView(null,"+params.view+")",1000);
        };

        if (params.scale) {
            __scale_chart = params.scale;
        };

        if (params.legend) {
            __legend = params.legend;
        };


        ixmaps.regione = "03";
        ixmaps.procom = "*";


        const nuts2 =
            ixmaps.layer("nuts2", layer => layer
                .type("FEATURES|SILENT|LOCKED|NOLEGEND")
                .data({
                    url: "https://gisco-services.ec.europa.eu/distribution/v2/nuts/geojson/NUTS_RG_10M_2021_4326_LEVL_2.geojson",
                    type: "geojson"
                })
                .binding({
                    id: "NUTS_ID"
                })
                .filter("WHERE CNTR_CODE = IT")
                .style({
                    colorscheme: [
                        "white"
                    ],
                    fillopacity: "1",
                    linecolor: "#F7F6EF",
                    linewidth: "2",
                    shadow: true,
                    showdata: true,
                    featurelower: "1:2000000",
                    titlefield: "NUTS_NAME",
                    name: "nuts2"
                })
            );


        /**
         **
         ** window size handling
         **
         **/

        $(window).resize(function () {
            $("#regis_map").css("height", (window.innerHeight - 5) + "px");
        });

        ixmaps.htmlgui_onNewTheme = function (szId) {
            if (szId == "chart") {
                setChartSize(ixmaps.value || 1);
            }
        };

        let __oldZoomAndPan = ixmaps.htmlgui_onZoomAndPan;
        ixmaps.htmlgui_onZoomAndPan = function () {

            var nOpacity = (ixmaps.getZoom() - 7) / 3;
            ixmaps.map().setBasemapOpacity(nOpacity, "absolute");

            if (ixmaps.getZoom() > 11.5) {
                $("#fondo-poligoni").show();
            } else {
                $("#fondo-poligoni").hide();
            }
            __oldZoomAndPan();
        };


        // ----------------------------------------------
        // show actual map HTML page
        // ----------------------------------------------

        var fCode = false;
        const __openSidebar = (url) => {
            const $sidebar = $("#map_code_div-project");
            $sidebar.load(url, (response, status, xhr) => {
                if (status === "error") {
                    alert(`Sorry but there was an error: ${xhr.status}\n${xhr.statusText}`);
                }
            });
        };

        __dataTheme = function () {
            if ($("#map_code_div-project").css("display") != "none") {
                $("#map_code_div-project").html("");
                $("#map_code_div-project").hide();
            } else {
                __openSidebar('./show_map_HTML.html');
                $("#map_code_div-project").show();
            }
            fCode = !fCode;
        }


        // ---------------------------------------------------
        // e m b e d   t h e   m a p  
        // ---------------------------------------------------

        /**
         **
         ** create the interactive map an append it to the document 
         **
         **/

        ixmaps.Map("map_div", {
            mapService: "leaflet_vt",
            mapType: "CartoDB - Positron",
            map: "../../maps/svg/maps/generic/mercator.svg",
            legend: ((__legend == true) ? "true" : 0),
            align: "left",
            mode: "pan",
            about: "test",
            search: "Italy"
        })
            .view({
                "center": {
                    "lat": __lat || "42.30234655149951",
                    "lng": __lon || "13.987399620595363"
                },
                "zoom": __zoom || "6.27681771091248"
            })
            .options({
                featurescaling: "true",
                objectscaling: "true",
                normalSizeScale: "50000",
                dynamicScalePow: "3",
                flushChartDraw: "1000000",
                flushPaintShape: "1000000",
                basemapopacity: "0.5",
                hideOnPan: "false",
                freezeOnPan: "true"
            })
            .local("aggregated", "")
            .local("... creating theme ...", "...")
            .local("loading data ...", "scaricando dati ...")
            .require("https://d3js.org/d3.v3.min.js")
            .require("https://gjrichter.github.io/ixmaps_flat/usercharts/d3/chart.js")
            .require("https://gjrichter.github.io/ixmaps_flat/usercharts/d3/arrow_chart.js")
            .attribution(attribution)

            // -----------------------------		 
            // the data visualization layer 
            // -----------------------------

            .layer(nuts2)
            .layer(__georef_urban())
            .layer(__georef())
            .layer(__georef_sez2011_fgb())
            .layer(__georef_sez2021_fgb())
            .layer(__sez2021_pop_choropleth())
            .layer(__pop_procom_circle())
            .layer(__procom_2011_2021_arrow_user_relative())
            .layer(__sez_2011_2021_pop_arrow_user_relative())


    </script>

</body>

</html>