<!DOCTYPE html>
<html>

<!-- **********************************************************************

ixmaps map embed html

$Comment: ixmaps map template; embedded version
$Source : index_only_map_embed.html,v $

$InitialAuthor: guenter richter $
$InitialDate: 2023/04/22 $
$Author: guenter richter $
$Id:index_embed_Open_Data_PNRR_Dati_Universo_REGIS_III.html 1 2023-04-22 00:00:00Z Guenter Richter $

licensed under CC-BY
$Log:index_only_map_embed.html,v $

********************************************************************** -->

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta name="description" content="ixmaps embed example">
	<meta name="author" content="guenter richter">
	<link rel="shortcut icon" href="https://gjrichter.github.io/ixmaps/ui/resources/images/ixmaps_logo.png">

	<title>ISTAT Indice di fragilit√†</title>
	<meta name="description" content="La mappa interattiva per esplorare i dati aperti di ISTAT sull'Indice composito di fragilit√† dei comni italiani">

	<style>
		a {
			text-decoration: none;
			color: #444444;
		}

		a:hover {
			color: cornflowerblue;
		}

		li.active a {
			color: white;
			background-color: #24A2AF;
            xxpadding: 0.2em;
		}

		.sidebar {
			position: absolute;
			right: 80px;
			top: 150px;
			text-align: left;
			font-family: Georgia;
			font-size: 1.1em;
			line-height: 1.2em;
			max-width: 420px;
			background-color: rgba(247, 246, 239, 0.9)
		}

		/* Info Icon Button */
		.info-icon {
			position: fixed;
			top: 20px;
			right: 20px;
			width: 40px;
			height: 40px;
			background: #24A2AF;
			color: white;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 24px;
			font-weight: bold;
			cursor: pointer;
			box-shadow: 0 2px 8px rgba(0,0,0,0.3);
			z-index: 999999;
			transition: all 0.3s ease;
			font-family: Georgia, serif;
		}

		.info-icon:hover {
			background: #1C8895;
			transform: scale(1.1);
			box-shadow: 0 4px 12px rgba(0,0,0,0.4);
		}

		/* Info Popup */
		.info-popup {
			display: none;
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background: white;
			padding: 0;
			border-radius: 12px;
			box-shadow: 0 4px 20px rgba(0,0,0,0.3);
			z-index: 1000000;
			max-width: 650px;
			max-height: 85vh;
			overflow-y: auto;
			animation: fadeIn 0.3s ease;
		}

		.info-popup.active {
			display: block;
		}

		.info-popup-header {
			background: linear-gradient(135deg, #24A2AF 0%, #1C8895 100%);
			color: white;
			padding: 20px 25px;
			border-radius: 12px 12px 0 0;
			position: relative;
		}

		.info-popup-header h2 {
			margin: 0;
			font-size: 22px;
			font-weight: 600;
		}

		.info-popup-close {
			position: absolute;
			top: 15px;
			right: 20px;
			background: none;
			border: none;
			color: white;
			font-size: 28px;
			cursor: pointer;
			line-height: 1;
			padding: 0;
			width: 30px;
			height: 30px;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 50%;
			transition: background 0.2s;
		}

		.info-popup-close:hover {
			background: rgba(255,255,255,0.2);
		}

		.info-popup-content {
			padding: 25px;
			color: #333;
			line-height: 1.6;
			text-align: left;
		}

		.info-popup-content h3 {
			color: #24A2AF;
			margin: 20px 0 10px 0;
			font-size: 18px;
		}

		.info-popup-content h3:first-child {
			margin-top: 0;
		}

		.info-popup-content p {
			margin: 10px 0;
		}

		.info-popup-content ul {
			margin: 10px 0;
			padding-left: 20px;
		}

		.info-popup-content li {
			margin: 8px 0;
		}

		.info-popup-content strong {
			color: #24A2AF;
		}

		.info-popup-footer {
			padding: 15px 25px;
			background: #f8f9fa;
			border-radius: 0 0 12px 12px;
			font-size: 12px;
			color: #666;
			border-top: 1px solid #e0e0e0;
			text-align: left;
		}

		.info-popup-overlay {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0,0,0,0.5);
			z-index: 999998;
		}

		.info-popup-overlay.active {
			display: block;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translate(-50%, -45%);
			}
			to {
				opacity: 1;
				transform: translate(-50%, -50%);
			}
		}

		.color-indicator {
			display: inline-block;
			width: 20px;
			height: 3px;
			margin-right: 5px;
			vertical-align: middle;
		}

	</style>

</head>

<body style='text-align:center;background:#F7F6EF;margin:0;padding:0'>
    
	<!-- Info Icon -->
	<div class="info-icon" onclick="toggleInfoPopup()" title="Informazioni sulla mappa">
		i
	</div>

	<!-- Info Popup Overlay -->
	<div class="info-popup-overlay" id="infoOverlay" onclick="toggleInfoPopup()"></div>

	<!-- Info Popup -->
	<div class="info-popup" id="infoPopup">
		<div class="info-popup-header">
			<h2>üó∫Ô∏è City Info - OpenStreetMap Data</h2>
			<button class="info-popup-close" onclick="toggleInfoPopup()">&times;</button>
		</div>
		<div class="info-popup-content">
			<h3>üìç Descrizione</h3>
			<p>
				Questa mappa interattiva visualizza <strong>dati di infrastrutture urbane</strong> provenienti da 
				<strong>OpenStreetMap (OSM)</strong> attraverso l'<strong>Overpass API</strong>. 
				Esplora diverse caratteristiche della mobilit√† sostenibile e dei servizi urbani.
			</p>

			<h3>üö¥ Layer Disponibili</h3>
			
			<p><strong>Mobilit√† Ciclabile:</strong></p>
			<ul>
				<li><strong>Cycling Stress Map</strong> - Livelli di stress per i ciclisti (LTS):
					<ul>
						<li><span class="color-indicator" style="background:#0099CC"></span>LTS 1 - Adatto ai bambini</li>
						<li><span class="color-indicator" style="background:#1C9C54"></span>LTS 2 - Basso stress</li>
						<li><span class="color-indicator" style="background:#F0C808"></span>LTS 3 - Stress moderato</li>
						<li><span class="color-indicator" style="background:#DD5454"></span>LTS 4 - Stress alto</li>
					</ul>
				</li>
				<li><strong>Speed Limits</strong> - Limiti di velocit√† delle strade (km/h)</li>
				<li><strong>Street Surface</strong> - Tipo di superficie stradale (asfalto, pav√©, etc.)</li>
				<li><strong>Cycle Lanes by Surface</strong> - Piste ciclabili classificate per superficie</li>
			</ul>

			<p><strong>Trasporto Pubblico e Servizi:</strong></p>
			<ul>
				<li><strong>Bus Stops</strong> - Fermate autobus con accessibilit√† per sedie a rotelle</li>
				<li><strong>Waste and Recycle Bins</strong> - Cestini e raccolta differenziata</li>
			</ul>

			<h3>üîç Come Usare la Mappa</h3>
			<ul>
				<li><strong>Seleziona un layer:</strong> Usa il menu laterale per scegliere quale layer visualizzare</li>
				<li><strong>Naviga:</strong> Trascina la mappa per spostarti, usa zoom per ingrandire/rimpicciolire</li>
				<li><strong>Analizza:</strong> I colori delle linee indicano diverse caratteristiche (velocit√†, stress, superficie)</li>
				<li><strong>Esporta:</strong> Clicca su "DataViz i" in alto a destra per visualizzare/esportare il codice della mappa</li>
			</ul>

			<h3>üìä Cycling Stress Map (LTS)</h3>
			<p>Il <strong>Level of Traffic Stress (LTS)</strong> misura quanto una strada sia confortevole per ciclisti di diverso livello:</p>
			<ul>
				<li><strong>LTS 1:</strong> Adatto a bambini - strade molto sicure, traffico minimo</li>
				<li><strong>LTS 2:</strong> Adatto a ciclisti occasionali - infrastrutture protette</li>
				<li><strong>LTS 3:</strong> Richiede confidenza - traffico moderato</li>
				<li><strong>LTS 4:</strong> Solo ciclisti esperti - traffico intenso, alta velocit√†</li>
			</ul>

			<h3>üåç Fonte Dati</h3>
			<p>
				I dati provengono da <strong>OpenStreetMap</strong>, un progetto di mappatura collaborativa mondiale. 
				Le informazioni sono aggiornate in tempo reale tramite l'<strong>Overpass API</strong>, che interroga il database OSM.
			</p>

			<h3>üí° Applicazioni</h3>
			<ul>
				<li><strong>Pianificazione urbana:</strong> Identificare aree che necessitano miglioramenti ciclabili</li>
				<li><strong>Mobilit√† sostenibile:</strong> Trovare percorsi sicuri per biciclette</li>
				<li><strong>Accessibilit√†:</strong> Verificare servizi di trasporto pubblico accessibili</li>
				<li><strong>Gestione rifiuti:</strong> Mappare la distribuzione di cestini e raccolta differenziata</li>
			</ul>

			<h3>‚öôÔ∏è Tecnologia</h3>
			<ul>
				<li><strong>Dati:</strong> OpenStreetMap via Overpass API</li>
				<li><strong>Visualizzazione:</strong> iXMaps data visualization framework</li>
				<li><strong>Aggiornamento:</strong> Real-time query al database OSM</li>
				<li><strong>Formato:</strong> GeoJSON processato dinamicamente</li>
			</ul>
		</div>
		<div class="info-popup-footer">
			<strong>Fonte dati:</strong> <a href="https://www.openstreetmap.org" target="_blank">OpenStreetMap</a> ¬© Contributors | 
			<strong>API:</strong> <a href="https://overpass-api.de/" target="_blank">Overpass API</a> | 
			<strong>Licenza:</strong> ODbL | 
			<strong>Realizzato con:</strong> <a href="https://ixmaps.com" target="_blank">iXMaps</a>
		</div>
	</div>
    
    <div id="logo" style="position:absolute;top:30px;right:90px">
        <a href="javascript:__toggleProjectHTML()">
            <div style="font-family:helvetica;font-size:52px;line-height:0.75em;font-weight:bold;color:burlywood ;text-align:left">Data<br><span style="font-size:52px;padding-left:2px">Viz</span><em> i</em></div></a>
    </div>
    
	<div>

		<div id="map_div" style="max-width:1024px;margin:auto"></div>

		<div id="sidebar_div" class="sidebar" style="z-index:999999">
			<ul>
				<li class="select" style="font-family:helvetica;font-size:1.3em;line-height:1.2em;list-style-type: none">
					<b>City Info</b> - <b>OSM Data</b>					
				</li>
				<hr>
				<p>Open street map data via Overpass API:</p>
				<ol>
					<li class="select active">
						<a href="javascript:ixmaps.map().remove('features').add(__theme_2)">Speed limits</a>
					</li>
					<li class="select" >
						<a href="javascript:ixmaps.map().remove('features').add(__theme_1)">Cycling stress</a>
					</li>
					<li class="select">
						<a href="javascript:ixmaps.map().remove('features').add(__theme_3)">Street surface</a>
					</li>
					<li class="select">
						<a href="javascript:ixmaps.map().remove('features').add(__theme_4)">Cycle lanes by surface</a>
					</li>
                    <hr>
					<li class="select">
						<a href="javascript:ixmaps.map().remove('features').add(__theme_7)">Bus stops and wheelchair flag</a>
					</li>
					<li class="select">
						<a href="javascript:ixmaps.map().remove('features').add(__theme_8)">Waste and recycle bins</a>
					</li>
					<li class="select">
						<a href="javascript:ixmaps.map().remove('features').add(__theme_9)">Trees</a>
					</li>
					<li class="select">
						<a href="javascript:ixmaps.map().remove('features').add(__theme_10)">Housenumbers</a>
					</li>
                    
                   <div style="margin-top:0.5em;color:#888888"></div>
				</ol>
 			</ul>
 		</div>

        <div id="map_code_div-project" style="position:absolute;top:10px;left:10px;text-align:left;width:50%;height:800px;overflow:auto;display:none;xxbox-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);z-index:9999"></div>
        <div id="map_code_div-project_save" style="position:absolute;top:20px;right:220px;text-align:left;width:50%;display:none">
        <button><a href="javascript:__copyToClipboard()">copy to clipboard</a></button>
        <button><a href="javascript:__saveTextAsFile('map.html')">save to file</a></button></div>
    
    </div>

	<!-- ------------------------------------- -->
	<!--                                       -->
	<!-- c o d e                         -->
	<!--                                       -->
	<!-- ------------------------------------- -->

	<!--========================================================================= -->

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
    <script src="../../ui/js/htmlgui_flat.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <style>
        .hljs {
            background: #ffffff;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="./js/json_config.js"></script>
    
    <script src="./js/dataprovider_flatgeobuffer_sezioni.js"></script>

	<!--========================================================================= -->

	<script type="text/javascript" charset="utf-8">
		/** 
		 ** change background color on select
		 **/

		__select = (el) => {
			$(".select").removeClass("active");
			el.addClass("active");
		};
		$(".select").attr("onclick", "__select($(this))");

		// ---------------------------------------------------
		// ---------------------------------------------------
		//
		// t h e   m a p 
		//
		// ---------------------------------------------------
		// ---------------------------------------------------

		/**
		 ** ************************************
		 ** define the ixmaps themes and project
		 ** ************************************
		 **/

		var __filter = "";
		var __lat = 41.91385469323496;
		var __lon = 12.49173402786255;
		var __zoom = 15;
		var __scale_chart = 1;
		var __legend = true;

		/**
		 ** strings used by the map 	
		 **/

		attribution =
			"powered by <a href=\"http://ixmaps.com\" target=\"_blank\">iXMaps</a>";

		/**
		 ** get query params and adapt theme and project definitions 	
		 **/

		const params = new Proxy(new URLSearchParams(window.location.search), {
			get: (searchParams, prop) => searchParams.get(prop),
		});

		if (params.filter) {
			__filter = params.filter;
		}

		if (params.view) {
			var latlonA = params.view.split('[')[1].split(']')[0].split(',');
			__lat = latlonA[0];
			__lon = latlonA[1];
			__zoom = parseFloat(params.view.split(',')[2]);
			//setTimeout("ixmaps.setView(null,"+params.view+")",1000);
		};

		if (params.scale) {
			__scale_chart = params.scale;
		};

		if (params.legend) {
			__legend = params.legend;
		};

		// ---------------------------------------------------
		// t h e   d a t a 
		// ---------------------------------------------------

		// ---------------------------------------------------
		// t h e   l a y e r 
		// ---------------------------------------------------

		/**
		 ** visualizzation themes 
		 **/

		 var __theme_sezioni_2021 =
			ixmaps.layer("osm", layer => layer
				.data({
                    type: "ext",
					name: "dataquery_flatgeobuffer"
				})
				.type("FEATURE")
				.binding({
					id: "SEZ21_ID",
					size: "SHAPE_Area"
				})
				.style({
					colorscheme: ["none"],
					opacity: "1",
					linecolor: "none",
					linewidth: "0.5",
					name: "sezioni_2021"
				})
			);

		var __theme_population_density_2021 =
			ixmaps.layer("osm", layer => layer
				.data({
                    type: "ext",
					name: "dataquery_flatgeobuffer"
				})
				.type("CHOROPLETH|HEADTAIL|DENSITY|ZEROISVALUE|DOPACITY")
				.binding({
					value: "P1",
					alpha: "P1",
					position: "SEZ21_ID",
					tonumber: true
				})
				.style({
					colorscheme: [
							"8",
							"#F2d246",
							"#100050",
							"3colors",
							"#CC4878"
						],
					units: "",
					alphafield100: "$density$",
					dopacitypow: "2",
					dopacityscale: "1",
					fillopacity: 1,
					showdata: true,
					nodatacolor: "RGB(255,253,216)"
				})
				.meta({
					name: "choropleth",
					title: "Densit√† di popolazione 2021",
					description: "<b>poligoni</b> delle sezioni di censimento",
					tooltip: "{{theme.title}}: {{theme.item.value}}{{theme.item.chart}}{{theme.item.data}}"

				})
			);
			__theme_eta_choropleth_2021 = 
				ixmaps.layer("osm", layer => layer
				.data({
                    type: "parquet",
					url: "http://data.ixmaps.com.s3.amazonaws.com/TestData/istat_indicatori_2021_sezioni_italia.parquet",
					name: "data_parquet"
				})
				.type("CHOROPLETHE|DOMINANT|PERCENTOFMEAN|DOPACITY|HORZ|SIMPLELEGEND")
				.binding({
					value: "P14|P15|P16|P17|P18|P19|P20|P21|P22|P23|P24|P25|P26|P27|P20|P29",
					value100: "P83",
					alpha: "P83",
					position: "SEZ21_ID",
					tonumber: true
				})
				.style({
					colorscheme: [
							"16",
							"RGB(143,244,0)",
							"RGB(150,120,149)",
							"RGB(116,188,200)",
							"2colors"
						],
					label: [
							"meno di 5",
							"5 - 9",
							"10 - 14",
							"15 - 19",
							"20 - 24",
							"25 - 29",
							"30 - 34",
							"35 - 39",
							"40 - 44",
							"45 - 49",
							"50 - 54",
							"55 - 59",
							"60 - 64",
							"65 - 69",
							"70 - 74",
							"> 74"
						],
					means: [
							4.5,
							4.2,
							4.7,
							5.0,
							5.2, 
							5.3, 
							5.4, 
							5.5, 
							5.9, 
							6.1, 
							6.4, 
							6.7, 
							7.3, 
							7.1, 
							7.2, 
							19.5,
						],
					units: "%",
					alphafield100: "$density$",
					dopacitypow: 3,
					dopacityscale: 1
			})
				.meta({
					name: "choropleth",
					title: "Classe d'et√† sopra alla media",
					tooltip: "<h2 style='margin-top:0'>{{theme.title}}</h2>{{theme.item.chart}}"

				})
			);


		// ---------------------------------------------------
		// e m b e d   t h e   m a p  
		// ---------------------------------------------------

		/**
		 **
		 ** create the interactive map an append it to the document 
		 **
		 **/

		ixmaps.embed("map_div", {
				mapService: "leaflet_vt",
				mapType: "VT_TONER_LITE",
				map: "../../maps/svg/maps/generic/mercator.svg",
				legend: "true",
                align: "100px left",
				mode: "map",
                search: "world",
				tools: "true",
				about: "test"
			},
			map => map
			.view([42.85, 13.58], 14)
			.options({
				featurescaling: "true",
				objectscaling: "dynamic",
				normalSizeScale: "50000",
				flushChartDraw: "1000000",
				flushPaintShape: "1000000",
				hideOnPan: "false",
				freezeOnPan: "false",
				basemapopacity: "1"
			})
			.local("aggregated", "")
			.local("... creating theme ...", "...")
			.local("loading data ...", "scaricando dati ...")
			.require("../../ui/js/tools/tooltip_mustache.js")
			.require("../../ui/js/tools/colorscheme.js")
            .require("https://unpkg.com/osmtogeojson@3.0.0-beta.4/osmtogeojson.js")
			.attribution(attribution)
			//.legend("<h1 style='padding:0.2em 0.5em;border-radius:0.5em;background:RGBA(255,255,255,0.5)'>Variazione della <span style='color:#884488'>fascia d'et√† 65+  (%)</span> dal 2003 al 2023 </h1>")		 

			// -----------------------------		 
			// the data visualization layer 
			// -----------------------------

			.layer(__theme_sezioni_2021)
			.layer(__theme_eta_choropleth_2021)
		);


		/**
		 **
		 ** window size handling
		 **
		 **/

		$(window).resize(function() {
			$("#regis_map").css("height", (window.innerHeight - 5) + "px");
		});

        // -----------------------------------------------------------
        //
        // -----------------------------------------------------------
        
         __showProjectHTML = function(szProject,dataName) {

            // make object to handle project definition and get string or json from it
            // 
            var project = new Config(szProject);

            // get JSON and formatted string
            //
            szProject = project.getPrettyString();
            project = project.obj;

            let view = new Config({
                center: project.map.center,
                zoom: project.map.zoom
            });
            let szView = view.getPrettyString().replace(/\n/g, "\n\t\t");

            //szView = "["+project.map.center.lat+","+project.map.center.lng+"],"+project.map.zoom;

            szProject = "";

            //szProject += "data = "+JSON.stringify(dataA[project.themes[0].style.dbtable]) + "\n\n";

            szProject +=
                '<!DOCTYPE html>\n' +
                '<html>\n' +
                '  \n' +
                '<head>\n' +
                '\t<meta charset="UTF-8">\n' +
                '\t<meta http-equiv="X-UA-Compatible" content="IE=edge">\n' +
                '\t<meta name="viewport" content="width=device-width, initial-scale=1.0">\n' +
                '\t<meta name="description" content="ixmaps embed example">\n' +
                '\t<meta name="author" content="guenter richter">\n' +
                '\t<link rel="shortcut icon" href="https://gjrichter.github.io/ixmaps/ui/resources/images/ixmaps_logo.png">\n' +
                ' \n' +
                '\t<title>iXMaps embedded</title>\n' +
                '</head>\n' +
                ' \n' +
                '<body>\n' +
                ' \n' +
                '\t<!-- here goes the map -->\n' +
                '\t<div id="map-div"></div>\n' +
                ' \n' +
                '\t<!-- include the ixmaps API -->\n' +
                '\t<script src="https://gjrichter.github.io/ixmaps/ui/js/htmlgui_api.js"><\/script>\n' +
                ' \n' +
                '\t<script type="text/javascript" charset="utf-8">\n' +
                ' \n';

            szProject +=
                '\t\t// create and embed the map\n' +
                '\t\t// ! reference to "map-div", the hosting html div\n' +
                '\n' +
                '\t\tixmaps.embed("map-div", {\n' +
                '\t\t\tmapService: "leaflet_vt",\n' +
                '\t\t\tmapType: "'+ (project.map.basemap || "VT_OPENSTREETMAP") +'",\n' +
                '\t\t\tmap: "../../maps/svg/maps/generic/mercator.svg",\n' +
                '\t\t\tname: "map_1",\n' +
                '\t\t\tmode: "pan",\n' +
                '\t\t\tlegend: "true",\n' +
                '\t\t\ttools: "true",\n' +
                '\t\t\tsearch: "Europe",\n' +
                '\t\t\tabout: "test"\n' +
                '\t\t},\n';

            szProject +=
                '\t\tmap => map\n' +
                '\t\t.options({\n' +
                '\t\t\tfeaturescaling: "true",\n' +
                '\t\t\tobjectscaling: "dynamic",\n' +
                '\t\t\tnormalSizeScale: "10000000",\n' +
                '\t\t\tflushChartDraw: "1000000",\n' +
                '\t\t\tbasemapopacity: "0.5",\n' +
                '\t\t\tworksilent: "true",\n' +
                '\t\t\tloadsilent: "true",\n' +
                '\t\t\thideOnPan: "false",\n' +
                '\t\t\tfreezeOnPan: "false"\n' +
                '\t\t})\n' +
                '\t\t.local("working ...", "")\n';
            for (i in project.require ){
               szProject += '\t\t.require("'+project.require[i]+'")\n';
            }
            szProject +=
                '\t\t.attribution("' + project.map.attribution.replace(/\"/g, '\\\"') + '")\n' +
                '\t\t.view(' + szView + ')\n';

            let szThemes = "";
            for (var i in project.themes) {
                let themeObj = project.themes[i];
                let newObj = {};

                szThemes +=
                    '\t\t.layer(ixmaps.layer("generic", layer => layer\n';

                let data = {
                    url: String(themeObj.style.dbtableUrl),
                    type: String(themeObj.style.dbtableType),
                    name: String(themeObj.style.dbtable)
                };
                let dataObj = new Config(data);
                let szData = dataObj.getPrettyString().replace(/\n/g, "\n\t\t\t");;
                szThemes +=
                    '\t\t\t.data(' + szData + ')\n';

                delete themeObj.style.dbtableUrl;
                delete themeObj.style.dbtableType;
                delete themeObj.style.dbtable;

                let binding = {
                    geo: String(themeObj.style.lookupfield)
                };
                if (themeObj.field){
                    binding.value = String(themeObj.field);
                }
                if (themeObj.style.itemfield){
                    binding.id = String(themeObj.style.itemfield);
                }
                let bindingObj = new Config(binding);
                let szBinding = bindingObj.getPrettyString().replace(/\n/g, "\n\t\t\t");;
                szThemes +=
                    '\t\t\t.binding(' + szBinding + ')\n';

                delete themeObj.style.lookupfield;
                delete themeObj.style.itemfield;
                delete themeObj.field;

                szThemes +=
                    '\t\t\t.type("' + themeObj.style.type + '")\n';
                delete themeObj.style.type;

                let style = themeObj.style;
                let styleObj = new Config(style);
                let szStyle = styleObj.getPrettyString().replace(/\n/g, "\n\t\t\t");;
                szThemes +=
                    '\t\t\t.style(' + szStyle + ')\n';
                szThemes +=
                    '\t\t))\n';

            }
            szProject += szThemes;

            szProject +=
                 '\t);\n';

            szProject +=
                '\t<\/script>\n' +
                '<\/body>\n' +
                '<\/html>\n';


            // make the HTML

            var list = "";
            var id = "source-" + dataName;

            list += '<div class="source" style="padding:0.2em 0 0.2em 1em;background:#ffffff">';
            list += '<pre id="' + id + '" class="prettyprint language-HTML">';
            list += '</pre>';
            list += '</div>';

            $("#map_code_div-" + dataName).append(list);

            $("#" + id + "").text(String(szProject));
            hljs.highlightBlock($("#" + id)[0]);

            $(".hljs-attr").attr("onMouseOver", "showTooltip(event,$(this).text())");
            $(".hljs-attr").attr("onMouseOut", "hideTooltip()");

            $("#map_code_div-" + dataName + "_save").show();
        };
        
        var fCode = false;
        __toggleProjectHTML = function(){
            if (fCode){
                $("#map_code_div-project").html(""); 
                $("#map_code_div-project").hide();
                $("#map_code_div-project_save").hide();
            } else {
                __showProjectHTML(ixmaps.map().getProjectString(),'project');
                $("#map_code_div-project").show();
                $("#map_code_div-project_save").show();
            }
            fCode = !fCode;
        };
        
         __copyToClipboard = function() {
            // Get the html code
            var copyText = $("#source-project").text();

            // write the text to the clipboard
            navigator.clipboard.writeText(copyText);

            // Alert the copied text
            alert("HTML code copied to clipboard");
        };
       
        __saveTextAsFile = function(szFilename) {
            var szText = $("#source-project").text();
            var textToWrite = szText;
            var textFileAsBlob = new Blob([textToWrite], {
                type: 'text/plain'
            });
            var fileNameToSaveAs = szFilename || "project.json";

            var downloadLink = document.createElement("a");
            downloadLink.download = fileNameToSaveAs;
            downloadLink.innerHTML = "Download File";
            if (window.URL != null) {
                // Chrome allows the link to be clicked
                // without actually adding it to the DOM.
                downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
            } else {
                // Firefox requires the link to be added to the DOM
                // before it can be clicked.
                downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
                downloadLink.onclick = destroyClickedElement;
                downloadLink.style.display = "none";
                document.body.appendChild(downloadLink);
            }

            downloadLink.click();
        };
        
		// ----------------------------
		// I N F O   P O P U P   
		// ----------------------------

		function toggleInfoPopup() {
			const popup = document.getElementById('infoPopup');
			const overlay = document.getElementById('infoOverlay');
			
			if (popup.classList.contains('active')) {
				popup.classList.remove('active');
				overlay.classList.remove('active');
			} else {
				popup.classList.add('active');
				overlay.classList.add('active');
			}
		}

		// Close popup with Escape key
		document.addEventListener('keydown', function(event) {
			if (event.key === 'Escape') {
				const popup = document.getElementById('infoPopup');
				const overlay = document.getElementById('infoOverlay');
				if (popup.classList.contains('active')) {
					popup.classList.remove('active');
					overlay.classList.remove('active');
				}
			}
		});
        
	</script>

</body>

</html>
