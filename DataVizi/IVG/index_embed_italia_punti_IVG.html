<!DOCTYPE html>
<html>

<!-- **********************************************************************

ixmaps map embed html

$Comment: ixmaps map template; embedded version
$Source : index_only_map_embed.html,v $

$InitialAuthor: guenter richter $
$InitialDate: 2023/04/22 $
$Author: guenter richter $
$Id:index_embed_Open_Data_PNRR_Dati_Universo_REGIS_III.html 1 2023-04-22 00:00:00Z Guenter Richter $

licensed under CC-BY
$Log:index_only_map_embed.html,v $

********************************************************************** -->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="ixmaps embed example">
    <meta name="author" content="guenter richter">
    <link rel="shortcut icon" href="https://gjrichter.github.io/ixmaps/ui/resources/images/ixmaps_logo.png">

    <title>Data VizI</title>
    <meta name="description" content="Le mappe con dati italiani">

    <style>
        a {
            text-decoration: none;
            color: #444444;
        }

        a:hover {
            color: cornflowerblue;
        }

        ul {
            font-family: Raleway;
            padding-inline-start: 1.5em;
        }

        li.active a {
            color: white;
            background-color: #24A2AF;
            xxpadding: 0.2em;
        }

        a.active {
            color: white;
            background-color: #24A2AF;
            xxpadding: 0.2em;
        }

        .sidebar {
            position: absolute;
            right: 5%;
            top: 110px;
            text-align: left;
            font-family: Helvetica;
            font-size: 1.1em;
            line-height: 1.2em;
            max-width: 28%;
            background-color: rgba(247, 246, 239, 0.8)
        }

    </style>
    <style>
        #myRange1,
        #myRange2 {
            vertical-align: -2px;
            accent-color: #888888;
        }

        input[type=range]::-webkit-slider-runnable-track {
            background: #eeeeee;
            border-radius: 1em;
        }

    </style>

</head>

<body style='text-align:center;background:#F7F6EF;margin:0;padding:0'>

    <div id="logo" style="position:absolute;top:25px;right:6%">
        <a href="javascript:__dataTheme()">
            <div style="font-family:helvetica;font-size:48px;line-height:0.8em;font-weight:bold;color:burlywood ;text-align:left">Data<br><span style="font-size:48px;padding-left:2px">Viz</span><em> i</em></div>
        </a>
    </div>


    <div style="margin:auto">


        <div id="map_div"></div>


        <div id="sidebar_div" class="sidebar">
            <p style="font-family:helvetica;font-size:2em;line-height:0.9em;margin:0.5em">
                <b>Punti Interruzione Volontaria di Gravidanza</b>
                <br>
                <span style='font-size:0.7em;line-height:0.5em;color:#888888'>Visualizzazione di dati pubblicati da <a href="https://github.com/ondata/liberiamoli-tutti/tree/main/punti_ivg_regionali" target="_blank" style="color:cadetblue">onData</a> nel ambito 'liberiamoli tutti' raccolti nel contesto del progetto <a href="https://www.epicentro.iss.it/ivg/progetto-ccm-2022" target="_blank" style="color:cadetblue"> CCM 2022</a> del ISS</span>
            </p>
            <ul>
                <li>
                    <a class="select" href="javascript:ixmaps.map().add(__sez_2011_2021_pop_arrow_user())">Punti Interruzione Volontaria di Gravidanza</a>
                    <ul style="padding:0.5em 0 0.5em 1em;">
                        <li>
                            <a class="select active" href="javascript:ixmaps.map().remove('chart').add(__totale_IVG)"> n° totale di IVG </a>
                        </li>
                        <li>
                            <a class="select" href="javascript:ixmaps.map().remove('chart').add(__perc_certificazione_consultorio)"> % certificazione consultorio </a>
                        </li>
                        <li>
                            <a class="select" href="javascript:ixmaps.map().remove('chart').add(__perc_ivg_farmacologiche)"> % IVG famacologiche </a>
                        </li>
                        <li>
                            <a class="select" href="javascript:ixmaps.map().remove('chart').add(__perc_ivg_periodi)"> % IVG x periodo </a>
                        </li>
                        
                        
                        
                        
                        
 
                    </ul>
                </li>
                <li>
                    <a class="select" href="javascript:ixmaps.map().add(__georef_sez2021(),'clear').add(__sez2021_edu_choropleth())">Fondo</a>
                    <ul style="padding:0.5em 0 0.5em 1em;">
                        <li>
                            <a class="select" href="javascript:ixmaps.map().hide('chart_pop_2021')"> - vuoto</a>
                        </li>
                        <li>
                            <a class="select active" href="javascript:ixmaps.map().show('chart_pop_2021')"> - popolazione</a>
                        </li>
                        <li>
                            <a class="select" href="javascript:ixmaps.map().show('chart_pop_2021_choropleth')"> - densità popolazione</a>
                        </li>
                    </ul>
                </li>
            </ul>
                <div style="position:relative;top:0px;left:20px">
        <p style='font-family:open sans;color:#888888;z-index:999999'>
            <span style="font-size:0.8em">grandezza grafici:</span>
            <input type='range' min='0.1' max='2' step="0.01" value='1' class='slider' id='myRange1'>
            <!--
            <span style="font-size:0.6em">aggregazione: da 5
                <input type='range' min='5' max='100' step="5" value='100' class='slider' id='myRange2'> a 100 pixel</span>
            -->
        </p>
    </div>

        </div>

        <div id="map_code_div-project" style="position:absolute;top:10px;left:10px;text-align:left;width:50%;height:800px;overflow:auto;display:none;xxbox-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);"></div>
    </div>

    <!-- ------------------------------------- -->
    <!--                                       -->
    <!-- c o d e                         -->
    <!--                                       -->
    <!-- ------------------------------------- -->

    <!--========================================================================= -->

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
	<script type="text/javascript" src="https://gjrichter.github.io/ixmaps_test/ui/js/htmlgui_api.js"></script>


    <!--========================================================================= -->

    <script type="text/javascript" charset="utf-8">
        /** 
         ** change background color on select
         **/

        __select = (el) => {
            $(".select").removeClass("active");
            el.addClass("active");
        };
        $(".select").attr("onclick", "__select($(this))");
        
        var setChartSize = function(nValue) {
            ixmaps.changeThemeStyle(null, 'chart', 'scale:' + nValue, 'set');
            ixmaps.changeThemeStyle(null, 'chart_procom_all', 'scale:' + nValue, 'set');
        }
        var setGrid = function(nValue) {
            ixmaps.changeThemeStyle(null, 'chart', 'gridwidthpx:' + nValue, 'set');
            ixmaps.changeThemeStyle(null, 'chart_grid', 'gridwidthpx:' + nValue, 'set');

        }
        var slider = document.getElementById("myRange1");
        // Update the current slider value (each time you drag the slider handle)
        slider.oninput = function() {
            if (ixmaps.sliderT1) {
                clearTimeout(ixmaps.sliderT1);
            }
            ixmaps.value = this.value;
            ixmaps.sliderT1 = setTimeout(function() {
                setChartSize(ixmaps.value)
            }, 10);
        }
        /**
        slider = document.getElementById("myRange2");
        // Update the current slider value (each time you drag the slider handle)
        slider.oninput = function() {
            if (ixmaps.sliderT2) {
                clearTimeout(ixmaps.sliderT2);
            }
            ixmaps.value = this.value;
            ixmaps.sliderT2 = setTimeout(function() {
                setGrid(ixmaps.value)
            }, 250);
        }
        **/

        // ---------------------------------------------------
        // ---------------------------------------------------
        //
        // t h e   m a p 
        //
        // ---------------------------------------------------
        // ---------------------------------------------------

        /**
         ** ************************************
         ** define the ixmaps themes and project
         ** ************************************
         **/

        var __filter = "";
        var __lat = null;
        var __lon = null;
        var __zoom = null;
        var __scale_chart = 1;
        var __legend = true;

        /**
         ** strings used by the map 	
         **/

        attribution =
            "powered by <a href=\"http://ixmaps.com\" target=\"_blank\">iXMaps</a>";

        /**
         ** get query params and adapt theme and project definitions 	
         **/

        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });

        if (params.filter) {
            __filter = params.filter;
        }

        if (params.view) {
            var latlonA = params.view.split('[')[1].split(']')[0].split(',');
            __lat = latlonA[0];
            __lon = latlonA[1];
            __zoom = parseFloat(params.view.split(',')[2]);
            //setTimeout("ixmaps.setView(null,"+params.view+")",1000);
        };

        if (params.scale) {
            __scale_chart = params.scale;
        };

        if (params.legend) {
            __legend = params.legend;
        };

        const nuts2 =
            ixmaps.layer("nuts2", layer => layer
                .type("FEATURES|SILENT|NOLEGEND")
                .data({
                    url: "https://gisco-services.ec.europa.eu/distribution/v2/nuts/geojson/NUTS_RG_10M_2021_4326_LEVL_2.geojson",
                    type: "geojson"
                })
                .binding({
                    id: "NUTS_ID"
                })
                .filter("WHERE CNTR_CODE = IT")
                .style({
                    colorscheme: [
                        "white"
                    ],
                    fillopacity: "0.8",
                    linecolor: "#F7F6EF",
                    linewidth: "2",
                    showdata: true,
                    featurelower: "1:1000000",
                    titlefield: "NUTS_NAME",
                    name: "nuts2"
                })
            );
        
        /* 2. last istat data (2022), for changes since 2011 */
        __georef = () => {
            return ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-central-1.amazonaws.com/maps.ixmaps.com/Istat/comuni_2022/Com01012022_s_WGS84.topojson.gz",
                    type: "topojson"
                })
                .binding({
                    id: "PRO_COM_T",
                    position: "geometry"
                })
                .type("FEATURES|NOLEGEND")
                .style({
                    colorscheme: ["none"],
                    linecolor: "none",
                    linewidth: "0.3",
                    sizefield: "Shape_Area"
                })
            );
        };
        
        /* 1. centroids of 2011, by curtesy of Andrea Borruso */
        __georef_urban = () => {
            return ixmaps.layer("ITALIA_Comuni_2022_urban", layer => layer
                .data({
                    url: "https://raw.githubusercontent.com/aborruso/centroidiurbanfabric/master/output/ElencoUnitaAmministrative2011.geojson",
                    type: "geojson"
                })
                .binding({
                    id: "PRO_COM",
                    position: "geometry"
                })
                .type("FEATURES|NOLEGEND")
                .style({
                    colorscheme: ["none"],
                    linecolor: "none",
                    linewidth: "1",
                    scale: "0.0001"
                })
            );
        };

        __pop_2021_pop_procom = () => {
            return ixmaps.layer("ITALIA_Comuni_2022_urban", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISTAT/Censimenti/2011/all_indicatori_2011_procom.csv.gz",
                    type: "csv",
                    name: "pop_2021"
                })
                .type("CHART|SYMBOL|SIZE")
                .binding({
                    value: "P1",
                    position: "PROCOM",
                    tonumber: true
                })
                .style({
                    colorscheme: [
                        "none"
                        ],
                    symbols: "circle",
                    linecolor: "#C4C3BD",
                    linewidth: "3",
                    units: "",
                    showdata: true,
                    scale: "1",
                    sizepow: "2",
                    normalsizevalue: 500000,
                    fillopacity: 0.8
                })
                .meta({
                    name: "chart_pop_2021",
                    title: "popolazione2021",
                    tooltip: "{{theme.title}}: {{theme.item.value}}{{theme.item.chart}}{{theme.item.data}}"

                })
            );
        };

        __pop_2021_pop_procom_choropleth = () => {
            return ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISTAT/Censimenti/2021/all_indicatori_2021_procom.csv.gz",
                    type: "csv",
                    name: "pop_2021"
                })
                .type("CHOROPLETH|LOG|DENSITY")
                .binding({
                    value: "P1",
                    position: "PROCOM"
                })
                .style({
                    colorscheme: [
                        "7",
                        "#FEFDFF",
                        "#888A56",
                        "dynamic",
                        "warm"
                        ],
                    units: "",
                    showdata: true,
                    scale: "1",
                    fillopacity: 0.5,
                    lookupdigits: "6"
                })
                .meta({
                    name: "chart_pop_2021_choro",
                    title: "popolazione 2021",
                    tooltip: "<div style='white-space:nowrap'>{{theme.title}}<h2 style='margin:0.2em 0'>{{COMUNE}}</h2><h3>{{P1}} abitanti</h3></div>"

                })
            );
        };

        __strutture =
        ixmaps.layer("ITALIA_Comuni_2022", layer => layer
            .data({
                url: "https://raw.githubusercontent.com/ondata/liberiamoli-tutti/refs/heads/main/punti_ivg_regionali/data/punti_ivg_regionali.csv",
                type: "csv",
                name: "strutture"
            })
            .type("CHART|USER|AGGREGATE|VALUES")
            .binding({
                value: "n_totale_ivg",
                position: "comune_codice_istat",
            })
            .style({
                userdraw: "pinnacleChart",
                colorscheme: [
                    "green"
                ],
                units: "",
                scale: "1",
                rangescale: "0.1",
                normalsizevalue: 100,
                showdata: "true"
            })
            .meta({
                name: "chart",
                title: "Strutture e n° totale di IVG",
                tooltip: "{{theme.item.data}}"

            })
        );
        
        __totale_IVG =
        ixmaps.layer("ITALIA_Comuni_2022", layer => layer
            .data({
                url: "https://raw.githubusercontent.com/ondata/liberiamoli-tutti/refs/heads/main/punti_ivg_regionali/data/punti_ivg_regionali.csv",
                type: "csv",
                name: "strutture"
            })
            .type("CHART|USER|3D|AGGREGATE|VALUES")
            .binding({
                value: "n_totale_ivg",
                title: "comune",
                position: "comune_codice_istat",
            })
            .style({
                userdraw: "pinnacleChart",
                colorscheme: [
                    "green"
                ],
                units: "",
                scale: "1",
                rangescale: "0.1",
                normalsizevalue: 100,
                showdata: "true",
                titleupper: "1:100000"
            })
            .meta({
                name: "chart",
                title: "Strutture e n° totale di IVG",
                tooltip: "{{theme.item.chart}}{{theme.item.data}}"

            })
        );
        
        __perc_certificazione_consultorio =
        ixmaps.layer("ITALIA_Comuni_2022", layer => layer
            .data({
                url: "https://raw.githubusercontent.com/ondata/liberiamoli-tutti/refs/heads/main/punti_ivg_regionali/data/punti_ivg_regionali.csv",
                type: "csv",
                name: "strutture"
            })
            .type("CHART|USER|AGGREGATE|MEAN|VALUES")
            .binding({
                value: "perc_certificazione_consultorio",
                position: "comune_codice_istat",
            })
            .style({
                userdraw: "pinnacleChart",
                colorscheme: [
                    "green"
                ],
                units: "%",
                scale: "1",
                sizepow: "1",
                rangescale: "0.1",
                normalsizevalue: 50,
                showdata: "true"
            })
            .meta({
                name: "chart",
                title: "percentuale certificazione consultorio ",
                tooltip: "{{theme.item.data}}"

            })
        );
        
        __perc_ivg_farmacologiche =
        ixmaps.layer("ITALIA_Comuni_2022", layer => layer
            .data({
                url: "https://raw.githubusercontent.com/ondata/liberiamoli-tutti/refs/heads/main/punti_ivg_regionali/data/punti_ivg_regionali.csv",
                type: "csv",
                name: "strutture"
            })
            .type("CHART|PIE|SIZEP3|AUTOCOMPLETE|AGGREGATE|VALUES|CIRCULARBOX|BOTTOMTITLE")
            .binding({
                value: "n_ivg_farmacologiche",
                value100: "n_totale_ivg",
                size: "n_totale_ivg",
                title: "comune",
                position: "comune_codice_istat",
            })
            .style({
                 colorscheme: [
                    "#44C2BF"
                ],
                nodatacolor: "#ffffff",
                valuecolor: "#14828F",
                textcolor: "#444444",
                shadow: "true",
                units: "%",
                scale: "1",
                sizepow: "1",
                rangescale: "0.1",
                normalsizevalue: 500,
                boxopacity: 0.5,
                boxupper: "1:1000000",
                showdata: "true"
            })
            .meta({
                name: "chart",
                title: "percentuale IVG farmacologiche ",
                tooltip: "{{theme.item.data}}"

            })
        );

        __perc_ivg_periodi =
        ixmaps.layer("ITALIA_Comuni_2022", layer => layer
            .data({
                url: "https://raw.githubusercontent.com/ondata/liberiamoli-tutti/refs/heads/main/punti_ivg_regionali/data/punti_ivg_regionali.csv",
                type: "csv",
                name: "strutture"
            })
            .type("CHART|PIE|SIZE|MULTIPLE|UP|AUTOCOMPLETE|MEAN|BOX|BOTTOMTITLE|SIMPLELEGEND")
            .binding({
                value: ["perc_ivg_leq_8_sett","perc_ivg_9_10_sett","perc_ivg_11_12_sett"],
                size: "n_totale_ivg",
                title: "comune",
                position: "comune_codice_istat",
            })
            .style({
                 colorscheme: [
                    "#639754",
                    "#FFD301",
                    "#E03C32" 
                ],
                label: [
                    "% IVG entro 8 settimane",
                    "% IVG da 9 a 10 settimane",
                    "% IVG da 11 12 settimane"
                ],
                valuecolor: "#14828F",
                textcolor: "#444444",
                shadow: "false",
                units: "%",
                scale: "1",
                sizepow: "2",
                rangescale: "0.1",
                normalsizevalue: 500,
                bordercolor: "black",
                boxopacity: 0.0005,
                titleupper: "1:1000000",
                valuesupper: "1:1000000",
                showdata: "true"
            })
            .meta({
                name: "chart",
                title: "percentuali IVG per periodo gravidanza",
                tooltip: "{{theme.item.title}} - {{struttura_nome}}</br></br>{{theme.item.chart}}</br>{{theme.item.data}}"

            })
        );

        
        // ---------------------------------------------------
        // e m b e d   t h e   m a p  
        // ---------------------------------------------------

        /**
         **
         ** create the interactive map an append it to the document 
         **
         **/

        ixmaps.embed("map_div", {
                mapService: "leaflet_vt",
                mapType: "VT_TONER_LITE",
                map: "../../maps/svg/maps/generic/mercator.svg",
                legend: ((__legend == true) ? "true" : 0),
                align: "left",
                mode: "pan",
                about: "test",
                search: "Italy"
            },
            map => map

            .view({
                "center": {
                    "lat": "42.30234655149951",
                    "lng": "13.987399620595363"
                },
                "zoom": "6.27681771091248"
            })
            .options({
                featurescaling: "true",
                objectscaling: "dynamic",
                normalSizeScale: "2000000",
                dynamicScalePow: "1.7",
                flushChartDraw: "1000000",
                flushPaintShape: "1000000",
                basemapopacity: "0.5",
                hideOnPan: "false",
                freezeOnPan: "true"
            })
            .local("aggregated", "")
            .local("... creating theme ...", "...")
            .local("loading data ...", "scaricando dati ...")
            .require("../../ui/js/tools/tooltip_mustache.js")
            .require("https://d3js.org/d3.v3.min.js")
            .require("https://gjrichter.github.io/pages/DataVizi/js/chart.js")
            .require("https://gjrichter.github.io/pages/DataVizi/js/arrow_chart.js")
            .attribution(attribution)
            //.legend("<h1 style='padding:0.2em 0.5em;border-radius:0.5em;background:RGBA(255,255,255,0.5)'>Variazione della <span style='color:#884488'>fascia d'età 65+  (%)</span> dal 2003 al 2023 </h1>")		 

            // -----------------------------		 
            // the data visualization layer 
            // -----------------------------

            .layer(nuts2)
            .layer(__georef())
            .layer(__georef_urban())
            .layer(__pop_2021_pop_procom_choropleth())
            .layer(__pop_2021_pop_procom())
            .layer(__totale_IVG)
         );

        /**
         **
         ** window size handling
         **
         **/

        $(window).resize(function() {
            $("#regis_map").css("height", (window.innerHeight - 5) + "px");
        });

        ixmaps.htmlgui_onZoomAndPan = function() {

            var nOpacity = (ixmaps.getZoom() - 7) / 20;
            ixmaps.setBasemapOpacity(null, nOpacity, "absolute");
        };

        // ----------------------------------------------
        // show actual map HTML page
        // ----------------------------------------------

        var fCode = false;
        const __openSidebar = (url) => {
            const $sidebar = $("#map_code_div-project");
            $sidebar.load(url, (response, status, xhr) => {
                if (status === "error") {
                    alert(`Sorry but there was an error: ${xhr.status}\n${xhr.statusText}`);
                }
            });
        };

        __dataTheme = function() {
            if (fCode) {
                $("#map_code_div-project").html("");
                $("#map_code_div-project").hide();
            } else {
                __openSidebar('../../../pages/ISPRA/show_map_HTML.html');
                $("#map_code_div-project").show();
            }
            fCode = !fCode;
        }

    </script>

</body>

</html>
