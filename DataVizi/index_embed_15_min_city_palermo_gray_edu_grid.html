<!DOCTYPE html>
<html>

<!-- **********************************************************************

ixmaps map embed html

$Comment: ixmaps map template; embedded version
$Source : index_only_map_embed.html,v $

$InitialAuthor: guenter richter $
$InitialDate: 2023/04/22 $
$Author: guenter richter $
$Id:index_embed_Open_Data_PNRR_Dati_Universo_REGIS_III.html 1 2023-04-22 00:00:00Z Guenter Richter $

licensed under CC-BY
$Log:index_only_map_embed.html,v $

********************************************************************** -->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="ixmaps embed example">
    <meta name="author" content="guenter richter">
    <link rel="shortcut icon" href="https://gjrichter.github.io/ixmaps/ui/resources/images/ixmaps_logo.png">

    <title>Data VizI</title>
    <meta name="description" content="Le mappe con dati italiani">

    <style>
        a {
            text-decoration: none;
            color: #444444;
        }

        a:hover {
            color: cornflowerblue;
        }

        ul {
            font-family: Raleway;
            padding-inline-start: 1.5em;
        }

        li.active a {
            color: white;
            background-color: #24A2AF;
            xxpadding: 0.2em;
        }

        a.active {
            color: white;
            background-color: #24A2AF;
            xxpadding: 0.2em;
        }

        .sidebar {
            position: absolute;
            right: 5%;
            top: 120px;
            text-align: left;
            font-family: Helvetica;
            font-size: 1.1em;
            line-height: 1.2em;
            max-width: 28%;
            background-color: rgba(247, 246, 239, 0.8)
        }

    </style>

</head>

<body style='text-align:center;background:#F7F6EF;margin:0;padding:0'>

    <!--
    <div id="logo" style="position:absolute;top:30px;right:90px"><div style="font-family:helvetica;font-size:40px;line-height:0.7em;font-weight:bold;color:burlywood ;text-align:left">Italia<br><span style="font-size:33px">inDati</span></div></div>
    -->

    <div id="logo" style="position:absolute;top:25px;right:6%">
        <a href="javascript:__dataTheme()">
            <div style="font-family:helvetica;font-size:48px;line-height:0.8em;font-weight:bold;color:burlywood ;text-align:left">Data<br><span style="font-size:48px;padding-left:2px">Viz</span><em> i</em></div>
        </a>
    </div>
    <div style="margin:auto">

        <div id="map_div"></div>

        <div id="sidebar_div" class="sidebar" style="border-radius:0.5em">
            <ul>
                <p style="font-family:helvetica;font-size:2em;margin-bottom:0">
                    <b>15 min - City</b>
                </p>
                <hr>
                <p>Visualizzazione di dati recuperati dalla piattaforma <a href="https://whatif.sonycsl.it/15mincity/15mincity.php" target="_blank" style="color:cadetblue">'15min-City'</a> dal Sony CSL</p>
                <li style='margin-left:15px'>
                    <a class="select active" href="javascript:ixmaps.map().remove('choropleth').add(__theme_var('a_f'))">Average Accessibility</a>
                </li>
                <ul style='margin-left:2px'>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().changeThemeStyle('choropleth','field:b_f')"> - outdoor activities</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().changeThemeStyle('choropleth','field:c_f')"> - learning</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().changeThemeStyle('choropleth','field:d_f')"> - supplies</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().changeThemeStyle('choropleth','field:e_f')"> - eating</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().changeThemeStyle('choropleth','field:f_f')"> - moving</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().changeThemeStyle('choropleth','field:g_f')"> - cultural activities</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().changeThemeStyle('choropleth','field:h_f')"> - physical exercise</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().changeThemeStyle('choropleth','field:i_f')"> - services</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().changeThemeStyle('choropleth','field:l_f')"> - healthcare</a>
                    </li>
                </ul>
                <br>
                <div id="legend-classesgeneric" class="legend-item-list" style="overflow:hidden">
                    <div valign="center" class="theme-legend-item" style="margin-bottom:0.5em;margin-right:1em;" onclick="javascript:ixmaps.markThemeClass(&quot;choropleth&quot;,0);event.stopPropagation();return false;">
                        <div>
                            <div style="margin-top:0.2em;margin-bottom:0em;align"><span style="line-height:5px"><a class="legend-color-button" style="pointer-events:all" href="#" title="click to see"><span style="background:#FBFBF7;opacity:0.7;font-size:1em;border-radius:1em;border:solid black 0.1px;margin-right:1em;width:1em;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></a></span><span class="theme-legend"><a class="theme-button" style="pointer-events:all" href="#" title="click to see"><span title="<= 15 min" style=""><span>&lt;= 15 min</span></span></a></span></div>
                        </div>
                    </div>
                    <div valign="center" class="theme-legend-item" style="margin-bottom:0.5em;margin-right:1em;" onclick="javascript:ixmaps.markThemeClass(&quot;choropleth&quot;,1);event.stopPropagation();return false;">
                        <div>
                            <div style="margin-top:0.2em;margin-bottom:0em;width:align"><span style="line-height:5px"><a class="legend-color-button" style="pointer-events:all" href="#" title="click to see"><span style="background:#bbaa99;opacity:0.7;font-size:1em;border-radius:1em;margin-right:1em;width:1em;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></a></span><span class="theme-legend"><a class="theme-button" style="pointer-events:all" href="#" title="click to see"><span title="da 16 a 30 min" style=""><span>da 16 a 30 min</span></span></a></span></div>
                        </div>
                    </div>
                    <div valign="center" class="theme-legend-item" style="margin-bottom:0.5em;margin-right:1em;" onclick="javascript:ixmaps.markThemeClass(&quot;choropleth&quot;,2);event.stopPropagation();return false;">
                        <div>
                            <div style="margin-top:0.2em;margin-bottom:0em;align"><span style="line-height:5px"><a class="legend-color-button" style="pointer-events:all" href="#" title="click to see"><span style="background:#444444;opacity:0.7;font-size:1em;border-radius:1em;margin-right:1em;width:1em;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></a></span><span class="theme-legend"><a class="theme-button" style="pointer-events:all" href="#" title="click to see"><span title="più di 30 min" style=""><span>più di 30 min</span></span></a></span>
                            </div>
                        </div>
                    </div>
                </div>

            </ul>
        </div>

        <div id="map_code_div-project" style="position:absolute;top:10px;left:10px;text-align:left;width:50%;height:800px;overflow:auto;display:none;xxbox-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);"></div>
        
        <!-- ------------------------------------- -->
        <!--                                       -->
        <!-- c o d e                         -->
        <!--                                       -->
        <!-- ------------------------------------- -->

        <!--========================================================================= -->

        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
	    <script type="text/javascript" src="https://gjrichter.github.io/ixmaps_test/ui/js/htmlgui_api.js"></script>

        <!--========================================================================= -->

        <script type="text/javascript" charset="utf-8">
            /** 
             ** change background color on select
             **/

            __select = (el) => {
                $(".select").removeClass("active");
                el.addClass("active");
            };
            $(".select").attr("onclick", "__select($(this))");

            // ---------------------------------------------------
            // ---------------------------------------------------
            //
            // t h e   m a p 
            //
            // ---------------------------------------------------
            // ---------------------------------------------------

            /**
             ** ************************************
             ** define the ixmaps themes and project
             ** ************************************
             **/

            var __filter = "";
            var __lat = null;
            var __lon = null;
            var __zoom = null;
            var __scale_chart = 1;
            var __legend = true;

            /**
             ** strings used by the map 	
             **/

            attribution =
                "powered by <a href=\"http://ixmaps.com\" target=\"_blank\">iXMaps</a>";

            /**
             ** get query params and adapt theme and project definitions 	
             **/

            const params = new Proxy(new URLSearchParams(window.location.search), {
                get: (searchParams, prop) => searchParams.get(prop),
            });

            if (params.filter) {
                __filter = params.filter;
            }

            if (params.view) {
                var latlonA = params.view.split('[')[1].split(']')[0].split(',');
                __lat = latlonA[0];
                __lon = latlonA[1];
                __zoom = parseFloat(params.view.split(',')[2]);
                //setTimeout("ixmaps.setView(null,"+params.view+")",1000);
            };

            if (params.scale) {
                __scale_chart = params.scale;
            };

            if (params.legend) {
                __legend = params.legend;
            };

            // ---------------------------------------------------
            // t h e   d a t a 
            // ---------------------------------------------------

            // ---------------------------------------------------
            // t h e   l a y e r 
            // ---------------------------------------------------

            /**
             ** define layer with reference shapes (comuni, province, regioni ) 
             **/
            var process = (data) => {
                var i = 0;
                data.addColumn({
                    destination: "id"
                }, (row) => {
                    return i++
                });
            }

            var __georef =
                ixmaps.layer("hexes", layer => layer
                    .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/SonyLabRome/sony_15_min_palermo.hexes.geojson.gz",
                        type: "geojson",
                        name: "data33503953296494804",
                        process: process.toString()
                    })
                    .binding({
                        geo: "geometry",
                        id: "id"
                    })
                    .type("FEATURE|ZOOMTO|NOLEGEND")
                    .style({
                        "colorscheme": [
                            "none"
                        ],

                        linecolor: "none",
                        "nodatacolor": "#B35667",
                        "opacity": "1",
                        "fillopacity": "0.9",
                        "shadow": "false",
                        "visible": "true",
                        "units": "",
                        "title": "[title]",
                        "snippet": "",
                        "tooltip": "{{theme.item.chart}}{{theme.item.data}}"
                    })
                );

            var __georef_sez2021 =
                ixmaps.layer("sezioni_2021", layer => layer
                    .data({
                        url: "https://s3.eu-central-1.amazonaws.com/maps.ixmaps.com/Istat/basi_territoriali_2021/R19_21_P.topojson.gz",
                        type: "topojson"
                    })
                    .binding({
                        id: "SEZ21_ID",
                        size: "SHAPE_Area"
                    })
                    .filter("WHERE PRO_COM like \"82053|82006\"")
                    .style({
                        colorscheme: ["none"],
                        opacity: "1",
                        linecolor: "none",
                        linewidth: "0.3",
                    })
                );

            var __edu_sez2021 =
                ixmaps.layer("sezioni_2021", layer => layer
                    .data({
                        url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISTAT/Censimenti/2021/R19_indicatori_2021_sezioni.csv.gz",
                        type: "csv",
                        name: "R11_DatiCPA_2021"
                    })
                    .type("CHART|SYMBOL|DOMINANT|DEVIATION|NOSORT|VALUES|AGGREGATE|SUM|RELOCATE|FAST|AUTOSIZE|CLEAR|LEGEND")
                    .binding({
                        value: "P90|P89|P88|P87|P86",
                        value100: "P83",
                        size: "P83",
                        position: "SEZ21_ID",
                        tonumber: true
                    })
                    .filter("WHERE PROCOM like \"82053|82006\" AND SEZ21_ID not \"151468888888\"")
                    .style({
                        colorscheme: [
                            "red",
                            "orange",
                            "cyan",
                            "green",
                            "yellow"
                        ],
                        label: [
                            "Titoli terziari",
                            "Diploma di scuola superiore",
                            "Licenza media",
                            "Licenza elementare",
                            "Senza titolo di studio"
                        ],
                        shadow: "true",
                        units: "",
                        scale: 0.9,
                        valuefield: "P83",
                        showdata: "true",
                        gridwidth: "25px",
                        symbols: [
                            "circle"
                        ]
                    })
                    .meta({
                        title: "<p style='font-size:0.7em;line-height:1.3em'>Popolazione residente - 2021, totale di 9 anni e più, colorato con grado di istruzione (%) sopra alla media, sezioni di censimento aggregati, fonte <a href='https://www.istat.it/notizia/dati-per-sezioni-di-censimento/' target='_blank' style='color:cadetblue;text-decoration:none'>ISTAT</a></p> ",
                        tooltip: "Popolazione residente - totale di 9 anni e più - e grado istruzione predominante.<br><br>{{theme.item.count}} sezioni di censimento aggregati:<br><br> {{theme.item.chart}}  <br>educazione dominante: <h2>{{theme.item.label}}</h2> "

                    })
                );

            /**
             ** visualizzation themes 
             **/

            var __theme_var = function(variable) {
                return (
                    ixmaps.layer("hexes", layer => layer
                        .data({
                        url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/SonyLabRome/sony_15_min_palermo.hexes.geojson.gz",
                            type: "geojson",
                            name: "data33503953296494804"
                        })
                        .binding({
                            geo: "id",
                            value: variable,
                            alpha: "population"
                        })
                        .type("CHOROPLETH|NOLEGEND")
                        .style({
                            colorscheme: [
                                "#FBFBF7",
                                "#bbaa99",
                                "#444444"
                            ],
                            label: [
                                "<= 15 min",
                                "da 16 a 30 min",
                                "più di 30 min"
                            ],
                            nodatacolor: "#B35667",
                            linecolor: "none",
                            fillopacity: "0.5",
                            shadow: "false",
                            visible: "true",
                            showdata: "true",
                            ranges: [
                                "0",
                                "15",
                                "30",
                                "1000"
                            ],
                            units: "",
                            refreshtimeout: "0",
                            valuescale: "1",
                            valuedecimals: "0",
                            name: "choropleth",
                            title: " ",
                            snippet: "<br>tempo medio a piedi per raggiungere i vari servizi",
                            tooltip: "<h2 style='margin:0; white-space:nowrap'>{{theme.item.value}} min</h1>"
                        })
                    ));
            };


            var __theme =
                ixmaps.layer("hexes", layer => layer
                    .data({
                        url: "../../pages/test/data/sony_15_min_roma.hexes.geojson",
                        type: "geojson",
                        name: "data33503953296494804"
                    })
                    .binding({
                        geo: "id",
                        value: "a_f",
                        alpha: "population"
                    })
                    .type("CHOROPLETH|DOPACITYMAX|SIMPLELEGEND")
                    .style({
                        colorscheme: [
                            "#5C85B1",
                            "#699BC9",
                            "#78AFD2",
                            "#97C4DE",
                            "#B9D9E9",
                            "#D4E7F1",
                            "#E9F1F6",
                            "#F9F8F8",
                            "#FCECE3",
                            "#FCDBCA",
                            "#F8C3AC",
                            "#ECA693",
                            "#DE887E",
                            "#CE686F",
                            "#B35667"
                        ],
                        nodatacolor: "#B35667",
                        opacity: "1",
                        shadow: "false",
                        visible: "true",
                        showdata: "true",
                        ranges: [
                            "0",
                            "2",
                            "4",
                            "6",
                            "8",
                            "10",
                            "12",
                            "14",
                            "16",
                            "18",
                            "20",
                            "22",
                            "24",
                            "26",
                            "28",
                            "30",
                            "1000"
                        ],
                        units: "",
                        refreshtimeout: "0",
                        valuescale: "1",
                        valuedecimals: "0",
                        dopacitypow: 2,
                        dopacityscale: 5,
                        name: "choropleth",
                        title: "Tempo medio a piedi",
                        snippet: "",
                        tooltip: "<h2 style='margin:0; white-space:nowrap'>{{theme.item.value}} min</h1>"
                    })
                );

            var __theme_b =
                ixmaps.layer("hexes", layer => layer
                    .data({
                        url: "../../pages/test/data/sony_15_min_roma.hexes.geojson",
                        type: "geojson",
                        name: "data33503953296494804"
                    })
                    .binding({
                        geo: "id",
                        value: "b_f",
                        alpha: "population"
                    })
                    .type("CHOROPLETH|DOPACITYMAX|SIMPLELEGEND")
                    .style({
                        colorscheme: [
                            "#5C85B1",
                            "#699BC9",
                            "#78AFD2",
                            "#97C4DE",
                            "#B9D9E9",
                            "#D4E7F1",
                            "#E9F1F6",
                            "#F9F8F8",
                            "#FCECE3",
                            "#FCDBCA",
                            "#F8C3AC",
                            "#ECA693",
                            "#DE887E",
                            "#CE686F",
                            "#B35667"
                        ],
                        nodatacolor: "#B35667",
                        opacity: "1",
                        shadow: "false",
                        visible: "true",
                        showdata: "true",
                        ranges: [
                            "0",
                            "2",
                            "4",
                            "6",
                            "8",
                            "10",
                            "12",
                            "14",
                            "16",
                            "18",
                            "20",
                            "22",
                            "24",
                            "26",
                            "28",
                            "30",
                            "1000"
                        ],
                        units: "",
                        refreshtimeout: "0",
                        valuescale: "1",
                        valuedecimals: "0",
                        dopacitypow: 2,
                        dopacityscale: 5,
                        name: "choropleth",
                        title: "Average time",
                        snippet: "",
                        tooltip: "<h2 style='margin:0; white-space:nowrap'>{{theme.item.value}} min</h1>"
                    })
                );



            // ---------------------------------------------------
            // e m b e d   t h e   m a p  
            // ---------------------------------------------------

            /**
             **
             ** create the interactive map an append it to the document 
             **
             **/

            ixmaps.embed("map_div", {
                    mapService: "leaflet_vt",
                    mapType: "VT_TONER_LITE",
                    map: "../../maps/svg/maps/generic/mercator.svg",
                    legend: ((__legend == true) ? "true" : 0),
                    align: "18%right",
                    mode: "pan",
                    about: "test"
                },
                map => map

                .view({
                    "center": {
                        "lat": "38.12835326305535",
                        "lng": "13.41073282123146"
                    },
                    "zoom": "12.509595147200775"
                })
                .options({
                    featurescaling: "true",
                    objectscaling: "dynamic",
                    normalSizeScale: "5000000",
                    flushChartDraw: "1000000",
                    flushPaintShape: "1000000",
                    basemapopacity: "0.5",
                    panhidden: "false"
                })
                .local("aggregated", "")
                .local("... creating theme ...", "...")
                .local("loading data ...", "scaricando dati ...")
                .require("../../ui/js/tools/tooltip_mustache.js")
                .attribution(attribution)
                //.legend("<h1 style='padding:0.2em 0.5em;border-radius:0.5em;background:RGBA(255,255,255,0.5)'>Variazione della <span style='color:#884488'>fascia d'età 65+  (%)</span> dal 2003 al 2023 </h1>")		 

                // -----------------------------		 
                // the data visualization layer 
                // -----------------------------

                .layer(__georef)
                .layer(__theme_var('a_f'))
                .layer(__georef_sez2021)
                .layer(__edu_sez2021)
            );

            /**
             **
             ** window size handling
             **
             **/

            $(window).resize(function() {
                $("#regis_map").css("height", (window.innerHeight - 5) + "px");
            });
            // ----------------------------------------------
            // things to do on zoom and pan
            // ----------------------------------------------

            ixmaps.htmlgui_onZoomAndPan = function() {
                return;
                var nOpacity = (ixmaps.getZoom() - 7) / 10;
                ixmaps.setBasemapOpacity(null, nOpacity, "absolute");
            }

            // ----------------------------------------------
            // show actual map HTML page
            // ----------------------------------------------

            var fCode = false;
            const __openSidebar = (url) => {
                const $sidebar = $("#map_code_div-project");
                $sidebar.load(url, (response, status, xhr) => {
                    if (status === "error") {
                        alert(`Sorry but there was an error: ${xhr.status}\n${xhr.statusText}`);
                    }
                });
            };

            __dataTheme = function() {
                if (fCode) {
                    $("#map_code_div-project").html("");
                    $("#map_code_div-project").hide();
                } else {
                    __openSidebar('./show_map_HTML.html');
                    $("#map_code_div-project").show();
                }
                fCode = !fCode;
            }

        </script>

</body>

</html>
