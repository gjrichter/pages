<!DOCTYPE html>
<html>

<!-- **********************************************************************

ixmaps map embed html

$Comment: ixmaps map template; embedded version
$Source : index_only_map_embed.html,v $

$InitialAuthor: guenter richter $
$InitialDate: 2023/04/22 $
$Author: guenter richter $
$Id:index_embed_Open_Data_PNRR_Dati_Universo_REGIS_III.html 1 2023-04-22 00:00:00Z Guenter Richter $

licensed under CC-BY
$Log:index_only_map_embed.html,v $

********************************************************************** -->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="ixmaps embed example">
    <meta name="author" content="guenter richter">
    <link rel="shortcut icon" href="https://gjrichter.github.io/ixmaps/ui/resources/images/ixmaps_logo.png">

    <title>Data VizI</title>
    <meta name="description" content="Le mappe con dati italiani">

    
    <style>
        a {
            text-decoration: none;
            color: #444444;
        }

        a:hover {
            color: cornflowerblue;
        }

        ul {
            font-family: Raleway;
            padding-inline-start: 1.5em;
        }

        li.active a {
            color: white;
            background-color: #24A2AF;
            xxpadding: 0.2em;
        }

        a.active {
            color: white;
            background-color: #24A2AF;
            xxpadding: 0.2em;
        }

        .sidebar {
            position: absolute;
            right: 5%;
            top: 110px;
            text-align: left;
            font-family: Helvetica;
            font-size: 1.1em;
            line-height: 1.2em;
            max-width: 28%;
            padding: 0 0.7em;
            background-color: RGBA(255,255,255,0.8);
            z-index: 99999;
        }

        H1 {
            line-height: 1em;
            margin-top: 0.3em;
        }
        
        #logo a:hover{
            text-decoration: none;
        }
        
        /* Track */
        ::-webkit-scrollbar-track {
            background: #f0f0f0
        }

    </style>
    <style>
        #myRange1,
        #myRange2 {
            vertical-align: -2px;
            accent-color: #888888;
        }

        input[type=range]::-webkit-slider-runnable-track {
            background: #eeeeee;
            border-radius: 1em;
        }

    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <style>
        .hljs {
            background: #ffffff;
        }
        a {
            color:black;
        }
    </style>

</head>

<body style='text-align:center;background:#FFFFFF;margin:0;padding:0'>

    <div id="logo" style="position:absolute;top:25px;right:6%;z-index:9999">
        <a href="javascript:__dataTheme()">
            <div style="font-family:helvetica;font-size:48px;line-height:0.8em;font-weight:bold;color:burlywood ;text-align:left">Data<br><span style="font-size:48px;padding-left:2px">Viz</span><em> i</em></div>
        </a>
    </div>


    <div style="margin:auto">

        <div id="map_div"></div>

        <div id="sidebar_open_div" class="sidebar" style="background:none">
            
             <a onclick="$('#sidebar_div').toggle();">
                <span style="font-size:28px;color:#888888;float:right;padding:0.3em 0 0 1em">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
  <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
</svg>
                 </span>
            </a>
            
        </div>

        <div id="sidebar_div" class="sidebar">
            
             <a onclick="$('#sidebar_div').toggle();">
                <span style="font-size:28px;color:#888888;background:rgb(247, 246, 239);float:right;padding:0.3em">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-arrow-up-square" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm8.5 9.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707z"/>
                    </svg>
                </span>
            </a>
                 
           <h1>Temperature adesso in Italia</h1>
            <p style="font-family:helvetica;font-size:1.6em;line-height:0.75em;margin:-0.5em 0em 0.5em 0.1em">
                <small style='color:#888888'>Fonte dati: <a href="https://meteohub.mistralportal.it/app/maps/observations" target="_blank" style="color:cadetblue">Meteohub</a> di ItaliaMeteo</small>
            </p>
            <ul>
                <li>
                    <a class="select" href="javascript:ixmaps.map().add(__sez_2011_2021_pop_arrow_user())">Temperatura</a>
                    <ul>
                        <li>
                            <a class="select foreground active" href="javascript:setForegroundTheme('picchi')">
                                Picchi</a>
                        </li>
                        <li>
                            <a class="select foreground" href="javascript:setForegroundTheme('dots heatmap')">
                                dots/heatmap</a>
                        </li>
                        <li>
                            <a class="select foreground" href="javascript:setForegroundTheme('label aggregati')">
                                label</a>
                        </li>

                    </ul>
                </li>
             <div style="position:relative;top:0px;left:0px">
                <p style='font-family:open sans;color:#888888;z-index:999999'>
                    <span style="font-size:0.8em;font-weight:bold;color:cadetblue">grandezza grafici:</span>
                    <input type='range' min='0.1' max='5' step="0.01" value='1' class='slider' id='myRange1'>
                    <!--
            <span style="font-size:0.6em">aggregazione: da 5
                <input type='range' min='5' max='100' step="5" value='100' class='slider' id='myRange2'> a 100 pixel</span>
            -->
                </p>
                <div id="statistics" style='font-family:open sans;font-size:12px;line-height:1.3em;color:#888888;z-index:999999'></div> 
            </div>
            </ul>

        </div>
            
        <div id="map_code_div-project" style="position:absolute;top:10px;left:10px;text-align:left;width:50%;height:800px;overflow:auto;display:none;xxbox-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);z-index:9999">
        
             <!-- Container -->
            <div id="container" style="padding:0em 0.2em 0em 0em;vertical-align:middle;background-color:rgba(255,255,255,1);">

                <div id="map_code_div-project_save" style="position:sticky;top:10px;margin-right:10px;text-align:right;background:white;display:none">
                    <a title="copy to clipboard" href="javascript:__copyToClipboard()"><i class="bi bi-clipboard"></i> copy</a>&nbsp;&nbsp;
                    <a title="save to file" href="javascript:__saveTextAsFile('map.html')"><i class="bi bi-download"></i> save</a>&nbsp;&nbsp;&nbsp;
                    <a title="close" href="javascript:__close()"><i class="bi bi-x-circle"></i></a>
                </div>

                <div id="map_code_div" style="margin-bottom:1em;width:100%;height:100%;overflow:auto">
                </div>

            </div>
       
        </div>
    </div>

    <!-- ------------------------------------- -->
    <!--                                       -->
    <!-- c o d e                         -->
    <!--                                       -->
    <!-- ------------------------------------- -->

    <!--========================================================================= -->

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
    <script src="https://gjrichter.github.io/ixmaps_flat/ui/js/htmlgui_flat.js"></script>
    <script src="https://gjrichter.github.io/ixmaps_flat/ui/js/tools/facet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://gjrichter.github.io/ixmaps_flat/ui/js/tools/json_config.js"></script>
    <script src="https://gjrichter.github.io/ixmaps_flat/ui/js/tools/json_config_html.js"></script>
    
     <!--========================================================================= -->

    <script type="text/javascript" charset="utf-8">
        /** 
         ** change background color on select
         **/

        __select = (el) => {
            if (el.hasClass("foreground")) {
                $(".foreground").removeClass("active");
            }
            if (el.hasClass("background")) {
                $(".background").removeClass("active");
            }
            el.addClass("active");
        };
        $(".select").attr("onclick", "__select($(this))");

        var setChartSize = function(nValue) {
            ixmaps.map().changeThemeStyle('chart', 'scale:' + nValue, 'set');
            ixmaps.map().changeThemeStyle('chart_procom_all', 'scale:' + nValue, 'set');
        }
        var setGrid = function(nValue) {
            ixmaps.map().changeThemeStyle('chart', 'gridwidthpx:' + nValue, 'set');
            ixmaps.map().changeThemeStyle('chart_grid', 'gridwidthpx:' + nValue, 'set');

        }
        var slider = document.getElementById("myRange1");
        // Update the current slider value (each time you drag the slider handle)
        slider.oninput = function() {
            if (ixmaps.sliderT1) {
                clearTimeout(ixmaps.sliderT1);
            }
            ixmaps.value = this.value;
            ixmaps.sliderT1 = setTimeout(function() {
                setChartSize(ixmaps.value)
            }, 10);
        }

        // ---------------------------------------------------
        // ---------------------------------------------------
        //
        // t h e   m a p 
        //
        // ---------------------------------------------------
        // ---------------------------------------------------

        /**
         ** ************************************
         ** define the ixmaps themes and project
         ** ************************************
         **/

        var __filter = "";
        var __lat = null;
        var __lon = null;
        var __zoom = null;
        var __scale_chart = 1;
        var __legend = true;

        /**
         ** strings used by the map 	
         **/

        attribution =
            "powered by <a href=\"http://ixmaps.com\" target=\"_blank\">iXMaps</a> |&nbsp; <a href=\"javascript:__dataTheme()\" > html</a>";

        /**
         ** get query params and adapt theme and project definitions 	
         **/

        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });

        if (params.filter) {
            __filter = params.filter;
        }

        if (params.view) {
            var latlonA = params.view.split('[')[1].split(']')[0].split(',');
            __lat = latlonA[0];
            __lon = latlonA[1];
            __zoom = parseFloat(params.view.split(',')[2]);
            //setTimeout("ixmaps.setView(null,"+params.view+")",1000);
        };

        if (params.scale) {
            __scale_chart = params.scale;
        };

        if (params.legend) {
            __legend = params.legend;
        };


        ixmaps.regione = "03";
        ixmaps.procom = "*";

        const nuts2 =
            ixmaps.layer("nuts2", layer => layer
                .type("FEATURES|SILENT|LOCKED|NOLEGEND")
                .data({
                    url: "https://gisco-services.ec.europa.eu/distribution/v2/nuts/geojson/NUTS_RG_10M_2021_4326_LEVL_2.geojson",
                    type: "geojson"
                })
                .binding({
                    id: "NUTS_ID"
                })
                .filter("WHERE CNTR_CODE = IT")
                .style({
                    colorscheme: [
                        "white"
                    ],
                    fillopacity: "1",
                    linecolor: "#F7F6EF",
                    linewidth: "2",
                    shadow: true,
                    showdata: true,
                    featurelower: "1:3000000",
                    titlefield: "NUTS_NAME",
                    name: "nuts2"
                })
            );


        /**
         **
         ** window size handling
         **
         **/

        $(window).resize(function() {
            $("#regis_map").css("height", (window.innerHeight - 5) + "px");
        });

		// -----------------------------------------------------------
		//
		// create actual, map zoom dependent theme statistics (facets)
		//
		// -----------------------------------------------------------

		ixmaps.statistics = function(szId) {

			var themeObj = ixmaps.getThemeObj(szId);
			var lastFilter = themeObj.szFilter || "";

			var szFieldsA = ["prod.0.val.0.ref"];
 			var facetsA = ixmaps.data.getFacets(lastFilter, 'user_legend', szFieldsA, szId);
            
			console.log("------------------");
			console.log("------------------");
			console.log("------------------");
			console.log(facetsA);
			console.log("------------------");
			console.log("------------------");
			console.log("------------------");
            
			$("#statistics").html("i valori sono stati trasmessi in orari come segue:");
            let szHtml ="";
            for (var i in facetsA[0].values){
                szHtml += "<br>" + facetsA[0].values[i].split('T')[1] + " - " +facetsA[0].valuesCount[facetsA[0].values[i]];   
            } 
			$("#statistics").append(szHtml);
		};
        
        
        
         
        ixmaps.htmlgui_onDrawTheme = function(szId) {
             if (szId == "chart"){
                ixmaps.statistics(szId);             
            }
        };

        
        ixmaps.htmlgui_onZoomAndPan = function() { 

            var nOpacity = (ixmaps.getZoom() - 7) / 2;
            ixmaps.map().setBasemapOpacity(nOpacity, "absolute");
            
            var nMinValueSize = 20;
            var nZoom = ixmaps.getZoom();
            if (nZoom > 7){
                nMinValueSize = 17;    
            }
            if (nZoom > 8){
                nMinValueSize = 12;    
            }
            if (nZoom > 9){
                nMinValueSize = 10;    
            }
            if (nZoom > 10){
                nMinValueSize = 1;    
            }
            ixmaps.map().changeThemeStyle("chart","minvaluesize:"+nMinValueSize);

        };




        var szForegroundTheme = "variation_population_percent";
        var setForegroundTheme = function(szTheme) {
            szForegroundTheme = szTheme;
            loadForegroundTheme();
        };
        var loadForegroundTheme = function() {
            switch (szForegroundTheme) {
                case "picchi":
                    ixmaps.map().replace('chart', __temperature_peaks, 'silent');
                    break;
                case "dots heatmap":
                    ixmaps.map().replace('chart', __temperature_dots, 'silent');
                    break;
                case "label aggregati":
                    ixmaps.map().replace('chart', __temperature_label, 'silent');
                    break;
             }
        };
        
        // ---------------------------------------------------
        // e m b e d   t h e   m a p  
        // ---------------------------------------------------

         query_data = function(theme, options) {
             
            var date = new Date();
            var uTime = date.getTime();

            /* 2 hours to the past */
            uTime -= 1000 * 60 * 60 * 3;

            var sdate = new Date(uTime);

            var year = sdate.getFullYear();
            var month = sdate.getMonth() + 1;
            var day = sdate.getDate();
            var szStartDate = year + "-" + String("0" + month).slice(-2) + "-" + String("0" + day).slice(-2);
            var hours = sdate.getHours();
            var minutes = sdate.getMinutes();
            var szStartTime = hours + ":00";
             
            year = date.getFullYear();
            month = date.getMonth() + 1;
            day = date.getDate();
            var szEndDate = year + "-" + String("0" + month).slice(-2) + "-" + String("0" + day).slice(-2);
            hours = date.getHours();
            minutes = date.getMinutes();
            var szEndTime = hours + ":" + minutes;
             
            var broker = new Data.Broker()

                .addSource("https://meteohub.mistralportal.it/api/observations?q=reftime:%20%3E="+szStartDate+"%20"+szStartTime+",%3C="+szEndDate+"%20"+szEndTime+";product:B12101;license:CCBY_COMPLIANT;timerange:254,0,0;level:103,2000,0,0&reliabilityCheck=true&last=true&ts=1751462143620", "json")

                .realize(
                    function(dataA) {

                        var data = dataA[0];
                        data.column("prod.0.val.0.val").map(function(value){
                            return value - 273.15;
                        })   

                         ixmaps.setExternalData(data, {
                            type: "dbtable",
                            name: options.name
                        });
                    });
        };

        let __colorscheme = [
                        "#88229A", "#9525A4", "#BC30C1", "#D938D6",
                        "#F640ED", "#6B1E8E", "#551E8E", "#1E418E",
                        "#1E538E", "#1E5C8E", "#1E669C", "#1E74B8",
                        "#1E90F0", "#3FA6FE", "#6EBCFE", "#C3FEE5",
                        "#AAEFCE", "#95D8B4", "#74B896", "#1DA63B",
                        "#A7E423", "#D3F121", "#F4FB1F", "#F3DB26",
                        "#F5C428", "#F59628", "#F17B25", "#E64B23",
                        "#C63224", "#B4282D", "#871B1B", "#721B1B",
                        "#B87373", "#EDA7A8", "#FAB9B9", "#FADDDD"
        ];
        let __ranges =  "-28,-26,-24,-22,-20,-18,-16,-14,-12,-10,-8,-6,-4,-2,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44";

        var __temperature_dots =
            ixmaps.layer("World Mercator", layer => layer
                .data({
                    query: query_data.toString(),
                    name: "data_1751459866345_623",
                    cache: "true"
                    })
                .binding({
                    geo: "stat.lat|stat.lon",
                    value: "prod.0.val.0.val"
                    })
                .type("CHART|BUBBLE|GLOW|NOSIZE|RANGES|VALUES")
                .style({
                    colorscheme: __colorscheme,
                    ranges: __ranges,
                    fillopacity: "0.9",
                    linecolor: "none",
                    shadow: "false",
                    visible: "true",
                    showdata: "true",
                    units: "",
                    scale: "0.6",
                    sizepow: "2",
                    valuescale: "1",
                    valuedecimals: "1",
                    valuesupper: "1:1000000",
                    })
                .meta({
                    title: "[title]",
                    snippet: "",
                    description: "",
                    name: "chart",
                    tooltip: "{{theme.item.chart}}{{theme.item.data}}"
                    })
            );
        
        var __temperature_dots_bg =
            ixmaps.layer("World Mercator", layer => layer
                .data({
                    query: query_data.toString(),
                    name: "data_1751459866345_623",
                    cache: "true"
                    })
                .binding({
                    geo: "stat.lat|stat.lon",
                    value: "prod.0.val.0.val"
                    })
                .type("CHART|BUBBLE|GLOW|NOSIZE|RANGES|VALUES")
                .style({
                    colorscheme: __colorscheme,
                    ranges: __ranges,
                    fillopacity: "0.01",
                    linecolor: "none",
                    shadow: "false",
                    visible: "true",
                    showdata: "true",
                    units: "",
                    scale: "0.7",
                    sizepow: "2",
                    valuescale: "1",
                    valuedecimals: "1",
                    valuesupper: "1:1000000",
                    })
                .meta({
                    title: "[title]",
                    snippet: "",
                    description: "",
                    name: "chart_bg",
                    tooltip: "{{theme.item.chart}}{{theme.item.data}}"
                    })
            );
        
        var __temperature_label =
            ixmaps.layer("World Mercator", layer => layer
                .data({
                    query: query_data.toString(),
                    name: "data_1751459866345_623",
                    cache: "true"
                    })
                .binding({
                    geo: "stat.lat|stat.lon",
                    value: "prod.0.val.0.val",
                    title: "stat.details.0.val"
                    })
                .type("CHART|LABEL|GRIDSIZE|SORT|UP|RANGES|VALUES|AGGREGATE|RECT|RELOCATE|MAX|BOX|BOTTOMTITLE")
                .style({
                    colorscheme: __colorscheme,
                    ranges: __ranges,
                    symbols: ["label"],
                    linecolor: "black",
                    fillopacity: "1",
                    shadow: "true",
                    visible: "true",
                    showdata: "true",
                    units: "",
                    scale: "3",
                    sizepow: "2",
                    gridwidth: "30px",
                    valuecolor: "white",
                    valuescale: "1.2",
                    valuedecimals: "1",
                    boxcolor: "none",
                    bordercolor: "none",
                    boxupper: "1:1000000",
                    shadowlower: "1:1000000"
                    })
                .meta({
                    title: "temperatura",
                    snippet: "",
                    description: "",
                    name: "chart",
                    tooltip: "{{theme.item.chart}}{{theme.item.data}}"
                    })
            );
        
         var __temperature_peaks =
            ixmaps.layer("World Mercator", layer => layer
                .data({
                    query: query_data.toString(),
                    name: "data_1751459866345_623",
                    cache: "true"
                    })
                .binding({
                    geo: "stat.lat|stat.lon",
                    value: "prod.0.val.0.val",
                    title: "stat.details.0.val"
                    })
                .type("CHART|USER|3D|SHADOW|SIZE|RANGES|VALUES|AGGREGATE|MAX")
                .style({
                    userdraw: "pinnacleChart",
                    colorscheme: __colorscheme,
                    ranges: __ranges,
                    fillopacity: "0.7",
                    shadow: "false",
                    visible: "true",
                    showdata: "true",
                    units: "Â°",
                    scale: "2.2",
                    rangescale: "0.5",
                    sizepow: "0.1",
                    valuescale: "1",
                    valuedecimals: "1",
                    rangecentervalue: "0",
                    minvaluesize: "20"
                    })
                .meta({
                    title: "temperatura",
                    snippet: "",
                    description: "",
                    name: "chart",
                    tooltip: "{{theme.item.chart}}{{theme.item.data}}"
                    })
            );
       
        
        /**
         **
         ** create the interactive map an append it to the document 
         **
         **/

        ixmaps.embed("map_div", {
                mapService: "leaflet_vt",
                mapType: "CartoDB - Positron",
                map: "../../maps/svg/maps/generic/mercator.svg",
                legend: ((__legend == true) ? "true" : 0),
                align: "left",
                mode: "pan",
                about: "test",
                search: "Italy"
            },
            map => map

            .view({
                "center": {
                    "lat": __lat || "42.30234655149951",
                    "lng": __lon || "13.987399620595363"
                },
                "zoom": __zoom || "6.27681771091248"
            })
            .options({
                featurescaling: "true",
                objectscaling: "dynamic",
                normalSizeScale: "100000",
                dynamicSizePow: "0.1",
                flushChartDraw: "1000000",
                flushPaintShape: "1000000",
                basemapopacity: "0.5",
                worksilent: "false",
                loadsilent: "false",
                hideOnPan:  "false",
                freezeOnPan:"false",
            })
            .local("aggregated", "")
            .local("... creating theme ...", "...")
            .local("loading data ...", "scaricando dati ...")
            .require("https://gjrichter.github.io/ixmaps_flat/ui/js/tools/tooltip_mustache.js")
            .require("https://d3js.org/d3.v3.min.js")
            .require("https://gjrichter.github.io/ixmaps_flat/usercharts/d3/chart.js")
            .require("https://gjrichter.github.io/ixmaps_flat/usercharts/d3/arrow_chart.js")
            .attribution(attribution)
 
            // -----------------------------		 
            // the data visualization layer 
            // -----------------------------

            .layer(nuts2)
            .layer(__temperature_dots_bg)
            .layer(__temperature_peaks)

        );
        
        // ----------------------------------------------
        // show actual map HTML page
        // ----------------------------------------------

        var fCode = false;
        const __openSidebar = (url) => {
            const $sidebar = $("#map_code_div-project");
            $sidebar.load(url, (response, status, xhr) => {
                if (status === "error") {
                    alert(`Sorry but there was an error: ${xhr.status}\n${xhr.statusText}`);
                }
            });
        };

        __dataTheme = function() {
            if ($("#map_code_div-project").css("display") != "none") {
                $("#map_code_div-project").hide();
            } else {
                __showProjectHTML(ixmaps.map().getProjectString());
                $("#map_code_div-project").show();
            }
            fCode = !fCode;
        }
        __sourceId = null;
        
        /**
         * __showProjectHTML 
         * show the HTML code of a page with an emdedded map with the given ixmaps project
         * @param szProject project defintion string
         * @type void 
         */
        __showProjectHTML = function(szProject) {
            
            $("#map_code_div-project_save").hide();
            
            szHTML = new Config(szProject).getProjectHTML();

            var list = "";
            var id = __sourceId = "source-" + (String(Math.floor(Math.random() * 10000000000000)));

            list += '<div class="source" style="padding:0.2em 0 0.2em 1em;background:#ffffff">';
            list += '<pre id="' + id + '" class="prettyprint language-HTML">';
            list += '</pre>';
            list += '</div>';

            $("#map_code_div").append(list);
            $("#map_code_div-project_save").show();

            $("#" + id + "").text(String(szHTML));
            hljs.highlightBlock($("#" + id)[0]);

            $(".hljs-attr").attr("onMouseOver", "showTooltip(event,$(this).text())");
            $(".hljs-attr").attr("onMouseOut", "hideTooltip()");
        };

        /**
         * __copyToClipboard 
         * copy the generated HTML to the clipboard
         * @type void 
         */
        __copyToClipboard = function() {
            // Get the html code
            var copyText = $("#"+__sourceId).text();

            // write the text to the clipboard
            navigator.clipboard.writeText(copyText);

            // Alert the copied text
            alert("HTML code copied to clipboard");
        };

        /**
         * __saveTextAsFile 
         * save the generated HTML as text file (in downloads) with the given name
         * @param szFilename the name of the file to create in downloads
         * @type void 
         */
        __saveTextAsFile = function(szFilename) {
            var szText = $("#"+__sourceId).text();
            var textToWrite = szText;
            var textFileAsBlob = new Blob([textToWrite], {
                type: 'text/plain'
            });
            var fileNameToSaveAs = szFilename || "project.json";

            var downloadLink = document.createElement("a");
            downloadLink.download = fileNameToSaveAs;
            downloadLink.innerHTML = "Download File";
            if (window.URL != null) {
                // Chrome allows the link to be clicked
                // without actually adding it to the DOM.
                downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
            } else {
                // Firefox requires the link to be added to the DOM
                // before it can be clicked.
                downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
                downloadLink.onclick = destroyClickedElement;
                downloadLink.style.display = "none";
                document.body.appendChild(downloadLink);
            }

            downloadLink.click();
        };

        /**
         * __close 
         * close the overlay with the HTML code
         * @type void 
         */
        __close = function() {
            $("#map_code_div-project_save").hide();
            $("#container").parent().hide();
        };

        // -------------------------------------------------------------
        //
        // -------------------------------------------------------------

        $(document).ready(function() {
           setTimeout(() => {__showProjectHTML(ixmaps.map().getProjectString())},100);
        });

    </script>
        
        
        

    </script>

</body>

</html>
