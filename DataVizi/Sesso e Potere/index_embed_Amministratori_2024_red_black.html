<!DOCTYPE html>
<html>

<!-- **********************************************************************

ixmaps map embed html

$Comment: ixmaps map template; embedded version
$Source : index_only_map_embed.html,v $

$InitialAuthor: guenter richter $
$InitialDate: 2023/04/22 $
$Author: guenter richter $
$Id:index_embed_Open_Data_PNRR_Dati_Universo_REGIS_III.html 1 2023-04-22 00:00:00Z Guenter Richter $

licensed under CC-BY
$Log:index_only_map_embed.html,v $

********************************************************************** -->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="ixmaps embed example">
    <meta name="author" content="guenter richter">
    <link rel="shortcut icon" href="https://gjrichter.github.io/ixmaps/ui/resources/images/ixmaps_logo.png">

    <title>Data-Viz-I</title>
    <meta name="description" content="La mappa interattiva per esplorare i dati aperti di ISTAT sull'Indice composito di fragilità dei comni italiani">

    <style>
        a {
            text-decoration: none;
            color: #444444;
        }

        a:hover {
            color: cornflowerblue;
        }

        ul {
            font-family: raleway;
            padding-inline-start: 1.5em;
        }
        
        li.active a {
            color: white;
            background-color: #24A2AF;
            xxpadding: 0.2em;
        }

        a.active {
            color: white;
            background-color: #24A2AF;
            xxpadding: 0.2em;
        }

        .sidebar {
            position: absolute;
            right: 5%;
            top: 150px;
            text-align: left;
            font-family: Georgia;
            font-size: 1.1em;
            line-height: 1.2em;
            max-width: 28%;
            background-color: rgba(247, 246, 239, 0.8)
        }

    </style>

</head>

<body style='text-align:center;background:#F7F6EF;margin:0;padding:0'>

    <!--
    <div id="logo" style="position:absolute;top:30px;right:90px"><div style="font-family:helvetica;font-size:40px;line-height:0.7em;font-weight:bold;color:burlywood ;text-align:left">Italia<br><span style="font-size:33px">inDati</span></div></div>
    -->

    <div id="logo" style="position:absolute;top:25px;right:6%">
        <a href="javascript:__dataTheme()">
            <div style="font-family:helvetica;font-size:48px;line-height:0.8em;font-weight:bold;color:burlywood ;text-align:left">Data<br><span style="font-size:48px;padding-left:2px">Viz</span><em> i</em></div>
        </a>
    </div>

    <div style="margin:auto">

        <div id="map_div"></div>

        <div id="sidebar_div" class="sidebar">
            <ul>
                <li class="select" style="font-family:helvetica;font-size:1.3em;line-height:1.2em">
                    <b>Donne in amministrazioni locali</b>

                </li>
                <hr>
                <p>Visualizzazioni basati sul elenco degli <a style='color:cadetblue' href="https://dait.interno.gov.it/elezioni/open-data/amministratori-locali-e-regionali-in-carica" target="_blank"> amministratori locali attualmente in carica</a> al 4 Marzo 2025 elaborato (aggiunto CODICE_ISTAT) da Andrea Borruso (onData) <a style='color:cadetblue' href="https://github.com/ondata/sesso-e-potere/tree/main/dati/amministazioni-italiane/rawdata" target="_blank">&rarr; fonte</a></p>
                     <li >
                        <a class="select active" href="javascript:ixmaps.map().remove('chart1').remove('chart2').remove('chart3').add(nuts22).add(chart_2024_aggregated).add(chart_2024_comuni)">Percentuale degli amministratori femminili al 2025</a>
                    </li>
                     <li>
                        <a class="select" href="javascript:ixmaps.map().remove('chart1').remove('chart2').remove('chart3').add(nuts22).add(chart_pie_2022).add(chart_donut_2024).add(chart_arrow_f)">Cambiamento relativo ai dati del 2022</a>
                    </li>
                     <li>
                        <a class="select" href="javascript:ixmaps.map().remove('nuts22').remove('chart1').remove('chart2').remove('chart3').add(chart_diff_arrow_f).add(chart_diff_arrow_m)">Fluttuazione al livello comunale 2022/2025</a>
                    </li>
                     <li>
                        <a class="select" href="javascript:ixmaps.map().remove('nuts22').remove('chart1').remove('chart2').remove('chart3').add(chart_curves_eta).changeThemeStyle('nuts2','linecolor:white')">Distribuzione dell'età degli amministratori locali al 2025, diviso per sesso </a>
                    </li>
                     <div style="margin-top:0.5em;color:#888888">(clicca sugli argomenti sopra)</div>
                
                
                
             </ul>
        </div>
        
        <div id="map_code_div-project" style="position:absolute;top:10px;left:10px;text-align:left;width:50%;height:800px;overflow:auto;display:none;xxbox-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);"></div>

    </div>

    <!-- ------------------------------------- -->
    <!--                                       -->
    <!-- c o d e                         -->
    <!--                                       -->
    <!-- ------------------------------------- -->

    <!--========================================================================= -->

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
	<script type="text/javascript" src="https://gjrichter.github.io/ixmaps_test/ui/js/htmlgui_api.js"></script>

    <!--========================================================================= -->

    <script type="text/javascript" charset="utf-8">
        /** 
         ** change background color on select
         **/

        __select = (el) => {
            $(".select").removeClass("active");
            el.addClass("active");
        };
        $(".select").attr("onclick", "__select($(this))");

        // ---------------------------------------------------
        // ---------------------------------------------------
        //
        // t h e   m a p 
        //
        // ---------------------------------------------------
        // ---------------------------------------------------

        /**
         ** ************************************
         ** define the ixmaps themes and project
         ** ************************************
         **/

        var __filter = "";
        var __lat = null;
        var __lon = null;
        var __zoom = null;
        var __scale_chart = 1;
        var __legend = true;

        /**
         ** strings used by the map 	
         **/

        attribution =
            "powered by <a href=\"http://ixmaps.com\" target=\"_blank\">iXMaps</a>";

        /**
         ** get query params and adapt theme and project definitions 	
         **/

        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });

        if (params.filter) {
            __filter = params.filter;
        }

        if (params.view) {
            var latlonA = params.view.split('[')[1].split(']')[0].split(',');
            __lat = latlonA[0];
            __lon = latlonA[1];
            __zoom = parseFloat(params.view.split(',')[2]);
            //setTimeout("ixmaps.setView(null,"+params.view+")",1000);
        };

        if (params.scale) {
            __scale_chart = params.scale;
        };

        if (params.legend) {
            __legend = params.legend;
        };

        // ---------------------------------------------------
        // t h e   d a t a 
        // ---------------------------------------------------

        const query = function(data, options) {
            Data.feed({
                source: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/Amministrazioni/sesso_e%20_potere/ammcom_24_11_17.csv.gz",
                type: "csv"
            }).load(function(newData) {
                newData = newData.select("WHERE descrizione_carica like \"Sindac|Assess|Consigl\"")
                var pivot = newData.pivot({
                    lead: "CODICE_ISTAT",
                    columns: "sesso",
                    keep: [
                        "CODICE_ISTAT",
                        "codice_regione",
                        "codice_provincia",
                        "denominazione_comune",
                        "data_elezione",
                        "popolazione_censita_alla_data_elezione"
                    ]
                });
                var iTotal = pivot.column("Total").index;
                var iF = pivot.column("F").index;
                pivot.addColumn({
                    destination: "quota_femminile"
                }, function(row) {
                    return Math.round((row[iF] / row[iTotal]) * 10000) / 100;
                });
                
                (options.type = "jsonDB"), ixmaps.setExternalData(pivot, options);
            });
        };
        
        const query_diff = function(data, options) {
            var broker = new Data.Broker()
                .addSource(
                    "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/Amministrazioni/sesso_e%20_potere/ammcom_22_10_22.csv.gz",
                    "csv"
                )
                .addSource(
                    "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/Amministrazioni/sesso_e%20_potere/ammcom_24_11_17.csv.gz",
                    "csv"
                )
                .realize(function(dataA) {
                    dataA[0] = dataA[0].select("WHERE descrizione_carica like \"Sindac|Assess|Consigl\"")
                    dataA[1] = dataA[1].select("WHERE descrizione_carica like \"Sindac|Assess|Consigl\"")
                    var pivot_1 = dataA[0].pivot({
                        lead: "CODICE_ISTAT",
                        columns: "sesso",
                        keep: [
                            "CODICE_ISTAT",
                            "codice_regione",
                            "codice_provincia",
                            "denominazione_comune",
                            "data_elezione",
                            "popolazione_censita"
                        ]
                    });
                    var pivot_2 = dataA[1].pivot({
                        lead: "CODICE_ISTAT",
                        columns: "sesso",
                        keep: [
                            "CODICE_ISTAT",
                            "codice_regione",
                            "codice_provincia",
                            "denominazione_comune",
                            "data_elezione",
                            "popolazione_censita_alla_data_elezione"
                        ]
                    });
                    
                    var iTotal = pivot_1.column("Total").index;
                    var iF = pivot_1.column("F").index;
                    pivot_1.addColumn({
                        destination: "quota_femminile"
                    }, function(row) {
                        return Math.round((row[iF] / row[iTotal]) * 10000) / 100;
                    });
                    
                        iTotal = pivot_2.column("Total").index;
                        iF = pivot_2.column("F").index;
                    pivot_2.addColumn({
                        destination: "quota_femminile"
                    }, function(row) {
                        return Math.round((row[iF] / row[iTotal]) * 10000) / 100;
                    });
                    
                    var merger = new Data.Merger();
                    var final = merger
                        .addSource(pivot_1, {
                            lookup: "CODICE_ISTAT",
                            columns: pivot_1.columnNames()
                        })
                        .addSource(pivot_2, {
                            lookup: "CODICE_ISTAT",
                            columns: pivot_2.columnNames()
                        })
                        .realize();
                    
                    final.column("data_elezione.1").rename("data_elezione_1");
                    final.column("data_elezione.2").rename("data_elezione_2");

                    var iQ1 = final.column("quota_femminile.1").index;
                    var iQ2 = final.column("quota_femminile.2").index;
                    final.addColumn({
                        destination: "quota_femminile_diff"
                    }, function(row) {
                        return (row[iQ2] - row[iQ1]);
                    });

                    final = final.select("WHERE \"data_elezione_1\" NOT \"$data_elezione_2$\"");
                    final = final.select("WHERE \"Total.1\" > 7 AND \"Total.2\" > 7");
 
                    (options.type = "jsonDB"), ixmaps.setExternalData(final, options);
                });
        };
        
        const query_extended_age = function(data, options) {
            var broker = new Data.Broker()
                .addSource(
                    "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/Amministrazioni/sesso_e%20_potere/ammcom_24_11_17.csv.gz",
                    "csv"
                )
                .realize(function(dataA) {
                    ixmaps.showLoadingArrayStop();
                    ixmaps.hideLoading();

                    var ammcom = dataA[0];
                    
                    ammcom = ammcom.select("WHERE descrizione_carica like \"Sindac|Assess|Consigl\"");

                    var pivot = ammcom.pivot({
                        lead: "denominazione_comune",
                        columns: "sesso",
                        keep: [
                            "CODICE_ISTAT",
                            "codice_regione",
                            "codice_provincia",
                            "popolazione_censita_alla_data_elezione"
                        ]
                    });
                    
                    pivot = pivot.select("WHERE Total > 7");

                    var iTotal = pivot.column("Total").index;
                    var iF = pivot.column("F").index;
                    pivot.addColumn({
                            destination: "quota"
                        },
                        function(row) {
                            return (row[iF] / row[iTotal]) * 100;
                        }
                    );
                    var lookup = pivot.lookupArray("quota", "denominazione_comune");

                    ammcom.addColumn({
                            source: "denominazione_comune",
                            destination: "quota"
                        },
                        function(value) {
                            return lookup[value];
                        }
                    );

                    var iProv = ammcom.column("codice_provincia").index;
                    var iCom = ammcom.column("codice_comune").index;
                    ammcom.addColumn({
                        destination: "PROCOM"
                    }, function(row) {
                        return row[iProv] + ("000" + String(row[iCom])).slice(-3);
                    });

                    var iNat = ammcom.column("data_nascita").index;
                    ammcom.addColumn({
                        destination: "eta"
                    }, function(row) {
                        var dA = row[iNat].split("/");
                        return (
                            (new Date().getTime() -
                                new Date(dA[2] + "/" + dA[1] + "/" + dA[0]).getTime()) /
                            (1000 * 60 * 60 * 24 * 356)
                        ).toFixed(0);
                    });

                    ammcom.addColumn({
                            source: "eta",
                            destination: "eta_10"
                        },
                        function(value) {
                            return Math.floor(value / 10) * 10;
                        }
                    );

                    ammcom.addColumn({
                            source: "eta",
                            destination: "eta_5"
                        },
                        function(value) {
                            return Math.floor(value / 5) * 5;
                        }
                    );

                    ammcom.addColumn({
                            source: "popolazione_censita_alla_data_elezione",
                            destination: "popolazione_log"
                        },
                        function(value) {
                            return Math.log10(value);
                        }
                    );

                    var ammcomF = ammcom.select("WHERE sesso = F");
                    var ammcomM = ammcom.select("WHERE sesso = M");

                    var pivotF = ammcomF.pivot({
                        lead: "denominazione_comune",
                        columns: "eta_10",
                        keep: [
                            "CODICE_ISTAT",
                            "PROCOM",
                            "codice_regione",
                            "codice_provincia",
                            "sigla_provincia",
                            "popolazione_censita_alla_data_elezione"
                        ]
                    });

                    var pivotM = ammcomM.pivot({
                        lead: "denominazione_comune",
                        columns: "eta_10",
                        keep: [
                            "CODICE_ISTAT",
                            "PROCOM",
                            "codice_regione",
                            "codice_provincia",
                            "sigla_provincia",
                            "popolazione_censita_alla_data_elezione"
                        ]
                    });

                    var merger1 = new Data.Merger();
                    var final = merger1
                        .addSource(pivotM, {
                            lookup: "denominazione_comune",
                            columns: pivotM.columnNames()
                        })
                        .addSource(pivotF, {
                            lookup: "denominazione_comune",
                            columns: pivotF.columnNames()
                        })
                        .realize();

                    var iTotal1 = final.column("Total.1").index;
                    var iTotal2 = final.column("Total.2").index;
                    final.addColumn({
                            destination: "Total"
                        },
                        function(row) {
                            return row[iTotal1] + row[iTotal2];
                        }
                    );
                    
                    final = final.select("WHERE Total > 7");

                    ixmaps.setExternalData(final, {
                        type: "dbtable",
                        name: options.name
                    });
                });
        };

        // ---------------------------------------------------
        // t h e   l a y e r 
        // ---------------------------------------------------

        /**
         ** define layer with reference shapes (comuni, province, regioni ) 
         **/

        const nuts0 = 
			ixmaps.layer("nuts0", layer => layer
				.data({
					url: "https://gisco-services.ec.europa.eu/distribution/v2/nuts/geojson/NUTS_RG_10M_2021_4326_LEVL_0.geojson",
					type: "geojson"
				})
                .filter("WHERE NUTS_ID = IT")
				.type("FEATURES|SILENT|NOLEGEND")
				.style({
					colorscheme: [
						"#222222"],
					fillopacity: "1",
					linecolor: "#000000",
					linewidth: "1",
					showdata: true,
					name: "nuts0"
				})
			);

        const nuts2 =
            ixmaps.layer("nuts2", layer => layer
                .data({
                    url: "https://gisco-services.ec.europa.eu/distribution/v2/nuts/geojson/NUTS_RG_10M_2021_4326_LEVL_2.geojson",
                    type: "geojson"
                })
                .binding({
                    id: "NUTS_NAME"
                 })
                .filter("WHERE CNTR_CODE = IT")
                .type("FEATURES|SILENT|NOLEGEND")
                .style({
                    colorscheme: [
                        "white"
                    ],
                    fillopacity: "0.7",
                    linecolor: "white",
                    linewidth: "2",
                    showdata: true,
                    titlefield: "NUTS_NAME",
                    featurelower: "1:500000",
                    name: "nuts2"
                })
            );

        const nuts22 =
            ixmaps.layer("nuts22", layer => layer
                .data({
                    url: "https://gisco-services.ec.europa.eu/distribution/v2/nuts/geojson/NUTS_RG_10M_2021_4326_LEVL_2.geojson",
                    type: "geojson"
                })
                .binding({
                    id: "NUTS_NAME"
                 })
                .filter("WHERE CNTR_CODE = IT")
                .type("FEATURES|SILENT|NOLEGEND")
                .style({
                    colorscheme: [
                        "white"
                    ],
                    fillopacity: "0.7",
                    linecolor: "black",
                    linewidth: "2",
                    showdata: true,
                    titlefield: "NUTS_NAME",
                    featurelower: "1:500000",
                    name: "nuts22"
                })
            );

        const nuts3 =
            ixmaps.layer("nuts3", layer => layer
                .data({
                    url: "https://gisco-services.ec.europa.eu/distribution/v2/nuts/geojson/NUTS_RG_10M_2021_4326_LEVL_3.geojson",
                    type: "geojson"
                })
                .binding({
                    id: "NUTS_NAME"
                 })
                .filter("WHERE CNTR_CODE = IT")
                .type("FEATURES|SILENT|NOLEGEND")
                .style({
                    colorscheme: [
                        "white"
                    ],
                    fillopacity: "0.7",
                    linecolor: "black",
                    linewidth: "0.2",
                    showdata: true,
                    titlefield: "NUTS_NAME",
                    featureupper: "1:2000000",
                    featurelower: "1:500000",
                    name: "nuts3"
                })
            );

        const georef_comuni =
            ixmaps.layer("ITALIA_Comuni_2022")
            .data({
                url: "https://s3.eu-central-1.amazonaws.com/maps.ixmaps.com/Istat/comuni_2022/Com01012022_s_WGS84.topojson.gz",
                type: "topojson"
            })
            .binding({
                id: "PRO_COM_T",
                position: "geometry"
            })
            .type("FEATURES|NOLEGEND")
            .style({
                colorscheme: ["none"],
                fillopacity: "1",
                linecolor: "none",
                linewidth: "0.1",
                sizefield: "Shape_Area"
            })
            .define();

        const chart_2024_aggregated =
            ixmaps.layer("ITALIA_Comuni_2022")
            .data({
                query: query.toString(),
                type: "ext",
                name: "data",
                cache: true
            })
            .binding({
                value: "F",
                value100: "Total",
                title: "denominazione_comune",
                position: "CODICE_ISTAT"
            })
            .type("CHART|PIE|AUTOCOMPLETE|SIZE|VALUES|ZEROISNOTVALUE|AGGREGATE|TEXTLEGEND")
            .style({
                name: "chart1",
                colorscheme: [
                     "#FF0069",
                ],
                label: [
                    "femmine"
                ],
                nodatacolor: "black",
                fillopacity: "1",
                shadow: "false",
                units: "%",
                normalsizevalue: "500",
                minaggregation: "3",
                sizefield: "Total",
                minvalue: "1",
                textcolor: "#ffffff",
                textscale: "3",
                fadenegative: 0.2,
                linecolor: "white",
                linewidth: "1",
                valuescale: "2",
                valuedecimals: "0",
                sizepow: "3",
                showdata: "true",
                chartlower: "1:500000",
                aggregationscale: [
                    "1:1", "CODICE_ISTAT",
                    "1:200000", "codice_provincia",
                    "1:2000000", "codice_regione"
                ],
                datafields: ["data_elezione","codice_regione"]
            })
            .meta({
                title: "<div style='background:rgba(245,244,238,0.9);padding:0.2em'>Amministratori locali</div>",
                description: "<div style='width:70%;background:rgba(245,244,238,0.9);padding:0.5em'>Percentuale delle amministratori femminili tra Sindaci, Assessori e Consiglieri.<br>Aggiornato al febbraio 2025</div>",
                tooltip: "<h2 style='margin:0'>{{theme.item.title}}</h2>{{theme.item.chart}}con l'elezione del <b><big>{{data_elezione}}</big><b>"
            })
            .define();

        const chart_2024_comuni =
            ixmaps.layer("ITALIA_Comuni_2022")
            .data({
                query: query.toString(),
                type: "ext",
                name: "data",
                cache: true
            })
            .binding({
                value: "F",
                value100: "Total",
                size: "popolazione_censita_alla_data_elezione",
                title: "denominazione_comune",
                position: "CODICE_ISTAT"
            })
            .type("CHART|PIE|AUTOCOMPLETE|SIZE|VALUES|ZEROISNOTVALUE|BOX|BOTTOMTITLE|TEXTLEGEND")
            .style({
                name: "chart2",
                colorscheme: [
                     "#FF0069",
                ],
                label: [
                    "femmine"
                ],
                nodatacolor: "black",
                fillopacity: "1",
                shadow: "false",
                units: "%",
                normalsizevalue: "100000",
                minaggregation: "3",
                sizefield: "Total.1",
                minvalue: "1",
                valuecolor: "#ffffff",
                textcolor: "#000000",
                textscale: "0.5",
                fadenegative: 0.2,
                boxcolor: "none",
                bordercolor: "none",
                linecolor: "white",
                linewidth: "1",
                valuescale: "2",
                valuedecimals: "0",
                sizepow: "3",
                showdata: "true",
                datafields: "data_elezione",
                chartupper: "1:500000"
            })
            .meta({
                title: "<div style='background:rgba(245,244,238,0.9);padding:0.2em'>Amministratori locali</div>",
                description: "<div style='width:70%;background:rgba(245,244,238,0.9);padding:0.5em'>Percentuale delle amministratori femminili tra Sindaci, Assessori e Consiglieri.<br>Aggiornato al febbraio 2025</div>",
                tooltip: "<h2 style='margin:0'>{{theme.item.title}}</h2>{{theme.item.chart}}con l'elezione del <b><big>{{data_elezione}}</big><b>"
            })
            .define();
        
        
        const chart_pie_2022 =
            ixmaps.layer("ITALIA_Comuni_2022")
            .data({
                query: query_diff.toString(),
                type: "ext",
                name: "data_diff",
                cache: true
            })
            .binding({
                value: "M.1|F.1",
                value100: "Total.1",
                position: "CODICE_ISTAT.1"
            })
            .type("CHART|PIE|SIZE|AGGREGATE|NOLEGEND")
            .style({
                name: "chart1",
                colorscheme: [
                    "none",
                    "#FF0069",
                ],
                fillopacity: "0.5",
                shadow: "false",
                units: "%",
                normalsizevalue: "1000",
                minaggregation: "3",
                sizefield: "Total.1",
                minvalue: "1",
                textcolor: "#666666",
                textscale: "3",
                fadenegative: 0.2,
                linewidth: "0",
                titlefield: "codice_regione.1",
                valuescale: "1",
                valuedecimals: "1",
                sizepow: "3",
                showdata: "true",
                aggregationscale: [
                    "1:1", "CODICE_ISTAT.1",
                    "1:200000", "codice_provincia.1",
                    "1:2000000", "codice_regione.1"
                ],
                datafields: ["data_elezione_1","codice_regione.1"],
                chartupper: "1:10000000"
            })
            .meta({
                title: "Amministratori locali femminili",
                tooltip: "<h2 style='margin:0'>{{theme.title}}</h2>{{theme.item.chart}}con l'elezione del <b><big>{{data_elezione_1}}</big><b>"
            })
            .define();

        const chart_donut_2024 =
            ixmaps.layer("ITALIA_Comuni_2022")
            .data({
                query: query_diff.toString(),
                type: "ext",
                name: "data_diff",
                cache: true
            })
            .binding({
                value: "M.2|F.2",
                value100: "Total.1",
                position: "CODICE_ISTAT.1"
            })
            .type("CHART|PIE|DONUT|THIN|SIZE|AGGREGATE|NOLEGEND")
            .style({
                name: "chart2",
                colorscheme: [
                    "white",
                    "#FF0069",
                ],
                fillopacity: "1",
                shadow: "false",
                units: "%",
                normalsizevalue: "500",
                minaggregation: "3",
                sizefield: "Total.1",
                minvalue: "1",
                textcolor: "#666666",
                textscale: "3",
                fadenegative: 0.2,
                linecolor: "#000000",
                linewidth: "0.5",
                titlefield: "codice_regione.1",
                valuescale: "1",
                valuedecimals: "1",
                sizepow: "3",
                showdata: "true",
                aggregationscale: [
                    "1:1", "CODICE_ISTAT.1",
                    "1:200000", "codice_provincia.1",
                    "1:2000000", "codice_regione.1"
                ],
                datafields: ["data_elezione_2","codice_regione.1"],
                chartupper: "1:10000000"
            })
            .meta({
                title: "Amministratori locali femminili",
                tooltip: "<h2 style='margin:0'>{{theme.title}}</h2>{{theme.item.chart}}con l'elezione del <b><big>{{data_elezione_2}}</big><b>"
            })
            .define();

        const chart_arrow_f =
            ixmaps.layer("ITALIA_Comuni_2022")
            .data({
                query: query_diff.toString(),
                type: "ext",
                name: "data_diff",
                cache: true
            })
            .binding({
                value: "F.1|F.2",
                value100: "Total.1",
                position: "CODICE_ISTAT.1"
            })
            .type("CHART|USER|VALUES|DIFFERENCE|AGGREGATE|RECT|SUM|SIZEP2|TEXTLEGEND")
            .style({
                name: "chart3",
                userdraw: "arrowChart",
                colorscheme: [
                    "#FF0069"
                ],
                fillopacity: "1",
                shadow: "false",
                units: "%",
                normalsizevalue: "5",
                valuefield: "$title$",
                //sizefield: "popolazione_censita_alla_data_elezione",
                valuecolor: "#000000",
                textscale: "2",
                fadenegative: "1.2",
                linecolor: "#444444",
                linewidth: "0.5",
                rotation: "0",
                titlefield: "denominazione_comune.1",
                valuescale: "1.5",
                valuedecimals: "1",
                showdata: "true",
                aggregationscale: [
                    "1:1", "CODICE_ISTAT.1",
                    "1:200000", "codice_provincia.1",
                    "1:2000000", "codice_regione.1"
                ],
                datafields: ["data_elezione_2"],
                chartupper: "1:10000000",
            })
            .meta({
                title: "Aumento degli amministratori femminili dal 2022 al 2025",
                description: "<div style='max-width:50%'>Avvenuto tramite elezione e in comuni con almeno 7 amministratori prima e dopoo le elezioni</div>",
                tooltip: "{{theme.item.chart}}{{theme.title}} con l'elezione fino al <b><big>{{data_elezione_2}}</big><b>",
                legend: "test"
            })
            .define();
        
        const chart_diff_arrow_f =
            ixmaps.layer("ITALIA_Comuni_2022")
            .data({
                query: query_diff.toString(),
                type: "ext"
            })
            .binding({
                value: "F.1|F.2",
                position: "CODICE_ISTAT.1"
            })
            .type("CHART|USER|DIFFERENCE|SIZE|VALUES|CIRCULARBOX|BOTTOMTITLE|TEXTLEGEND")
            .style({
                name: "chart1",
                userdraw: "arrowChart",
                colorscheme: [
                    "#FF0069"
                ],
                fillopacity: "0.4",
                shadow: "false",
                units: "",
                normalsizevalue: "100",
                valuefield: "$title$",
                //sizefield: "popolazione_censita_alla_data_elezione",
                minvalue: "1",
                textcolor: "#666666",
                textscale: "0.7",
                fadenegative: 0.2,
                linewidth: "0.5",
                rotation: "335",
                boxcolor: "none",
                bordercolor: "none",
                boxupper: "1:500000",
                valueupper: "1:200000",
                titlefield: "denominazione_comune.1",
                valuescale: "2",
                valuedecimals: "0",
                sizepow: "2",
                chartupper: "1:10000000"
            })
            .meta({
                title: "<div style='background:rgba(245,244,238,0.9);padding:0.2em'>Fluttuazione</div>",
                description: "<div style='width:70%;background:rgba(245,244,238,0.9);padding:0.5em'>Amministratori femminili o maschili in più o in meno tra Sindaci, Assessori e Consiglieri.<br>Dal 2022 al 2025</div>",
                tooltip: "<div style='white-space:nowrap'><h2 style='margin:0'>{{theme.item.title}}</h2>{{theme.title}}{{theme.item.chart}}con l'elezione del <b><big>{{data_elezione_2}}</big><b></div>"
            })
            .define();

        const chart_diff_arrow_m =
            ixmaps.layer("ITALIA_Comuni_2022")
            .data({
                query: query_diff.toString(),
                type: "ext"
            })
            .binding({
                value: "M.1|M.2",
                 position: "CODICE_ISTAT.1"
            })
            .type("CHART|USER|DIFFERENCE|SIZE|VALUES|CIRCULARBOX|BOTTOMTITLE|NOLEGEND")
            .style({
                name: "chart2",
                userdraw: "arrowChart",
                colorscheme: [
                    "black"
                ],
                fillopacity: "0.4",
                shadow: "false",
                units: "",
                normalsizevalue: "100",
                valuefield: "$title$",
                //sizefield: "popolazione_censita_alla_data_elezione",
                minvalue: "1",
                textcolor: "#666666",
                textscale: "0.7",
                fadenegative: 0.2,
                linewidth: "0.5",
                rotation: "25",
                boxcolor: "none",
                bordercolor: "none",
                boxupper: "1:500000",
                valueupper: "1:200000",
                titlefield: "denominazione_comune.1",
                valuescale: "2",
                valuedecimals: "0",
                sizepow: "2",
                chartupper: "1:10000000"
            })
            .meta({
                title: "Amministratori maschili",
                tooltip: "<div style='white-space:nowrap'><h2 style='margin:0'>{{theme.item.title}}</h2>{{theme.title}}{{theme.item.chart}}con l'elezione del <b><big>{{data_elezione_2}}</big><b></div>"
            })
            .define();

        const chart_curves_eta =
            ixmaps.layer("ITALIA_Comuni_2022")
            .data({
                query: query_extended_age.toString(),
                type: "ext"
            })
            .binding({
                value: "20.1|20.2|30.1|30.2|40.1|40.2|50.1|50.2|60.1|60.2|70.1|70.2|80.1|80.1|90.1|90.2",
                position: "CODICE_ISTAT.1"
            })
            .type("CHART|SYMBOL|SEQUENCE|PLOT|AREA|LINES|GRID|BOX|GRIDSIZE|AGGREGATE|RECT|SUM|ZEROISVALUE|UNDEFINEDISVALUE|SIMPLELEGEND")
            .style({
                name: "chart1",
                colorscheme: [
                    "#000000",
                    "#FF0069"
                ],
                label: [
                    "maschi",
                    "femmine"
                ],
                fillopacity: "0.07",
                shadow: "false",
                symbols: [
                    "none"
                ],
                xaxis: [
                    "20",
                    "30",
                    "40",
                    "50",
                    "60",
                    "70",
                    "80",
                    "90"
                ],
                units: "",
                units100: "",
                refreshtimeout: "0",
                scale: "0.8",
                rangescale: "2.5",
                maxvalue: "auto",
                offsetx: "-20",
                offsety: "-80",
                textcolor: "#444444",
                textscale: "1",
                linewidth: "3",
                bordercolor: "none",
                boxopacity: "0.05",
                titlefield: "denominazione_comune.1",
                valuescale: "1",
                valuedecimals: "0",
                fadenegative: "1",
                gridx: "2",
                showdata: true,
                aggregationscale: [
                    "1:1", "250px",
                    "1:500000", "codice_provincia.2",
                    "1:2000000", "codice_regione.2"
                ],
                gridoffsety: "70",
                align: "left",
            })
            .meta({
                title: "Amministrazioni locali per sesso ed età",
                tooltip: "{{theme.item.chart}}{{theme.item.data}}"
            })
            .define();

        


        // ---------------------------------------------------
        // e m b e d   t h e   m a p  
        // ---------------------------------------------------

        /**
         **
         ** create the interactive map an append it to the document 
         **
         **/

        ixmaps.embed("map_div", {
                mapService: "leaflet_vt",
                mapType: "Stamen - toner-lite",
                map: "../../maps/svg/maps/generic/mercator.svg",
                legend: ((__legend == true) ? "true" : 0),
                align: "left",
                mode: "pan",
                tools: true,
                about: "test"
            },
            map => map

            .view([__lat || 42.101063417335624, __lon || 14.1432535944631], __zoom || 6.3)
            .options({
                featurescaling: "true",
                objectscaling: "dynamic",
                normalSizeScale: "5000000",
                flushChartDraw: "1000000",
                flushPaintShape: "1000000",
                basemapopacity: "0.5",
                panhidden: "false"
            })
            .local("aggregated", "")
            .local("... creating theme ...", "...")
            .local("loading data ...", "scaricando dati ...")
            .require("../../ui/js/tools/tooltip_mustache.js")
            .require("https://d3js.org/d3.v3.min.js")
            .require("https://gjrichter.github.io/pages/DataVizi/js/arrow_chart.js")
            .attribution(attribution)
            //.legend("<h1 style='padding:0.2em 0.5em;border-radius:0.5em;background:RGBA(255,255,255,0.5)'>Variazione della <span style='color:#884488'>fascia d'età 65+  (%)</span> dal 2003 al 2023 </h1>")		 

            // -----------------------------		 
            // the data visualization layer 
            // -----------------------------

                .layer(georef_comuni)
                .layer(nuts2)
                .layer(nuts22)
                .layer(nuts3)
                .layer(chart_2024_aggregated)
                .layer(chart_2024_comuni)
         );


        // ----------------------------------------------
        // window resize handling
        // ----------------------------------------------

        $(window).resize(function() {
            $("#regis_map").css("height", (window.innerHeight - 5) + "px");
        });
        
        // ----------------------------------------------
        // things to do on zoom and pan
        // ----------------------------------------------
        
        ixmaps.htmlgui_onZoomAndPan = function () {
 			var nOpacity = (ixmaps.getZoom() - 7) / 10;
			ixmaps.setBasemapOpacity(null, nOpacity, "absolute");
        }
       
        // ----------------------------------------------
        // show actual map HTML page
        // ----------------------------------------------
        
        var fCode = false;
        const __openSidebar = (url) => {
            const $sidebar = $("#map_code_div-project");
            $sidebar.load(url, (response, status, xhr) => {
                if (status === "error") {
                    alert(`Sorry but there was an error: ${xhr.status}\n${xhr.statusText}`);
                }
            });
        };
        
        __dataTheme = function() {
            if (fCode){
                $("#map_code_div-project").html(""); 
                $("#map_code_div-project").hide();
              } else {
                __openSidebar('../../../pages/ISPRA/show_map_HTML.html');
                $("#map_code_div-project").show();
             }
            fCode = !fCode;
        }
        

    </script>

</body>

</html>
