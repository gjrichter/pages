<!DOCTYPE html>
<html>

<!-- **********************************************************************

ixmaps map embed html

$Comment: ixmaps map template; embedded version
$Source : index_only_map_embed.html,v $

$InitialAuthor: guenter richter $
$InitialDate: 2023/04/22 $
$Author: guenter richter $
$Id:index_embed_Open_Data_PNRR_Dati_Universo_REGIS_III.html 1 2023-04-22 00:00:00Z Guenter Richter $

licensed under CC-BY
$Log:index_only_map_embed.html,v $

********************************************************************** -->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="ixmaps embed example">
    <meta name="author" content="guenter richter">
    <link rel="shortcut icon" href="https://gjrichter.github.io/ixmaps/ui/resources/images/ixmaps_logo.png">

    <title>ISTAT Indice di fragilità</title>
    <meta name="description" content="La mappa interattiva per esplorare i dati aperti di ISTAT sull'Indice composito di fragilità dei comni italiani">

    <style>
        a {
            text-decoration: none;
            color: #444444;
        }

        a:hover {
            color: cornflowerblue;
        }

        ul {
            font-family: raleway;
            padding-inline-start: 1.5em;
        }
        
        li.active a {
            color: white;
            background-color: #24A2AF;
            xxpadding: 0.2em;
        }

        a.active {
            color: white;
            background-color: #24A2AF;
            xxpadding: 0.2em;
        }

        .sidebar {
            position: absolute;
            right: 5%;
            top: 150px;
            text-align: left;
            font-family: Georgia;
            font-size: 1.1em;
            line-height: 1.2em;
            max-width: 28%;
            background-color: rgba(247, 246, 239, 0.8)
        }

    </style>

</head>

<body style='text-align:center;background:#F7F6EF;margin:0;padding:0'>

    <!--
    <div id="logo" style="position:absolute;top:30px;right:90px"><div style="font-family:helvetica;font-size:40px;line-height:0.7em;font-weight:bold;color:burlywood ;text-align:left">Italia<br><span style="font-size:33px">inDati</span></div></div>
    -->

    <div id="logo" style="position:absolute;top:25px;right:6%">
        <a href="javascript:__toggleProjectHTML()">
            <div style="font-family:helvetica;font-size:48px;line-height:0.8em;font-weight:bold;color:burlywood ;text-align:left">Data<br><span style="font-size:48px;padding-left:2px">Viz</span><em> i</em></div>
        </a>
    </div>

    <div style="margin:auto">

        <div id="map_div"></div>

        <div id="sidebar_div" class="sidebar">
            <ul>
                <li class="select" style="font-family:helvetica;font-size:1.3em;line-height:1.2em">
                    <b>Consumo del suolo </b> <b>2023</b>

                </li>
                <hr>
                <p>Visualizzazioni dei dati rilasciati dal ISPRA e resi fruibili da Andrea Borruso</p>
                     <li >
                        <a class="select active" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_1).add(__theme_1_curves)">Percentuale del suolo consumato (a)</a><a  class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_1a)">, (b)</a><a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_1b)">, (c)</a>
                    </li>
                <ul>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2)"> - entro 300 metri dalla costa</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_1)"> - entro 150 m da corpi idrici permanenti</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_2)"> - in aree pericolosità frane (P5)</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_3_2)"> - in aree pericolosità idriaulica (P2)</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_3)"> - in aree pericolosità idriaulica (P3)</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_3_s)"> - in aree pericolosità sismica alta</a>
                    </li>
                </ul></li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_4_01)">Incremento del suolo cunsumato 2006/2023</a><a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_4_01_rel)"> - %</a>
                    </li>
                <ul>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_4_P4)"> - in zone di pericolosità idraulica P2</a><a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_4_P4_rel)"> - %</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_4_P7)"> - in zone di pericolosità idraulica P3</a><a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_4_P7_rel)"> - %</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_4_S2)"> - in zone di pericolosità sismica molto alta</a><a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_2_4_S2_rel)"> - %</a>
                    </li>
                    
                    
                    
                </ul>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('chart').replace('choropleth',__theme_3)">Largest patch size e medium patch size e dispersione </a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('chart').replace('choropleth',__theme_4)">Edge density e consumo del suolo</a>
                    </li>
                    <br>
                    Dati complementari
                    <ul>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_6)">Superficie a rischio di frane</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_10)">Tasso di incremento della popolazione</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_11)">Densità delle unità locali dell’industria e dei servizi - (ventile)</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_12)">Addetti in unità locali a bassa produttività di settore per l’industria e i servizi - (ventile)</a>
                    </li>
                    <li>
                        <a class="select" href="javascript:ixmaps.map().remove('choropleth').remove('chart').add(__theme_sis_pop)">Popolazione in zona sismica </a>
                    </li>
                        
                     <div style="margin-top:0.5em;color:#888888">(clicca sui elementi)</div>
                </ul>
            </ul>
        </div>
        
        <div id="map_code_div-project" style="position:absolute;top:10px;left:10px;text-align:left;width:50%;height:800px;overflow:auto;display:none;xxbox-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);"></div>
        <div id="map_code_div-project_save" style="position:absolute;top:20px;right:220px;text-align:left;width:50%;display:none">
            <button><a href="javascript:__copyToClipboard()">copy to clipboard</a></button>
            <button><a href="javascript:__saveTextAsFile('map.html')">save to file</a></button>
        </div>

    </div>

    <!-- ------------------------------------- -->
    <!--                                       -->
    <!-- c o d e                         -->
    <!--                                       -->
    <!-- ------------------------------------- -->

    <!--========================================================================= -->

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
    <script src="https://gjrichter.github.io/ixmaps_test/ui/js/htmlgui_api.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <style>
        .hljs {
            background: #ffffff;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="./js/json_config.js"></script>
    
    <!--========================================================================= -->

    <script type="text/javascript" charset="utf-8">
        /** 
         ** change background color on select
         **/

        __select = (el) => {
            $(".select").removeClass("active");
            el.addClass("active");
        };
        $(".select").attr("onclick", "__select($(this))");

        // ---------------------------------------------------
        // ---------------------------------------------------
        //
        // t h e   m a p 
        //
        // ---------------------------------------------------
        // ---------------------------------------------------

        /**
         ** ************************************
         ** define the ixmaps themes and project
         ** ************************************
         **/

        var __filter = "";
        var __lat = null;
        var __lon = null;
        var __zoom = null;
        var __scale_chart = 1;
        var __legend = true;

        /**
         ** strings used by the map 	
         **/

        attribution =
            "powered by <a href=\"http://ixmaps.com\" target=\"_blank\">iXMaps</a>";

        /**
         ** get query params and adapt theme and project definitions 	
         **/

        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });

        if (params.filter) {
            __filter = params.filter;
        }

        if (params.view) {
            var latlonA = params.view.split('[')[1].split(']')[0].split(',');
            __lat = latlonA[0];
            __lon = latlonA[1];
            __zoom = parseFloat(params.view.split(',')[2]);
            //setTimeout("ixmaps.setView(null,"+params.view+")",1000);
        };

        if (params.scale) {
            __scale_chart = params.scale;
        };

        if (params.legend) {
            __legend = params.legend;
        };

        // ---------------------------------------------------
        // t h e   d a t a 
        // ---------------------------------------------------

        var query = (themeObj, options) => {

            var szUrl1 = "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISTAT/Fragilita/Indice%20composito%20di%20fragilit%C3%A0%20e%20sue%20componenti%20-%20livello%20comunale_pivot_2018_2019_2021.csv.gz";
            var szUrl2 = "https://raw.githubusercontent.com/ondata/liberiamoli-tutti/main/ries/data/comuni_dimensioni.csv";
            var broker = new Data.Broker()
                .addSource(szUrl1, "csv")
                .addSource(szUrl2, "csv")
                .realize(
                    function(dataA) {
                        var nome_comuneA = dataA[1].lookupArray({
                            key: "PRO_COM_T",
                            value: "istat_comune_nome"
                        });
                        dataA[0].addColumn({
                            source: "REF_AREA",
                            destination: "NOME_COMUNE"
                        }, value => {
                            return nome_comuneA[value];
                        });
                        options.type = "dbtable";
                        ixmaps.setExternalData(dataA[0], options);
                    });
        }

        process_pivot = (data) => {
            
            data = data.pivot({
                lead:"PRO_COM_TEXT",
                keep: "Nome_Comune",
                columns: "anno",
                value: "CSUOLO4"
            });
            return data;
        }
        process_pivot_CSUOLO1 = (data) => {
            
            data = data.pivot({
                lead:"PRO_COM_TEXT",
                keep: "Nome_Comune",
                columns: "anno",
                value: "CSUOLO1"
            });
            return data;
        }
        
        process_pivot_P69 = (data) => {
            
            let indexP2 = data.column("PIDRAU4").index;
            let indexP3 = data.column("PIDRAU7").index;
            data.addColumn({destination:"PIDRAU69"},(row) => {
                return  Number(row[indexP2])+Number(row[indexP3]);          
            });
           
            data = data.pivot({
                lead:"PRO_COM_TEXT",
                keep: "Nome_Comune",
                columns: "anno",
                value: "PIDRAU69"
            });
            return data;
        }
        
        process_pivot_P4 = (data) => {
            
            data = data.pivot({
                lead:"PRO_COM_TEXT",
                keep: "Nome_Comune",
                columns: "anno",
                value: "PIDRAU4"
            });
            return data;
        }
        
        process_pivot_P7 = (data) => {
            
            data = data.pivot({
                lead:"PRO_COM_TEXT",
                keep: "Nome_Comune",
                columns: "anno",
                value: "PIDRAU7"
            });
            return data;
        }
        
        process_pivot_CSISMI1 = (data) => {
            
            data = data.pivot({
                lead:"PRO_COM_TEXT",
                keep: "Nome_Comune",
                columns: "anno",
                value: "CSISMI1"
            });
            return data;
        }
        process_pivot_CSISMI2 = (data) => {
            
            data = data.pivot({
                lead:"PRO_COM_TEXT",
                keep: "Nome_Comune",
                columns: "anno",
                value: "CSISMI2"
            });
            return data;
        }
        
        process_extend = (data) => {
            
            let indexP2 = data.column("PIDRAU4").index;
            let indexP3 = data.column("PIDRAU7").index;
            data.addColumn({destination:"PIDRAU69"},(row) => {
                return  Number(row[indexP2])+Number(row[indexP3]);          
            });
        }
        
        process_all = (data) => {
            
            var pivot = data.pivot({
                lead:"PRO_COM_TEXT",
                keep: "Nome_Comune",
                columns: "anno",
                value: "CSUOLO1"
            });
            ixmaps.setExternalData(pivot, {name:"DataObj_CSUOLO1_pivot",type:"dbtable"});
            
            pivot = data.pivot({
                lead:"PRO_COM_TEXT",
                keep: "Nome_Comune",
                columns: "anno",
                value: "PIDRAU4"
            });
            ixmaps.setExternalData(pivot, {name:"DataObj_PIDRAU4_pivot",type:"dbtable"});
            
            pivot = data.pivot({
                lead:"PRO_COM_TEXT",
                keep: "Nome_Comune",
                columns: "anno",
                value: "PIDRAU7"
            });
            ixmaps.setExternalData(pivot, {name:"DataObj_PIDRAU7_pivot",type:"dbtable"});
            
            pivot = data.pivot({
                lead:"PRO_COM_TEXT",
                keep: "Nome_Comune",
                columns: "anno",
                value: "CSISMI2"
            });
            ixmaps.setExternalData(pivot, {name:"DataObj_CSISMI2_pivot",type:"dbtable"});
            
        };
        
        // ---------------------------------------------------
        // t h e   l a y e r 
        // ---------------------------------------------------

        /**
         ** define layer with reference shapes (comuni, province, regioni ) 
         **/

        /* 1. centroids of 2011, by curtesy of Andrea Borruso */
        var __georef_urban =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://raw.githubusercontent.com/aborruso/centroidiurbanfabric/master/output/ElencoUnitaAmministrative2011.geojson",
                    type: "geojson"
                })
                .binding({
                    id: "PRO_COM",
                    position: "geometry"
                })
                .type("FEATURES|NOLEGEND")
                .style({
                    colorscheme: ["none"],
                    linecolor: "none",
                    linewidth: "1",
                    scale: "0.0001"
                })
            );

        /* 2. last istat data (2022), for changes since 2011 */
        var __georef =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-central-1.amazonaws.com/maps.ixmaps.com/Istat/comuni_2022/Com01012022_s_WGS84.topojson.gz",
                    type: "topojson"
                })
                .binding({
                    id: "PRO_COM_T",
                    position: "geometry"
                })
                .type("FEATURES|NOLEGEND")
                .style({
                    colorscheme: ["none"],
                    linecolor: "none",
                    linewidth: "0.3",
                    sizefield: "Shape_Area"
                })
            );

        /* 3. confine italia */
        var __georef_ita =
            ixmaps.layer("ITALIA_2022", layer => layer
                .type("FEATURES|NOLEGEND")
                .data({
                    url: "https://gisco-services.ec.europa.eu/distribution/v2/nuts/geojson/NUTS_RG_10M_2021_4326_LEVL_0.geojson",
                    type: "geojson"
                })
                .filter("WHERE NUTS_ID = IT")
                .style({
                    colorscheme: [
                        "none"
                    ],
                    fillopacity: "0.9",
                    linecolor: "#dddddd",
                    linewidth: "0,1",
                    showdata: true,
                    featurelower: "1:2000000",
                    name: "nuts0"
                })
            );

        /* 4. confine regione */
        var __georef_reg =
            ixmaps.layer("ITALIA_Regioni_2022", layer => layer
                .data({
                    url: "https://s3.eu-central-1.amazonaws.com/maps.ixmaps.com/Istat/regioni_2022/Reg01012022_s_WGS84.topojson.gz",
                    type: "topojson"
                })
                .binding({
                    id: "COD_REG",
                    position: "geometry"
                })
                .type("FEATURES|NOLEGEND")
                .style({
                    colorscheme: ["none"],
                    linecolor: "#F7F6EF",
                    linewidth: "1.5",
                    sizefield: "Shape_Area"
                })
            );

        /* 5. last istat data (2022), province */
        var __georef_prov =
            ixmaps.layer("ITALIA_Province_2022", layer => layer
                .data({
                    url: "https://s3.eu-central-1.amazonaws.com/maps.ixmaps.com/Istat/province_2022/Prov01012022_g_WGS84.topojson.gz",
                    type: "topojson"
                })
                .binding({
                    id: "COD_PROV",
                    position: "geometry"
                })
                .type("FEATURES|NOLEGEND")
                .style({
                    colorscheme: ["none"],
                    linecolor: "white",
                    linewidth: "0.1",
                    sizefield: "Shape_Area"
                })
            );

        /**
         ** visualizzation themes 
         **/

        var __theme_1 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    name: "themeDataObj_ISPRA",
                    process: process_all.toString()
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: "CSUOLO4"
                })
                .filter("WHERE \"anno\" = 2023")
                .type("CHOROPLETH|LOGARITHMIC|DOPACITYMINMAX")
                .style({
                    colorscheme: [
                        "#EFFFEF",
                        "#C5E6BD",
                        "#9CD69C",
                        "#84BDAD",
                        "#5AADAD",
                        "#298CBD",
                        "#0073BD",
                        "#215AAD",
                        "#6B42AD",
                        "#A521AD",
                        "#CE088C",
                        "#D6314A",
                        "#EF5200",
                        "#F79C00",
                        "#F7EF10"
                    ],
		            "ranges": "1,2,3,4,5,10,15,20,25,30,35,40,50,60,70,100",	
                    fillopacity: 1,
                    dopacitypow: 3,
                    dopacityscale: 2,
                    units: "%",
                    showdata: "false",
                    name: "choropleth"
                })
                .meta({
                    title: "Percentuale del suolo consumato",
                    snippet: "<p style='max-width:70%'>Percentuale di suolo consumato sulla superficie amministrativa [%]</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>suolo consumato</h3><hr><h2>{{theme.item.value}} %</h2>{{theme.item.chart}}",
               })
            );
        
        var __theme_1_curves =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    process: process_pivot.toString(),
                    name: "themeDataObj_ISPRA_pivot"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: ["2006","2012","2018","2023"]
                })
                .type("CHART|SYMBOL|PLOT|LINES|FIXSIZE|LASTPOP|LASTVALUE|GRID|XAXIS|BOX|NOLEGEND")
                .style({
                    colorscheme: [
                        "#000000"
                    ],
				    xaxis: ["2006", "2012", "2018", "2023"],
                    fillopacity: 0.3,
                    scale: 1,
                    linewidth: 2,
                    normalsizevalue: 5,
                    units: "%",
                    valuedecimals: 1,
                    boxcolor: "none",
                    maxvalue: 80,
                    valuescale: 0.6,
                    chartupper: "1:100000",
                    showdata: "false",
                    name: "chart"
                })
                .meta({
                    title: "Percentuale di suolo consumato",
                    snippet: "<p style='max-width:70%'>Percentuale di suolo consumato sulla superficie amministrativa [%]</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>suolo consumato</h3><hr><h2>{{theme.item.value}} %</h2>{{theme.item.chart}}",
               })
            );


        var __theme_1a =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    name: "themeDataObj_ISPRA"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: "CSUOLO4"
                })
                .filter("WHERE \"anno\" = 2023")
                .type("CHOROPLETH|LOGARITHMIC|DOPACITYMINMAX")
                .style({
                    colorscheme: [
                        "#EFFFEF",
                        "#C5E6BD",
                        "#9CD69C",
                        "#84BDAD",
                        "#5AADAD",
                        "#298CBD",
                        "#0073BD",
                        "#215AAD",
                        "#6B42AD",
                        "#A521AD",
                        "#CE088C",
                        "#D6314A",
                        "#EF5200",
                        "#F79C00",
                        "#F7EF10"
                    ],
                    fillopacity: "auto",
                    dopacitypow: 1,
                    dopacityscale: 10,
                    units: "",
                    showdata: "false",
                    name: "choropleth"
                })
                .meta({
                    title: "Percentuale di suolo consumato",
                    snippet: "<p style='max-width:70%'>Percentuale di suolo consumato sulla superficie amministrativa [%]</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>suolo consumato</h3><hr><h2>{{theme.item.value}} %</h2>{{theme.item.chart}}",
                })
            );

        var __theme_1b =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    name: "themeDataObj_ISPRA"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: "CSUOLO4"
                })
                .filter("WHERE \"anno\" = 2023")
                .type("CHOROPLETH|LOGARITHMIC|DOPACITYMAX")
                .style({
                    colorscheme: [
                        "#EFFFEF",
                        "#C5E6BD",
                        "#9CD69C",
                        "#84BDAD",
                        "#5AADAD",
                        "#298CBD",
                        "#0073BD",
                        "#215AAD",
                        "#6B42AD",
                        "#A521AD",
                        "#CE088C",
                        "#D6314A",
                        "#EF5200",
                        "#F79C00",
                        "#F7EF10"
                    ],
                    fillopacity: 1,
                    dopacitypow: 2,
                    dopacityscale: 2,
                    units: "",
                    showdata: "false",
                    name: "choropleth"
                })
                .meta({
                    title: "Percentuale di suolo consumato",
                    snippet: "<p style='max-width:70%'>Percentuale di suolo consumato sulla superficie amministrativa [%]</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>suolo consumato</h3><hr><h2>{{theme.item.value}} %</h2>{{theme.item.chart}}",
                })
            );

        var __theme_2_2 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    name: "themeDataObj_ISPRA"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: "PFRANE15"
                })
                .filter("WHERE \"anno\" = 2023")
                .type("CHOROPLETH|EQUIDISTANTE|DOPACITYMINMAX")
                .style({
                    colorscheme: [
                        "#EFFFEF",
                        "#C5E6BD",
                        "#9CD69C",
                        "#84BDAD",
                        "#5AADAD",
                        "#298CBD",
                        "#0073BD",
                        "#215AAD",
                        "#6B42AD",
                        "#A521AD",
                        "#CE088C",
                        "#D6314A",
                        "#EF5200",
                        "#F79C00",
                        "#F7EF10"
                    ],
		            ranges: "1,2,3,4,5,10,15,20,25,30,35,40,50,60,70,100",	
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 5,
                    units: "%",
                    showdata: "false",
                    name: "choropleth"
                })
                .meta({
                    title: "Percentuale di suolo consumato",
                    snippet: "<p style='max-width:70%'>Superficie di suolo consumato in aree di attenzione AA (P5) dei Piani di Assetto Idrogeologico (PAI), di cui l’ISPRA ha effettuato un’armonizzazione delle legende [%]</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>suolo consumato in aree di attenzione AA (P5) dei Piani di Assetto Idrogeologico (PAI)</h3><hr><h2>{{theme.item.value}} %</h2>{{theme.item.chart}}",
                })
            );

        var __theme_2_3 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    name: "themeDataObj_ISPRA"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: "PIDRAU9"
                })
                .filter("WHERE \"anno\" = 2023")
                .type("CHOROPLETH|EQUIDISTANTE|DOPACITYMINMAX")
                .style({
                    colorscheme: [
                        "#EFFFEF",
                        "#C5E6BD",
                        "#9CD69C",
                        "#84BDAD",
                        "#5AADAD",
                        "#298CBD",
                        "#0073BD",
                        "#215AAD",
                        "#6B42AD",
                        "#A521AD",
                        "#CE088C",
                        "#D6314A",
                        "#EF5200",
                        "#F79C00",
                        "#F7EF10"
                    ],
		            ranges: "1,2,3,4,5,10,15,20,25,30,35,40,50,60,70,100",	
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 10,
                    units: "%",
                    showdata: "false",
                    name: "choropleth"
                })
                .meta({
                    title: "Percentuale di suolo consumato",
                    snippet: "<p style='max-width:70%'>Percentuale di suolo consumato in aree a pericolosità idraulica alta (P3) con tempi di ritorno fra 20 e 50 anni (alluvioni frequenti)</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>suolo consumato in aree a pericolosità idraulica alta (P3)</h3><hr><h2>{{theme.item.value}} %</h2>{{theme.item.chart}}",
                })
            );

        var __theme_2_3_s =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    name: "themeDataObj_ISPRA"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: "CSISMI6"
                })
                .filter("WHERE \"anno\" = 2023")
                .type("CHOROPLETH|LOGARITHMIC|DOPACITYMINMAX")
                .style({
                    colorscheme: [
                        "#EFFFEF",
                        "#C5E6BD",
                        "#9CD69C",
                        "#84BDAD",
                        "#5AADAD",
                        "#298CBD",
                        "#0073BD",
                        "#215AAD",
                        "#6B42AD",
                        "#A521AD",
                        "#CE088C",
                        "#D6314A",
                        "#EF5200",
                        "#F79C00",
                        "#F7EF10"
                    ],
		            ranges: "1,2,3,4,5,10,15,20,25,30,35,40,50,60,70,100",	
                    fillopacity: 1,
                    dopacitypow: 3,
                    dopacityscale: 2,
                    units: "%",
                    showdata: "false",
                    name: "choropleth"
                })
                .meta({
                    title: "Percentuale di suolo consumato",
                    snippet: "<p style='max-width:70%'>Percentuale di suolo consumato in aree a pericolosità sismica molto alta</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>suolo consumato in aree a pericolosità sismica molto alta</h3><hr><h2>{{theme.item.value}} %</h2>{{theme.item.chart}}",
                })
            );

        var __theme_2_3_2 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                     name: "themeDataObj_ISPRA"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: "PIDRAU6"
                })
                .filter("WHERE \"anno\" = 2023")
                .type("CHOROPLETH|EQUIDISTANTE|DOPACITYMINMAX")
                .style({
                    colorscheme: [
                        "#EFFFEF",
                        "#C5E6BD",
                        "#9CD69C",
                        "#84BDAD",
                        "#5AADAD",
                        "#298CBD",
                        "#0073BD",
                        "#215AAD",
                        "#6B42AD",
                        "#A521AD",
                        "#CE088C",
                        "#D6314A",
                        "#EF5200",
                        "#F79C00",
                        "#F7EF10"
                    ],
		            ranges: "1,2,3,4,5,10,15,20,25,30,35,40,50,60,70,100",	
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 10,
                    units: "%",
                    showdata: "false",
                    name: "choropleth"
                })
                .meta({
                    title: "Percentuale di suolo consumato",
                    snippet: "<p style='max-width:70%'>Percentuale di suolo consumato in aree a pericolosità idraulica alta (P2) con tempi di ritorno fra 100 e 200 anni (alluvioni poco frequenti)</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>suolo consumato in aree a pericolosità idraulica alta (P2)</h3><hr><h2>{{theme.item.value}} %</h2>{{theme.item.chart}}",
                })
            );

        var __theme_2_4 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    process: process_pivot.toString(),
                    name: "themeDataObj_ISPRA_pivot"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: ["2006","2023"]
                })
                 .type("CHART|BAR|POINTER|ARROW|SIZE|DIFFERENCE|VALUES|DVALUE")
                .style({
                    colorscheme: [
                        "#D6314A"
                    ],
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 2,
                    linecolor: "white",
                    linewidth: "2",
                    minvaluesize: 5,
                    scale: 1,
                    units: "%",
                    showdata: "false",
                    name: "chart"
                })
                .meta({
                    title: "Incremento relativo",
                    snippet: "<p style='max-width:70%'>Percentuale di suolo consumato in aree a pericolosità idraulica alta (P3) con tempi di ritorno fra 20 e 50 anni (alluvioni frequenti)</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>incremento relativo del suolo consumato</h3><hr>{{theme.item.chart}}",
                })
            );

        var __theme_2_4_01 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    process: process_pivot_CSUOLO1.toString(),
                    name: "DataObj_CSUOLO1_pivot"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: ["2006","2023"]
                })
                 .type("CHART|BAR|POINTER|ARROW|SIZE|DIFFERENCE|VALUES|DVALUE|SIMPLELEGEND")
                .style({
                    colorscheme: [
                        "#D6314A"
                    ],
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 2,
                    linecolor: "white",
                    linewidth: "2",
                    minvaluesize: 5,
                    scale: 1,
                    units: "ha",
                    showdata: "false",
                    name: "chart"
                })
                .meta({
                    title: "Incremento dal 2006 al 2023",
                    snippet: "<p style='max-width:70%'>Incremento di suolo consumato dal 2006 al 2023</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>incremento relativo del suolo consumato</h3><hr>{{theme.item.chart}}",
                })
            );

        var __theme_2_4_01_rel =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    process: process_pivot_CSUOLO1.toString(),
                    name: "DataObj_CSUOLO1_pivot"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: ["2006","2023"]
                })
                 .type("CHART|BAR|POINTER|ARROW|SIZE|DIFFERENCE|RELATIVE|VALUES|DVALUE|SIMPLELEGEND")
                .style({
                    colorscheme: [
                        "#D6314A"
                    ],
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 2,
                    linecolor: "white",
                    linewidth: "2",
                    minvaluesize: 5,
                    scale: 1,
                    units: "%",
                    showdata: "false",
                    name: "chart"
                })
                .meta({
                    title: "Incremento dal 2006 al 2023",
                    snippet: "<p style='max-width:70%'>Incremento di suolo consumato dal 2006 al 2023</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>incremento relativo del suolo consumato</h3><hr>{{theme.item.chart}}",
                })
            );

        var __theme_2_4_P7 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    process: process_pivot_P7.toString(),
                    name: "DataObj_PIDRAU7_pivot"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: ["2006","2023"]
                })
                .type("CHART|BAR|POINTER|ARROW|SIZEP4|DIFFERENCE|VALUES|DVALUE|SIMPLELEGEND")
                .style({
                    colorscheme: [
                        "#D6314A"
                    ],
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 2,
                    linecolor: "white",
                    linewidth: "2",
                    minvaluesize: 5,
                    scale: 1,
                    units: "ha",
                    showdata: "false",
                    name: "chart"
                })
                .meta({
                    title: "Incremento dal 2006 al 2023",
                    snippet: "<p style='max-width:70%'>Aumento del suolo consumato in aree a pericolosità idraulica alta (P3) con tempi di ritorno fra 20 e 50 anni (alluvioni frequenti)</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>incremento in zone di pericolosità idraulica P3</h3><hr>{{theme.item.chart}}",
                })
            );

        var __theme_2_4_P7_rel =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    process: process_pivot_P7.toString(),
                    name: "DataObj_PIDRAU7_pivot"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: ["2006","2023"]
                })
                .type("CHART|BAR|POINTER|ARROW|SIZEP4|DIFFERENCE|RELATIVE|VALUES|DVALUE|SIMPLELEGEND")
                .style({
                    colorscheme: [
                        "#D6314A"
                    ],
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 2,
                    linecolor: "white",
                    linewidth: "2",
                    minvaluesize: 5,
                    scale: 1,
                    units: "%",
                    showdata: "false",
                    name: "chart"
                })
                .meta({
                    title: "Incremento relativo",
                    snippet: "<p style='max-width:70%'>Aumento della percentuale di suolo consumato in aree a pericolosità idraulica alta (P3) con tempi di ritorno fra 20 e 50 anni (alluvioni frequenti)</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>incremento in zone di pericolosità idraulica P3</h3><hr>{{theme.item.chart}}2006 {{2006}} ha<br>2023 {{2023}} ha",
                })
            );

       var __theme_2_4_S1 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    process: process_pivot_CSISMI1.toString(),
                    name: "DataObj_CSISMI1_pivot"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: ["2006","2023"]
                })
                .type("CHART|BAR|POINTER|ARROW|SIZEP4|DIFFERENCE|VALUES|DVALUE|SIMPLELEGEND")
                .style({
                    colorscheme: [
                        "#D6314A"
                    ],
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 2,
                    linecolor: "white",
                    linewidth: "2",
                    minvaluesize: 5,
                    scale: 1,
                    units: "ha",
                    showdata: "false",
                    name: "chart"
                })
                .meta({
                    title: "Incremento suolo consumato 2006/2023",
                    snippet: "<p style='max-width:70%'>Aumento del suolo consumato in aree a pericolosità sismica alta</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>incremento in zone di pericolosità sismica molto alta</h3><hr>{{theme.item.chart}}2006 {{2006}} ha<br>2023 {{2023}} ha",
                })
            );

       var __theme_2_4_S1_rel =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    process: process_pivot_CSISMI1.toString(),
                    name: "DataObj_CSISMI1_pivot"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: ["2006","2023"]
                })
                .type("CHART|BAR|POINTER|ARROW|SIZEP4|DIFFERENCE|RELATIVE|VALUES|DVALUE|SIMPLELEGEND")
                .style({
                    colorscheme: [
                        "#D6314A"
                    ],
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 2,
                    linecolor: "white",
                    linewidth: "2",
                    minvaluesize: 5,
                    scale: 1,
                    units: "%",
                    showdata: "false",
                    name: "chart"
                })
                .meta({
                    title: "Incremento relativo",
                    snippet: "<p style='max-width:70%'>Aumento della percentuale di suolo consumato in aree a pericolosità sismica alta</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>incremento in zone di pericolosità sismica molto alta</h3><hr>{{theme.item.chart}}2006 {{2006}} ha<br>2023 {{2023}} ha",
                })
            );

       var __theme_2_4_S2 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    process: process_pivot_CSISMI2.toString(),
                    name: "DataObj_CSISMI2_pivot"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: ["2006","2023"]
                })
                .type("CHART|BAR|POINTER|ARROW|SIZEP4|DIFFERENCE|VALUES|DVALUE|SIMPLELEGEND")
                .style({
                    colorscheme: [
                        "#D6314A"
                    ],
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 2,
                    linecolor: "white",
                    linewidth: "2",
                    minvaluesize: 5,
                    scale: 1,
                    units: "ha",
                    showdata: "false",
                    name: "chart"
                })
                .meta({
                    title: "Incremento suolo consumato 2006/2023",
                    snippet: "<p style='max-width:70%'>Aumento del suolo consumato in aree a pericolosità sismica molto alta</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>incremento in zone di pericolosità sismica molto alta</h3><hr>{{theme.item.chart}}2006 {{2006}} ha<br>2023 {{2023}} ha",
                })
            );

       var __theme_2_4_S2_rel =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    process: process_pivot_CSISMI2.toString(),
                    name: "DataObj_CSISMI2_pivot"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: ["2006","2023"]
                })
                .type("CHART|BAR|POINTER|ARROW|SIZEP4|DIFFERENCE|RELATIVE|VALUES|DVALUE|SIMPLELEGEND")
                .style({
                    colorscheme: [
                        "#D6314A"
                    ],
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 2,
                    linecolor: "white",
                    linewidth: "2",
                    minvaluesize: 5,
                    scale: 1,
                    units: "%",
                    showdata: "false",
                    name: "chart"
                })
                .meta({
                    title: "Incremento relativo",
                    snippet: "<p style='max-width:70%'>Aumento della percentuale di suolo consumato in aree a pericolosità sismica molto alta</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>incremento in zone di pericolosità sismica molto alta</h3><hr>{{theme.item.chart}}2006 {{2006}} ha<br>2023 {{2023}} ha",
                })
            );

        var __theme_2_4_P4 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    process: process_pivot_P4.toString(),
                    name: "DataObj_PIDRAU4_pivot"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: ["2006","2023"]
                })
                 .type("CHART|BAR|POINTER|ARROW|SIZEP4|DIFFERENCE|VALUES|DVALUE|SIMPLELEGEND")
                .style({
                    colorscheme: [
                        "#D6314A"
                    ],
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 2,
                    linecolor: "white",
                    linewidth: "2",
                    minvaluesize: 5,
                    scale: 1,
                    units: "ha",
                    showdata: "false",
                    name: "chart"
                })
                .meta({
                    title: "Incremento dal 2006 al 2023",
                    snippet: "<p style='max-width:70%'>Aumento del suolo consumato in aree a pericolosità idraulica alta (P2) con tempi di ritorno fra 100 e 200 anni (alluvioni poco frequenti)</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>incremento in zone di pericolosità idraulica P2</h3><hr>{{theme.item.chart}}",
                })
            );

        var __theme_2_4_P4_rel =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    process: process_pivot_P4.toString(),
                    name: "DataObj_PIDRAU4_pivot"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: ["2006","2023"]
                })
                 .type("CHART|BAR|POINTER|ARROW|SIZEP4|DIFFERENCE|RELATIVE|VALUES|DVALUE|SIMPLELEGEND")
                .style({
                    colorscheme: [
                        "#D6314A"
                    ],
                    fillopacity: 1,
                    dopacitypow: 1,
                    dopacityscale: 2,
                    linecolor: "white",
                    linewidth: "2",
                    minvaluesize: 5,
                    scale: 1,
                    units: "%",
                    showdata: "false",
                    name: "chart"
                })
                .meta({
                    title: "Incremento relativo",
                    snippet: "<p style='max-width:70%'>Aumento della percentuale di suolo consumato in aree a pericolosità idraulica alta (P2) con tempi di ritorno fra 100 e 200 anni (alluvioni poco frequenti)</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>incremento in zone di pericolosità idraulica P2+P3</h3><hr>{{theme.item.chart}}2006 {{2006}} ha<br>2023 {{2023}} ha",
                })
            );

        var __theme_2 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    name: "themeDataObj_ISPRA"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: "CCOSTE8"
                })
                .filter("WHERE \"anno\" = 2023")
                .type("CHOROPLETH|DOPACITYMAX")
                .style({
                    colorscheme: [
                        "#EFFFEF",
                        "#C5E6BD",
                        "#9CD69C",
                        "#84BDAD",
                        "#5AADAD",
                        "#298CBD",
                        "#0073BD",
                        "#215AAD",
                        "#6B42AD",
                        "#A521AD",
                        "#CE088C",
                        "#D6314A",
                        "#EF5200",
                        "#F79C00",
                        "#F7EF10"
                    ],
		            ranges: "1,2,3,4,5,10,15,20,25,30,35,40,50,60,70,100",	
                    fillopacity: 0.8,
                    dopacitypow: 2,
                    dopacityscale: 3,
                    units: "%",
                    showdata: "false",
                    name: "choropleth"
                })
                .meta({
                    title: "Percentuale di suolo consumato",
                    snippet: "<p style='max-width:60%'>Percentuale di suolo consumato all'interno di una fascia tra <b>0 e 300</b> metri dalla <b>linea di costa</b> sulla superficie amministrativa [%]</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>suolo consumato all'interno di una fascia tra 0 e 300 metri dalla linea di costa</h3><hr><h2>{{theme.item.value}} %</h2>{{theme.item.chart}}",
                })
            );

        var __theme_2_1 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    name: "themeDataObj_ISPRA"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: "CCIDRI4"
                })
                .filter("WHERE \"anno\" = 2023")
                .type("CHOROPLETH|DOPACITYMAX")
                .style({
                    colorscheme: [
                        "#EFFFEF",
                        "#C5E6BD",
                        "#9CD69C",
                        "#84BDAD",
                        "#5AADAD",
                        "#298CBD",
                        "#0073BD",
                        "#215AAD",
                        "#6B42AD",
                        "#A521AD",
                        "#CE088C",
                        "#D6314A",
                        "#EF5200",
                        "#F79C00",
                        "#F7EF10"
                    ],
		            ranges: "1,2,3,4,5,10,15,20,25,30,35,40,50,60,70,100",	
                    fillopacity: 0.8,
                    dopacitypow: 2,
                    dopacityscale: 3,
                    units: "%",
                    showdata: "false",
                    name: "choropleth"
                })
                .meta({
                    title: "Percentuale di suolo consumato",
                    snippet: "<p style='max-width:60%'>Percentuale di suolo consumato entro <b>150 metri</b> di distanca dai <b>corpi idrici permanenti</b> sulla superficie amministrativa [%]</p>",
                    splash: "scaricando dati ...",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>suolo consumato entro 150 metri di distanca dai corpi idrici permanenti</h3><hr><h2>{{theme.item.value}} %</h2>{{theme.item.chart}}",
                })
            );
        
        var __theme_3 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    name: "themeDataObj_ISPRA"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: "FORMET1|FORMET3|FORMET5",
                    alpha: "FORMET4"
                })
                .filter("WHERE \"anno\" = 2023")
                .type("CHOROPLETHE|DOMINANT|PERCENTOFMEAN||SIZE|DOPACITY|ZEROISVALUE|NEGATIVEISVALUE|NONEGATIVE|VERBOSE|SIMPLELEGEND")
                .style({
                    colorscheme: [
                        "RGB(122,2,2)",
                        "RGB(255,246,143)",
                        "RGB(255,0,0)"
                    ],
                    values: [
                        "Largest Class Patch Index",
                        "Residual Mean Patch Size",
                        "Indice di Dispersione"
                    ],
                    label: [
                        "Largest Class Patch Index",
                        "Residual Mean Patch Size",
                        "Indice di Dispersione"
                    ],
                    xaxis: [
                        "Largest Class Patch Index",
                        "Residual Mean Patch Size",
                        "Indice di Dispersione"
                    ],
                    fillopacity: 0.8,
                    dopacitypow: 1,
                    dopacityscale: 50,
                    units: "%",
                    showdata: "false",
                    name: "choropleth"
                })
                .meta({
                    title: "Largest, medium patch size e dispersione ",
                    snippet: "<p style='max-width: 60%;'><b>colore</b>: mostra l'indicatore tra largest, medium patch size e dispersione con la più grande deviazione dalla media nazionale. <b>intensità:</b> rappresenta la densità della popolazione</p>",
                    description: "fonte dati: ISPRA, licenza: IODL  ",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><hr>{{theme.item.chart}}",
                })
            );

        var __theme_3_1 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    name: "themeDataObj_ISPRA"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: "FORMET1|FORMET3|FORMET5",
                    alpha: "FORMET4"
                })
                .filter("WHERE \"anno\" = 2006")
                .type("CHOROPLETHE|DOMINANT|PERCENTOFMEAN|AXAIS|SIZE|DOPACITY|ZEROISVALUE|NEGATIVEISVALUE|NONEGATIVE|VERBOSE")
                .style({
                    colorscheme: [
                        "RGB(122,2,2)",
                        "RGB(255,246,143)",
                        "RGB(255,0,0)"
                    ],
                    values: [
                        "Largest Class Patch Index",
                        "Residual Mean Patch Size",
                        "Indice di Dispersione"
                    ],
                    label: [
                        "Largest Class Patch Index",
                        "Residual Mean Patch Size",
                        "Indice di Dispersione"
                    ],
                    xaxis: [
                        "Largest Class Patch Index",
                        "Residual Mean Patch Size",
                        "Indice di Dispersione"
                    ],
                    fillopacity: 0.8,
                    dopacitypow: 1,
                    dopacityscale: 50,
                    units: "",
                    showdata: "false",
                    name: "choropleth"
                })
                .meta({
                    title: "Largest, medium patch size e dispersione ",
                    snippet: "<b>colore</b>: indicatore con la più grande<br> deviazione dalla media nazionale<br><b>intensità:</b> rappresenta la densità<br> della popolazione",
                    description: "fonte dati: ISPRA, licenza: IODL  ",
                })
            );

        var __theme_4 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "https://s3.eu-west-1.amazonaws.com/data.ixmaps.com/ISPRAConsumoSuolo/consumo_suolo_2024.csv.gz",
                    type: "csv",
                    name: "themeDataObj_ISPRA"
                })
                .binding({
                    position: "PRO_COM_TEXT",
                    value: "FORMET2",
                    alpha: "CSUOLO4"
                })
                .filter("WHERE \"anno\" = 2023")
                .type("CHOROPLETHE|QUANTILE|DOPACITYMAX|CLEAR|VERBOSE")
                .style({
                    colorscheme: [
                        "5",
                        "RGB(124,184,50)",
                        "RGB(255,72,0)",
                        "auto",
                        "RGB(247,250,122)"
                    ],
                    fillopacity: 1,
                    dopacitypow: 0.5,
                    dopacityscale: 300,
                    units: "",
                    showdata: "false",
                    alphavalueunits: "% del suolo consumato",
                    name: "choropleth"
                })
                .meta({
                    "title": "Consumo suolo e dispersione",
                    "snippet": "<p style='max-width: 200px;'><b>Colore</b>: Edge Density, densità dei margini urbani: aumenta con la maggiore <b>frammentazione dei margini urbani</b> e con la dispersion insediativa.<br><br><b>Intensità</b>: Consumo del suolo in % della superficie amministrativa<br></p>",
                    "description": "fonte dei dati: ISPRA, licenza: IODL",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{Nome_Comune}}<h1><h3 style='margin-top:0'>edge density</h3><hr><h2>{{theme.item.value}} </h2>{{theme.item.chart}}",
                })
            );

        var __theme_6 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    query: query.toString(),
                    name: "themeDataObj_ISTAT"
                })
                .binding({
                    position: "REF_AREA",
                    value: "LANDSLIDE_HAZARD_ZONES"
                })
                .filter("WHERE \"TIME_PERIOD\" = 2021")
                .type("CHOROPLETH|DOPACITY")
                .style({
                    colorscheme: [
                        "7",
                        "#DDd7A9",
                        "#794073",
                        "3colors",
                        "#DDA729",
                    ],
                    fillopacity: "1",
                    units: "%",
                    showdata: "false",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{NOME_COMUNE}}<h1><h3 style='margin-top:0'>Superficie&nbsp;a&nbsp;rischio di frane</h3><hr><h2>{{theme.item.value}} %</h2>{{theme.item.data}}",
                    name: "choropleth"
                })
                .meta({
                    title: "Superficie a rischio di frane",
                    splash: "scaricando dati ..."
                })
            );

        var __theme_10 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    query: query.toString(),
                    name: "themeDataObj_ISTAT"
                })
                .binding({
                    position: "REF_AREA",
                    value: "POP_GROWTH_RATE"
                })
                .filter("WHERE \"TIME_PERIOD\" = 2021")
                .type("CHART|BAR|POINTER|VALUES|SIZE|DOPACITY|NEGATIVISVALUE")
                .style({
                    colorscheme: [
                        "7",
                        "#36A6B1",
                        "#794073",
                        "3colors",
                        "#DDA729"
                    ],
                    fillopacity: "1",
                    scale: "2",
                    linecolor: "black",
                    linewidth: "1",
                    units: "%",
                    showdata: "false",
                    dopacitypow: "1",
                    dopacityscale: "3",
                    minvaluesize: "4",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{NOME_COMUNE}}<h1><h3 style='margin-top:0'>Incremento&nbsp;della&nbsp;popolazione</h3><hr><h2>{{theme.item.value}} %</h2>{{theme.item.data}}",
                    name: "choropleth"
                })
                .meta({
                    title: "Tasso di incremento della popolazione",
                    splash: "scaricando dati ..."
                })
            );

        var __theme_11 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    query: query.toString(),
                    name: "themeDataObj_ISTAT"
                })
                .binding({
                    position: "REF_AREA",
                    value: "DENS_LU_IND_SERV_VENTILE"
                })
                .filter("WHERE \"TIME_PERIOD\" = 2021")
                .type("CHOROPLETH|QUANTILE|DOPACITYMAX")
                .style({
                    colorscheme: [
                        "20",
                        "#36A6B1",
                        "#F94073",
                        "3colors",
                        "#DDA729"
                    ],
                    fillopacity: "1",
                    units: "/20",
                    showdata: "false",
                    dopacitypow: "1",
                    dopacityscale: "1",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{NOME_COMUNE}}<h1><h3 style='margin-top:0'>Densità&nbsp;delle&nbsp;unità&nbsp;locali&nbsp;dell’industria e dei servizi - (ventile)</h3><hr><h2>{{theme.item.value}} (/20)</h2>{{theme.item.data}}",
                    name: "choropleth"
                })
                .meta({
                    title: "Densità delle unità locali dell’industria e dei servizi - (ventile)",
                    splash: "scaricando dati ..."
                })
            );

        var __theme_12 =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    query: query.toString(),
                    name: "themeDataObj_ISTAT"
                })
                .binding({
                    position: "REF_AREA",
                    value: "PERSEMP_LU_LOW_PRO_INDSERV_VENTILE"
                })
                .filter("WHERE \"TIME_PERIOD\" = 2021")
                .type("CHOROPLETH|QUANTILE|DOPACITY|NEGATIVISVALUE")
                .style({
                    colorscheme: [
                        "20",
                        "#36A6B1",
                        "#F94073",
                        "3colors",
                        "#DDA729"
                    ],
                    fillopacity: "1",
                    units: "",
                    showdata: "false",
                    tooltip: "<h1 style='margin:0;white-space:nowrap'>{{NOME_COMUNE}}<h1><h3 style='margin-top:0'>Addetti&nbsp;in&nbsp;unità&nbsp;locali&nbsp;a&nbsp;bassa&nbsp;produttività di settore per l’industria e i servizi - (ventile)</h3><hr><h2>{{theme.item.value}} (/20) </h2>{{theme.item.data}}",
                    name: "choropleth"
                })
                .meta({
                    title: "Addetti in unità locali a bassa produttività",
                    splash: "scaricando dati ..."
                })
            );

       var __theme_sis_pop =
            ixmaps.layer("ITALIA_Comuni_2022", layer => layer
                .data({
                    url: "../../app/ISTAT/stories/explorer/dbbroker.js",
                    type: "ext",
                    name: "query_data_world"
                })
                .binding({
                    position: "procom",
                    value: "pop_2015"
                })
                .filter("WHERE agmax_50 > 0.2")
                .type("CHART|BUBBLE|QUANTILE|VALUES|DTEXT|VALUEBACKGROUND")
                .style({
                    colorscheme: [
                        "1",
                        "RGB(149,197,38)",
                        "RGB(255,131,86)",
                        "3colors",
                        "RGB(94,182,186)"
                    ],
                    fillopacity: "0.7",
                    normalsizevalue: "100000",
                    units: "",
                    textcolor: "black",
                    linecolor: [
                        "black"
                    ],
                    linewidth: "0.5",
                    titlefield: "dzcom",
                    name: "chart"
                })
                .meta({
                    title: "indicatori: POP_2015,AGmax_50",
                    snippet: "Popolazione residente in zone sismiche con accelerazione massima superiore a 0.2 g - fonti: Ispra, INGV",
                    splash: "scaricando dati ..."
                })
            );



        // ---------------------------------------------------
        // e m b e d   t h e   m a p  
        // ---------------------------------------------------

        /**
         **
         ** create the interactive map an append it to the document 
         **
         **/

        ixmaps.embed("map_div", {
                mapService: "leaflet_vt",
                mapType: "VT_OPENSTREETMAP",
                map: "../../maps/svg/maps/generic/mercator.svg",
                legend: ((__legend == true) ? "true" : 0),
                align: "left",
                mode: "info",
                about: "test"
            },
            map => map

            .view([__lat || 42.101063417335624, __lon || 14.1432535944631], __zoom || 6.3)
            .options({
                featurescaling: "true",
                objectscaling: "dynamic",
                normalSizeScale: "5000000",
                flushChartDraw: "1000000",
                flushPaintShape: "1000000",
                basemapopacity: "0.5",
                panhidden: "false"
            })
            .local("aggregated", "")
            .local("... creating theme ...", "...")
            .local("loading data ...", "scaricando dati ...")
            .require("../../ui/js/tools/tooltip_mustache.js")
            .attribution(attribution)
            //.legend("<h1 style='padding:0.2em 0.5em;border-radius:0.5em;background:RGBA(255,255,255,0.5)'>Variazione della <span style='color:#884488'>fascia d'età 65+  (%)</span> dal 2003 al 2023 </h1>")		 

            // -----------------------------		 
            // the data visualization layer 
            // -----------------------------

            .layer(__georef_urban)
            .layer(__georef)
            .layer(__georef_prov)
            .layer(__georef_reg)
            .layer(__georef_ita)
            .layer(__theme_1)
        );


        /**
         **
         ** window size handling
         **
         **/

        $(window).resize(function() {
            $("#regis_map").css("height", (window.innerHeight - 5) + "px");
        });
        
        ixmaps.htmlgui_onZoomAndPan = function () {
 			var nOpacity = (ixmaps.getZoom() - 7) / 10;
			ixmaps.setBasemapOpacity(null, nOpacity, "absolute");
        }
       
       // -----------------------------------------------------------
        //
        // -----------------------------------------------------------
        
         __showProjectHTML = function(szProject,dataName) {

            // make object to handle project definition and get string or json from it
            // 
            var project = new Config(szProject);

            // get JSON and formatted string
            //
            szProject = project.getPrettyString();
            project = project.obj;

            let view = new Config({
                center: project.map.center,
                zoom: project.map.zoom
            });
            let szView = view.getPrettyString().replace(/\n/g, "\n\t\t");

            //szView = "["+project.map.center.lat+","+project.map.center.lng+"],"+project.map.zoom;

            szProject = "";

            //szProject += "data = "+JSON.stringify(dataA[project.themes[0].style.dbtable]) + "\n\n";

            szProject +=
                '<!DOCTYPE html>\n' +
                '<html>\n' +
                '  \n' +
                '<head>\n' +
                '\t<meta charset="UTF-8">\n' +
                '\t<meta http-equiv="X-UA-Compatible" content="IE=edge">\n' +
                '\t<meta name="viewport" content="width=device-width, initial-scale=1.0">\n' +
                '\t<meta name="description" content="ixmaps embed example">\n' +
                '\t<meta name="author" content="guenter richter">\n' +
                '\t<link rel="shortcut icon" href="https://gjrichter.github.io/ixmaps/ui/resources/images/ixmaps_logo.png">\n' +
                ' \n' +
                '\t<title>iXMaps embedded</title>\n' +
                '</head>\n' +
                ' \n' +
                '<body>\n' +
                ' \n' +
                '\t<!-- here goes the map -->\n' +
                '\t<div id="map-div"></div>\n' +
                ' \n' +
                '\t<!-- include the ixmaps API -->\n' +
                '\t<script src="https://gjrichter.github.io/ixmaps/ui/js/htmlgui_api.js"><\/script>\n' +
                ' \n' +
                '\t<script type="text/javascript" charset="utf-8">\n' +
                ' \n';

            szProject +=
                '\t\t// create and embed the map\n' +
                '\t\t// ! reference to "map-div", the hosting html div\n' +
                '\n' +
                '\t\tixmaps.embed("map-div", {\n' +
                '\t\t\tmapService: "leaflet_vt",\n' +
                '\t\t\tmapType: "'+ (project.map.basemap || "VT_OPENSTREETMAP") +'",\n' +
                '\t\t\tmap: "../../maps/svg/maps/generic/mercator.svg",\n' +
                '\t\t\tname: "map_1",\n' +
                '\t\t\tmode: "pan",\n' +
                '\t\t\tlegend: "true",\n' +
                '\t\t\ttools: "true",\n' +
                '\t\t\tsearch: "Europe",\n' +
                '\t\t\tabout: "test"\n' +
                '\t\t},\n';

            szProject +=
                '\t\tmap => map\n' +
                '\t\t.options({\n' +
                '\t\t\tfeaturescaling: "true",\n' +
                '\t\t\tobjectscaling: "dynamic",\n' +
                '\t\t\tnormalSizeScale: "10000000",\n' +
                '\t\t\tflushChartDraw: "1000000",\n' +
                '\t\t\tbasemapopacity: "0.5",\n' +
                '\t\t\tworksilent: "true",\n' +
                '\t\t\tloadsilent: "true",\n' +
                '\t\t\thideOnPan: "false",\n' +
                '\t\t\tfreezeOnPan: "false"\n' +
                '\t\t})\n' +
                '\t\t.local("working ...", "")\n';
            for (i in project.require ){
               szProject += '\t\t.require("'+project.require[i]+'")\n';
            }
            szProject +=
                '\t\t.attribution("' + project.map.attribution.replace(/\"/g, '\\\"') + '")\n' +
                '\t\t.view(' + szView + ')\n';

            let szThemes = "";
            for (var i in project.themes) {
                let themeObj = project.themes[i];
                let newObj = {};

                szThemes +=
                    '\t\t.layer(ixmaps.layer("generic", layer => layer\n';

                let data = {
                    url: String(themeObj.style.dbtableUrl),
                    type: String(themeObj.style.dbtableType),
                    name: String(themeObj.style.dbtable)
                };
                let dataObj = new Config(data);
                let szData = dataObj.getPrettyString().replace(/\n/g, "\n\t\t\t");;
                szThemes +=
                    '\t\t\t.data(' + szData + ')\n';

                delete themeObj.style.dbtableUrl;
                delete themeObj.style.dbtableType;
                delete themeObj.style.dbtable;

                let binding = {
                    geo: String(themeObj.style.lookupfield)
                };
                if (themeObj.field){
                    binding.value = String(themeObj.field);
                }
                if (themeObj.style.itemfield){
                    binding.id = String(themeObj.style.itemfield);
                }
                let bindingObj = new Config(binding);
                let szBinding = bindingObj.getPrettyString().replace(/\n/g, "\n\t\t\t");;
                szThemes +=
                    '\t\t\t.binding(' + szBinding + ')\n';

                delete themeObj.style.lookupfield;
                delete themeObj.style.itemfield;
                delete themeObj.field;

                szThemes +=
                    '\t\t\t.type("' + themeObj.style.type + '")\n';
                delete themeObj.style.type;

                let style = themeObj.style;
                let styleObj = new Config(style);
                let szStyle = styleObj.getPrettyString().replace(/\n/g, "\n\t\t\t");;
                szThemes +=
                    '\t\t\t.style(' + szStyle + ')\n';
                szThemes +=
                    '\t\t))\n';

            }
            szProject += szThemes;

            szProject +=
                 '\t);\n';

            szProject +=
                '\t<\/script>\n' +
                '<\/body>\n' +
                '<\/html>\n';


            // make the HTML

            var list = "";
            var id = "source-" + dataName;

            list += '<div class="source" style="padding:0.2em 0 0.2em 1em;background:#ffffff">';
            list += '<pre id="' + id + '" class="prettyprint language-HTML">';
            list += '</pre>';
            list += '</div>';

            $("#map_code_div-" + dataName).append(list);

            $("#" + id + "").text(String(szProject));
            hljs.highlightBlock($("#" + id)[0]);

            $(".hljs-attr").attr("onMouseOver", "showTooltip(event,$(this).text())");
            $(".hljs-attr").attr("onMouseOut", "hideTooltip()");

            $("#map_code_div-" + dataName + "_save").show();
        };
        
        var fCode = false;
        __toggleProjectHTML = function(){
            if (fCode){
                $("#map_code_div-project").html(""); 
                $("#map_code_div-project").hide();
                $("#map_code_div-project_save").hide();
            } else {
                __showProjectHTML(ixmaps.map().getProjectString(),'project');
                $("#map_code_div-project").show();
                $("#map_code_div-project_save").show();
            }
            fCode = !fCode;
        };
        
         __copyToClipboard = function() {
            // Get the html code
            var copyText = $("#source-project").text();

            // write the text to the clipboard
            navigator.clipboard.writeText(copyText);

            // Alert the copied text
            alert("HTML code copied to clipboard");
        };
       
        __saveTextAsFile = function(szFilename) {
            var szText = $("#source-project").text();
            var textToWrite = szText;
            var textFileAsBlob = new Blob([textToWrite], {
                type: 'text/plain'
            });
            var fileNameToSaveAs = szFilename || "project.json";

            var downloadLink = document.createElement("a");
            downloadLink.download = fileNameToSaveAs;
            downloadLink.innerHTML = "Download File";
            if (window.URL != null) {
                // Chrome allows the link to be clicked
                // without actually adding it to the DOM.
                downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
            } else {
                // Firefox requires the link to be added to the DOM
                // before it can be clicked.
                downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
                downloadLink.onclick = destroyClickedElement;
                downloadLink.style.display = "none";
                document.body.appendChild(downloadLink);
            }

            downloadLink.click();
        };
        
        

    </script>

</body>

</html>
